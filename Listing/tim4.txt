; generated by Component: ARM Compiler 5.06 update 4 (build 422) Tool: ArmCC [4d3604]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o..\output\tim4.o --asm_dir=..\Listing\ --list_dir=..\Listing\ --depend=..\output\tim4.d --cpu=Cortex-M4.fp.sp --apcs=interwork -O3 --diag_suppress=9931,870 -I..\APP -I..\drive -I..\Include -I..\Libraries\CMSIS\inc -I..\Libraries\CMSIS\src -I..\Libraries\FWlib\inc -I..\Libraries\FWlib\src -I..\Listing -I..\Output -I..\Project -I..\STemWinLibrary522\Config -I..\STemWinLibrary522\emWinTask -I..\STemWinLibrary522\GUILib -I..\STemWinLibrary522\inc -I..\User -I..\USB\STM32_USB_HOST_Library\Class\HID\inc -I..\USB\STM32_USB_HOST_Library\Class\MSC\src -I..\USB\STM32_USB_HOST_Library\Core\src -I..\USB\USB_APP -I..\USB\STM32_USB_HOST_Library\Class\HID\src -I..\USB\STM32_USB_HOST_Library\Class\MSC\inc -I..\USB\STM32_USB_HOST_Library\Core\inc -I..\USB\STM32_USB_OTG_Driver\inc -I..\FATFS\exfuns -I..\FATFS\src\option -I..\FATFS\src -I..\MALLOC -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMSIS\Include -IC:\Keil_v5\ARM\INC\ST\STM32F4xx -D__UVISION_VERSION=538 -DUSE_STDPERIPH_DRIVER -DSTM32F40XX -DUSE_USB_OTG_FS -DUSE_EMBEDDED_PHY -DUSE_USB_OTG_HS -DSTM32F40XX -W --omf_browse=..\output\tim4.crf --no_multibyte_chars ..\drive\TIM4.c]
                          THUMB

                          AREA ||i.SendToPC||, CODE, READONLY, ALIGN=2

                  SendToPC PROC
;;;134    
;;;135    void SendToPC(u8 mode)
000000  b4f0              PUSH     {r4-r7}
;;;136    {
;;;137    	
;;;138    	
;;;139    	vccbuf[0] = 0x01;
000002  4944              LDR      r1,|L1.276|
000004  2201              MOVS     r2,#1
;;;140    	vccbuf[2] = 0x0C;
;;;141    	if(mode == 0)//动态负载模式
;;;142    	{
;;;143    		vccbuf[1] = 0x50;//负载功能
;;;144    		
;;;145    		vccbuf[3] = (vu16)(DISS_Voltage*1000)>>8;
000006  4e44              LDR      r6,|L1.280|
000008  700a              STRB     r2,[r1,#0]            ;139
00000a  220c              MOVS     r2,#0xc               ;140
00000c  708a              STRB     r2,[r1,#2]            ;140
00000e  eddf0a43          VLDR     s1,|L1.284|
;;;146    		vccbuf[4] = (vu16)(DISS_Voltage*1000);//2字节负载电压
;;;147    		
;;;148    		vccbuf[5] = ((vu32)(DISS_Current*1000))>>24;
000012  4f43              LDR      r7,|L1.288|
000014  ed961a00          VLDR     s2,[r6,#0]            ;145
;;;149    		vccbuf[6] = ((vu32)(DISS_Current*1000))>>16;
;;;150    		vccbuf[7] = ((vu32)(DISS_Current*1000))>>8;
;;;151    		vccbuf[8] = ((vu32)(DISS_Current*1000));//4字节负载电流
;;;152    		
;;;153    		vccbuf[9] = battery_c>>24;
;;;154    		vccbuf[10] = battery_c>>16;
;;;155    		vccbuf[11] = battery_c>>8;
;;;156    		vccbuf[12] = battery_c;//4字节容量
;;;157    		vccbuf[13] = Temperature>>8;
000018  4b43              LDR      r3,|L1.296|
00001a  ed970a00          VLDR     s0,[r7,#0]            ;148
00001e  4a41              LDR      r2,|L1.292|
000020  881b              LDRH     r3,[r3,#0]
000022  ee200a20          VMUL.F32 s0,s0,s1              ;148
000026  ee610a20          VMUL.F32 s1,s2,s1              ;145
00002a  f3c32507          UBFX     r5,r3,#8,#8
;;;158    		vccbuf[14] = (vu8)Temperature;//2字节温度
00002e  b2dc              UXTB     r4,r3
000030  eebc0ac0          VCVT.U32.F32 s0,s0                 ;148
000034  eefc0ae0          VCVT.U32.F32 s1,s1                 ;145
000038  b128              CBZ      r0,|L1.70|
;;;159    	}else if(mode == 1){//动态电源模式
;;;160    		vccbuf[1] = 0x51;
;;;161    		
;;;162    		vccbuf[3] = (vu16)(Para.CPOW_Voltage*10)>>8;
00003a  4b3c              LDR      r3,|L1.300|
00003c  2801              CMP      r0,#1                 ;159
00003e  d005              BEQ      |L1.76|
;;;163    		vccbuf[4] = (vu16)(Para.CPOW_Voltage*10);//2字节电源电压
;;;164    		
;;;165    		vccbuf[5] = ((vu32)(Para.CCurrent*10))>>24;
;;;166    		vccbuf[6] = ((vu32)(Para.CCurrent*10))>>16;
;;;167    		vccbuf[7] = ((vu32)(Para.CCurrent*10))>>8;
;;;168    		vccbuf[8] = ((vu32)(Para.CCurrent*10));//4字节电源电流
;;;169    		
;;;170    		vccbuf[9] = battery_c>>24;
;;;171    		vccbuf[10] = battery_c>>16;
;;;172    		vccbuf[11] = battery_c>>8;
;;;173    		vccbuf[12] = battery_c;//4字节容量
;;;174    		vccbuf[13] = Temperature>>8;
;;;175    		vccbuf[14] = (vu8)Temperature;//2字节温度
;;;176    	}else if(mode == 2){//动态充放电
000040  2802              CMP      r0,#2
000042  d008              BEQ      |L1.86|
000044  e022              B        |L1.140|
                  |L1.70|
000046  2050              MOVS     r0,#0x50              ;143
000048  7048              STRB     r0,[r1,#1]            ;143
00004a  e02f              B        |L1.172|
                  |L1.76|
00004c  2051              MOVS     r0,#0x51              ;160
00004e  7048              STRB     r0,[r1,#1]            ;160
000050  e021              B        |L1.150|
                  |L1.82|
000052  7208              STRB     r0,[r1,#8]            ;151
000054  e00d              B        |L1.114|
                  |L1.86|
;;;177    		vccbuf[1] = 0x52;
000056  2052              MOVS     r0,#0x52
000058  7048              STRB     r0,[r1,#1]
;;;178    		
;;;179    		
;;;180    		if(mode_sw == 0)//放电
00005a  4835              LDR      r0,|L1.304|
00005c  7806              LDRB     r6,[r0,#0]  ; mode_sw
00005e  b1d6              CBZ      r6,|L1.150|
;;;181    		{
;;;182    			vccbuf[3] = (vu16)(Para.CPOW_Voltage*10)>>8;
;;;183    			vccbuf[4] = (vu16)(Para.CPOW_Voltage*10);//2字节电源电压
;;;184    			vccbuf[5] = ((vu32)(Para.CCurrent*10))>>24;
;;;185    			vccbuf[6] = ((vu32)(Para.CCurrent*10))>>16;
;;;186    			vccbuf[7] = ((vu32)(Para.CCurrent*10))>>8;
;;;187    			vccbuf[8] = ((vu32)(Para.CCurrent*10));//4字节电源电流
;;;188    		}else if(mode_sw == 1){//充电
000060  7806              LDRB     r6,[r0,#0]  ; mode_sw
000062  2e01              CMP      r6,#1
000064  d022              BEQ      |L1.172|
;;;189    			vccbuf[3] = (vu16)(DISS_Voltage*1000)>>8;
;;;190    			vccbuf[4] = (vu16)(DISS_Voltage*1000);//2字节负载电压
;;;191    			vccbuf[5] = ((vu32)(DISS_Current*1000))>>24;
;;;192    			vccbuf[6] = ((vu32)(DISS_Current*1000))>>16;
;;;193    			vccbuf[7] = ((vu32)(DISS_Current*1000))>>8;
;;;194    			vccbuf[8] = ((vu32)(DISS_Current*1000));//4字节负载电流
;;;195    		}else if(mode_sw == 2){//充电搁置
000066  7806              LDRB     r6,[r0,#0]  ; mode_sw
000068  2e02              CMP      r6,#2
00006a  d035              BEQ      |L1.216|
;;;196    			vccbuf[3] = (vu16)(DISS_Voltage*1000)>>8;
;;;197    			vccbuf[4] = (vu16)(DISS_Voltage*1000);//2字节负载电压
;;;198    			vccbuf[5] = ((vu32)(Para.CCurrent*10))>>24;
;;;199    			vccbuf[6] = ((vu32)(Para.CCurrent*10))>>16;
;;;200    			vccbuf[7] = ((vu32)(Para.CCurrent*10))>>8;
;;;201    			vccbuf[8] = ((vu32)(Para.CCurrent*10));//4字节电源电流
;;;202    		}else if(mode_sw == 3){//放电搁置
00006c  7800              LDRB     r0,[r0,#0]  ; mode_sw
00006e  2803              CMP      r0,#3
000070  d01c              BEQ      |L1.172|
                  |L1.114|
;;;203    			vccbuf[3] = (vu16)(DISS_Voltage*1000)>>8;
;;;204    			vccbuf[4] = (vu16)(DISS_Voltage*1000);
;;;205    			vccbuf[5] = ((vu32)(DISS_Current*1000))>>24;
;;;206    			vccbuf[6] = ((vu32)(DISS_Current*1000))>>16;
;;;207    			vccbuf[7] = ((vu32)(DISS_Current*1000))>>8;
;;;208    			vccbuf[8] = ((vu32)(DISS_Current*1000));//4字节负载电流
;;;209    		}
;;;210    		
;;;211    		vccbuf[9] = battery_c>>24;
000072  6b10              LDR      r0,[r2,#0x30]  ; battery_c
000074  0e00              LSRS     r0,r0,#24
000076  7248              STRB     r0,[r1,#9]
;;;212    		vccbuf[10] = battery_c>>16;
000078  6b10              LDR      r0,[r2,#0x30]  ; battery_c
00007a  0c00              LSRS     r0,r0,#16
00007c  7288              STRB     r0,[r1,#0xa]
;;;213    		vccbuf[11] = battery_c>>8;
00007e  6b10              LDR      r0,[r2,#0x30]  ; battery_c
000080  0a00              LSRS     r0,r0,#8
000082  72c8              STRB     r0,[r1,#0xb]
;;;214    		vccbuf[12] = battery_c;//4字节容量
000084  6b10              LDR      r0,[r2,#0x30]  ; battery_c
000086  7308              STRB     r0,[r1,#0xc]
;;;215    		vccbuf[13] = Temperature>>8;
000088  734d              STRB     r5,[r1,#0xd]
;;;216    		vccbuf[14] = (vu8)Temperature;//2字节温度
00008a  738c              STRB     r4,[r1,#0xe]
                  |L1.140|
;;;217    	}
;;;218    	MODS_SendWithCRC(vccbuf, 15);
00008c  bcf0              POP      {r4-r7}
00008e  210f              MOVS     r1,#0xf
000090  4820              LDR      r0,|L1.276|
000092  f7ffbffe          B.W      MODS_SendWithCRC
                  |L1.150|
000096  6a98              LDR      r0,[r3,#0x28]         ;182  ; Para
000098  eb000080          ADD      r0,r0,r0,LSL #2       ;182
00009c  f3c010d7          UBFX     r0,r0,#7,#24          ;182
0000a0  70c8              STRB     r0,[r1,#3]            ;182
0000a2  6a98              LDR      r0,[r3,#0x28]         ;183  ; Para
0000a4  eb000080          ADD      r0,r0,r0,LSL #2       ;183
0000a8  0040              LSLS     r0,r0,#1              ;183
0000aa  e01b              B        |L1.228|
                  |L1.172|
0000ac  ee100a90          VMOV     r0,s1                 ;189
0000b0  0a00              LSRS     r0,r0,#8              ;189
0000b2  70c8              STRB     r0,[r1,#3]            ;189
0000b4  ee100a90          VMOV     r0,s1                 ;190
0000b8  7108              STRB     r0,[r1,#4]            ;190
0000ba  ee100a10          VMOV     r0,s0                 ;191
0000be  0e00              LSRS     r0,r0,#24             ;191
0000c0  7148              STRB     r0,[r1,#5]            ;191
0000c2  ee100a10          VMOV     r0,s0                 ;192
0000c6  0c00              LSRS     r0,r0,#16             ;192
0000c8  7188              STRB     r0,[r1,#6]            ;192
0000ca  ee100a10          VMOV     r0,s0                 ;193
0000ce  0a00              LSRS     r0,r0,#8              ;193
0000d0  71c8              STRB     r0,[r1,#7]            ;193
0000d2  ee100a10          VMOV     r0,s0                 ;194
0000d6  e7bc              B        |L1.82|
                  |L1.216|
0000d8  ee100a90          VMOV     r0,s1                 ;196
0000dc  0a00              LSRS     r0,r0,#8              ;196
0000de  70c8              STRB     r0,[r1,#3]            ;196
0000e0  ee100a90          VMOV     r0,s1                 ;197
                  |L1.228|
0000e4  7108              STRB     r0,[r1,#4]            ;183
0000e6  6b18              LDR      r0,[r3,#0x30]         ;184  ; Para
0000e8  eb000080          ADD      r0,r0,r0,LSL #2       ;184
0000ec  f3c050c7          UBFX     r0,r0,#23,#8          ;184
0000f0  7148              STRB     r0,[r1,#5]            ;184
0000f2  6b18              LDR      r0,[r3,#0x30]         ;185  ; Para
0000f4  eb000080          ADD      r0,r0,r0,LSL #2       ;185
0000f8  f3c030cf          UBFX     r0,r0,#15,#16         ;185
0000fc  7188              STRB     r0,[r1,#6]            ;185
0000fe  6b18              LDR      r0,[r3,#0x30]         ;186  ; Para
000100  eb000080          ADD      r0,r0,r0,LSL #2       ;186
000104  f3c010d7          UBFX     r0,r0,#7,#24          ;186
000108  71c8              STRB     r0,[r1,#7]            ;186
00010a  6b18              LDR      r0,[r3,#0x30]         ;187  ; Para
00010c  eb000080          ADD      r0,r0,r0,LSL #2       ;187
000110  0040              LSLS     r0,r0,#1              ;187
000112  e79e              B        |L1.82|
;;;219    }
;;;220    
                          ENDP

                  |L1.276|
                          DCD      ||.bss||+0x7d0
                  |L1.280|
                          DCD      DISS_Voltage
                  |L1.284|
00011c  447a0000          DCFS     0x447a0000 ; 1000
                  |L1.288|
                          DCD      DISS_Current
                  |L1.292|
                          DCD      ||area_number.11||
                  |L1.296|
                          DCD      Temperature
                  |L1.300|
                          DCD      Para
                  |L1.304|
                          DCD      mode_sw

                          AREA ||i.TIM3_IRQHandler||, CODE, READONLY, ALIGN=2

                  TIM3_IRQHandler PROC
;;;268    
;;;269    void TIM3_IRQHandler(void){
000000  e92d5ff0          PUSH     {r4-r12,lr}
000004  ed2d8b04          VPUSH    {d8-d9}
;;;270    	
;;;271    	float ftemp = 0;
000008  ed9f8af7          VLDR     s16,|L2.1000|
;;;272    	float step_c = 0;
;;;273    	int step_time = 0;
;;;274    	float LPower,PPower;
;;;275    	u8 i;
;;;276    
;;;277    	
;;;278        if(TIM_GetITStatus(TIM3,TIM_IT_Update) == SET) 
00000c  2101              MOVS     r1,#1
00000e  48f7              LDR      r0,|L2.1004|
000010  f7fffffe          BL       TIM_GetITStatus
000014  2801              CMP      r0,#1
000016  d16e              BNE      |L2.246|
;;;279        {
;;;280    		readpowflag ++;//读取电源数据计时
000018  48f5              LDR      r0,|L2.1008|
00001a  6801              LDR      r1,[r0,#0]  ; readpowflag
00001c  1c49              ADDS     r1,r1,#1
00001e  6001              STR      r1,[r0,#0]  ; readpowflag
;;;281    		setpowflag ++;
000020  48f4              LDR      r0,|L2.1012|
000022  6801              LDR      r1,[r0,#0]  ; setpowflag
000024  1c49              ADDS     r1,r1,#1
000026  6001              STR      r1,[r0,#0]  ; setpowflag
;;;282    		if( ms_time > (1 << 31) - 2 )
000028  48f3              LDR      r0,|L2.1016|
00002a  6902              LDR      r2,[r0,#0x10]  ; ms_time
00002c  49f3              LDR      r1,|L2.1020|
00002e  2400              MOVS     r4,#0
000030  428a              CMP      r2,r1
000032  d900              BLS      |L2.54|
;;;283    			
;;;284    			ms_time = 0;
000034  6104              STR      r4,[r0,#0x10]  ; ms_time
                  |L2.54|
;;;285    		
;;;286    		if( abc_time > (1 << 31) - 2 )
000036  68c2              LDR      r2,[r0,#0xc]  ; abc_time
000038  428a              CMP      r2,r1
00003a  d900              BLS      |L2.62|
;;;287    			
;;;288    			abc_time = 0;
00003c  60c4              STR      r4,[r0,#0xc]  ; abc_time
                  |L2.62|
;;;289    		if(finishdelay != 0)
00003e  4680              MOV      r8,r0
000040  6ac0              LDR      r0,[r0,#0x2c]  ; finishdelay
000042  b120              CBZ      r0,|L2.78|
;;;290    		{
;;;291    			finishdelay --;
000044  f8d8102c          LDR      r1,[r8,#0x2c]  ; finishdelay
000048  1e49              SUBS     r1,r1,#1
00004a  f8c8102c          STR      r1,[r8,#0x2c]  ; finishdelay
                  |L2.78|
;;;292    		}
;;;293    		
;;;294    		switch(MODE){
00004e  48ec              LDR      r0,|L2.1024|
000050  7801              LDRB     r1,[r0,#0]  ; MODE
;;;295    			
;;;296    			//程控负载
;;;297    			case 0:{
;;;298    				
;;;299    				if(rmtrig[0] == 1)
;;;300    				{
;;;301    					if( ms_time%1000 == 0 && ms_time > 999 ){
;;;302    						ftemp = DISS_Current * 1000 * 1/3600;
000052  ed9f0aec          VLDR     s0,|L2.1028|
000056  eddf8aec          VLDR     s17,|L2.1032|
00005a  48ec              LDR      r0,|L2.1036|
;;;303    						CDC_CsumMah += ftemp ;
00005c  f8dfa3b0          LDR      r10,|L2.1040|
000060  2501              MOVS     r5,#1                 ;278
;;;304    						battery_c = CDC_CsumMah;
;;;305    						SendToPC(0);
;;;306    					}
;;;307    					
;;;308    				}else{
;;;309    					CDC_CsumMah = 0;
;;;310    					battery_c = 0;
;;;311    				}
;;;312    				if(mainswitch == 1)
000062  4fec              LDR      r7,|L2.1044|
000064  f8dfb3b0          LDR      r11,|L2.1048|
000068  f44f797a          MOV      r9,#0x3e8             ;301
00006c  2906              CMP      r1,#6                 ;294
00006e  d210              BCS      |L2.146|
000070  e8dff001          TBB      [pc,r1]               ;294
000074  03426d0f          DCB      0x03,0x42,0x6d,0x0f
000078  0ffd              DCB      0x0f,0xfd
00007a  7800              LDRB     r0,[r0,#0]            ;299  ; rmtrig
00007c  2801              CMP      r0,#1                 ;299
00007e  d009              BEQ      |L2.148|
000080  ed8a8a00          VSTR     s16,[r10,#0]          ;309
000084  f8c84030          STR      r4,[r8,#0x30]         ;310  ; battery_c
                  |L2.136|
000088  7838              LDRB     r0,[r7,#0]  ; mainswitch
00008a  2801              CMP      r0,#1
00008c  d024              BEQ      |L2.216|
;;;313    				{
;;;314    					if(watchcount < 999)
;;;315    					{
;;;316    						watchcurrent[watchcount] = Vmon_Load_value;
;;;317    						watchcount++;
;;;318    					}
;;;319    				}else{
;;;320    					watchcount = 0;
00008e  f8a84008          STRH     r4,[r8,#8]
                  |L2.146|
000092  e35c              B        |L2.1870|
                  |L2.148|
000094  f8d82010          LDR      r2,[r8,#0x10]         ;301  ; ms_time
000098  4640              MOV      r0,r8                 ;301
00009a  4649              MOV      r1,r9                 ;301
00009c  fbb2f3f1          UDIV     r3,r2,r1              ;301
0000a0  fb092213          MLS      r2,r9,r3,r2           ;301
0000a4  2a00              CMP      r2,#0                 ;301
0000a6  d1ef              BNE      |L2.136|
0000a8  6902              LDR      r2,[r0,#0x10]         ;301  ; ms_time
0000aa  454a              CMP      r2,r9                 ;301
0000ac  d3ec              BCC      |L2.136|
0000ae  eddb0a00          VLDR     s1,[r11,#0]           ;302
0000b2  ee201aa8          VMUL.F32 s2,s1,s17             ;302
0000b6  eec10a00          VDIV.F32 s1,s2,s0              ;302
0000ba  ed9a0a00          VLDR     s0,[r10,#0]           ;303
0000be  ee300a20          VADD.F32 s0,s0,s1              ;303
0000c2  ed8a0a00          VSTR     s0,[r10,#0]           ;303
0000c6  eebc0ac0          VCVT.U32.F32 s0,s0                 ;304
0000ca  ee101a10          VMOV     r1,s0                 ;304
0000ce  6301              STR      r1,[r0,#0x30]         ;304  ; battery_c
0000d0  2000              MOVS     r0,#0                 ;305
0000d2  f7fffffe          BL       SendToPC
0000d6  e7d7              B        |L2.136|
                  |L2.216|
0000d8  f8b80008          LDRH     r0,[r8,#8]            ;314  ; watchcount
0000dc  f24032e7          MOV      r2,#0x3e7             ;314
0000e0  4290              CMP      r0,r2                 ;314
0000e2  d2d6              BCS      |L2.146|
0000e4  4acd              LDR      r2,|L2.1052|
0000e6  8812              LDRH     r2,[r2,#0]            ;316  ; Vmon_Load_value
0000e8  4bcd              LDR      r3,|L2.1056|
0000ea  f8232010          STRH     r2,[r3,r0,LSL #1]     ;316
0000ee  1c40              ADDS     r0,r0,#1              ;316
0000f0  f8a80008          STRH     r0,[r8,#8]            ;317
0000f4  e32b              B        |L2.1870|
                  |L2.246|
0000f6  e3fd              B        |L2.2292|
;;;321    				}
;;;322    			}
;;;323    			break;
;;;324    			
;;;325    			//程控电源
;;;326    			case 1:{
;;;327    				if(rmtrig[1] == 1)
0000f8  7840              LDRB     r0,[r0,#1]  ; rmtrig
0000fa  2801              CMP      r0,#1
0000fc  d004              BEQ      |L2.264|
;;;328    				{
;;;329    					if( ms_time%1000 == 0 && ms_time > 999 ){
;;;330    	
;;;331    						ftemp = DISS_POW_Current * 1000 * 1/3600;
;;;332    						
;;;333    						CDC_CsumMah += ftemp ;
;;;334    						battery_c = CDC_CsumMah;
;;;335    						SendToPC(1);
;;;336    					}
;;;337    					
;;;338    					
;;;339    				}else{
;;;340    					CDC_CsumMah = 0;
0000fe  ed8a8a00          VSTR     s16,[r10,#0]
;;;341    					battery_c = 0;
000102  f8c84030          STR      r4,[r8,#0x30]  ; battery_c
000106  e322              B        |L2.1870|
                  |L2.264|
000108  f8d82010          LDR      r2,[r8,#0x10]         ;329  ; ms_time
00010c  4640              MOV      r0,r8                 ;329
00010e  4649              MOV      r1,r9                 ;329
000110  fbb2f3f1          UDIV     r3,r2,r1              ;329
000114  fb092213          MLS      r2,r9,r3,r2           ;329
000118  2a00              CMP      r2,#0                 ;329
00011a  d1ba              BNE      |L2.146|
00011c  6902              LDR      r2,[r0,#0x10]         ;329  ; ms_time
00011e  454a              CMP      r2,r9                 ;329
000120  d3b7              BCC      |L2.146|
000122  49c0              LDR      r1,|L2.1060|
000124  edd10a00          VLDR     s1,[r1,#0]            ;331
000128  ee201aa8          VMUL.F32 s2,s1,s17             ;331
00012c  eec10a00          VDIV.F32 s1,s2,s0              ;331
000130  ed9a0a00          VLDR     s0,[r10,#0]           ;333
000134  ee300a20          VADD.F32 s0,s0,s1              ;333
000138  ed8a0a00          VSTR     s0,[r10,#0]           ;333
00013c  eebc0ac0          VCVT.U32.F32 s0,s0                 ;334
000140  ee101a10          VMOV     r1,s0                 ;334
000144  6301              STR      r1,[r0,#0x30]         ;334  ; battery_c
000146  2001              MOVS     r0,#1                 ;335
000148  f7fffffe          BL       SendToPC
00014c  e2ff              B        |L2.1870|
;;;342    				}
;;;343    			}
;;;344    			break;
;;;345    			
;;;346    			//过流
;;;347    			case 2:{
;;;348    				
;;;349    				if( trig_flag_state == 1 && C_DISCHARGE == 1){		
00014e  49b6              LDR      r1,|L2.1064|
000150  7808              LDRB     r0,[r1,#0]  ; trig_flag_state
000152  2801              CMP      r0,#1
000154  d14e              BNE      |L2.500|
000156  48b5              LDR      r0,|L2.1068|
000158  7800              LDRB     r0,[r0,#0]  ; C_DISCHARGE
00015a  2801              CMP      r0,#1
00015c  d14a              BNE      |L2.500|
;;;350    //					finishflag = 0;
;;;351    					step_c =  (float)Para.IR_Step_C / 1000 ;
00015e  f8dfa2d0          LDR      r10,|L2.1072|
000162  4650              MOV      r0,r10
000164  f8302f48          LDRH     r2,[r0,#0x48]!  ; Para
;;;352    					
;;;353    					step_time = (int)Para.IR_Step_Time;
000168  8900              LDRH     r0,[r0,#8]  ; Para
;;;354    					
;;;355    					if( step_time < 1 ){
00016a  2801              CMP      r0,#1
00016c  da00              BGE      |L2.368|
;;;356    						
;;;357    						step_time = 1;
00016e  2001              MOVS     r0,#1
                  |L2.368|
;;;358    					}
;;;359    					
;;;360    													
;;;361    					
;;;362    					if( trig_flag_state != 0 )
000170  49ad              LDR      r1,|L2.1064|
000172  7809              LDRB     r1,[r1,#0]  ; trig_flag_state
000174  b3f1              CBZ      r1,|L2.500|
;;;363    					{						
;;;364    						if( DISS_Current > old_I )
000176  49af              LDR      r1,|L2.1076|
000178  eddb0a00          VLDR     s1,[r11,#0]
00017c  ed910a00          VLDR     s0,[r1,#0]
000180  eef40ac0          VCMPE.F32 s1,s0
000184  eef1fa10          VMRS     APSR_nzcv,FPSCR
000188  dd01              BLE      |L2.398|
;;;365    								
;;;366    							old_I = DISS_Current;
00018a  edc10a00          VSTR     s1,[r1,#0]
                  |L2.398|
;;;367    
;;;368    						if( ms_time%step_time == 0)
00018e  f8d82010          LDR      r2,[r8,#0x10]  ; ms_time
000192  4646              MOV      r6,r8
000194  fbb2f3f0          UDIV     r3,r2,r0
000198  fb002013          MLS      r0,r0,r3,r2
;;;369    						{
;;;370    								
;;;371    //							max_discahrgeNum += step_c;
;;;372    //									
;;;373    //							Para.CSET_Current_Laod = (int)(max_discahrgeNum * 1000);
;;;374    							
;;;375    							max_discahrgeNum = old_I;
00019c  4aa6              LDR      r2,|L2.1080|
00019e  b950              CBNZ     r0,|L2.438|
0001a0  ed910a00          VLDR     s0,[r1,#0]
0001a4  ed820a00          VSTR     s0,[r2,#0]
;;;376    							Para.CSET_Current_Laod += Para.IR_Step_C;
0001a8  f8da3014          LDR      r3,[r10,#0x14]  ; Para
0001ac  f8bac048          LDRH     r12,[r10,#0x48]  ; Para
0001b0  4463              ADD      r3,r3,r12
0001b2  f8ca3014          STR      r3,[r10,#0x14]  ; Para
                  |L2.438|
;;;377    						}
;;;378    						if( old_I != 0 ){
0001b6  ed910a00          VLDR     s0,[r1,#0]
;;;379    						
;;;380    							if( old_I - DISS_Current > 0.002 /*DISS_Current < old_I*/ || DISS_Voltage < 0.1){
0001ba  48a0              LDR      r0,|L2.1084|
;;;381    								max_discahrgeNum = old_I;
;;;382    								g_tModS.TxBuf[13] = (int)(max_discahrgeNum*100)>>8;
0001bc  ed9f9aa0          VLDR     s18,|L2.1088|
0001c0  eeb50ac0          VCMPE.F32 s0,#0.0               ;378
0001c4  eef1fa10          VMRS     APSR_nzcv,FPSCR       ;378
0001c8  d034              BEQ      |L2.564|
0001ca  ee700a60          VSUB.F32 s1,s0,s1              ;380
0001ce  4b9d              LDR      r3,|L2.1092|
0001d0  ee101a90          VMOV     r1,s1                 ;380
0001d4  4299              CMP      r1,r3                 ;380
0001d6  da03              BGE      |L2.480|
0001d8  499b              LDR      r1,|L2.1096|
0001da  6809              LDR      r1,[r1,#0]            ;380  ; DISS_Voltage
0001dc  4281              CMP      r1,r0                 ;380
0001de  da53              BGE      |L2.648|
                  |L2.480|
0001e0  ed820a00          VSTR     s0,[r2,#0]            ;381
0001e4  ee200a09          VMUL.F32 s0,s0,s18
0001e8  eebd0ac0          VCVT.S32.F32 s0,s0
0001ec  ee100a10          VMOV     r0,s0
0001f0  0a01              LSRS     r1,r0,#8
0001f2  e000              B        |L2.502|
                  |L2.500|
0001f4  e048              B        |L2.648|
                  |L2.502|
0001f6  4895              LDR      r0,|L2.1100|
0001f8  f8001f2b          STRB     r1,[r0,#0x2b]!
;;;383    								g_tModS.TxBuf[14] = (int)(max_discahrgeNum*100);
0001fc  ee101a10          VMOV     r1,s0
000200  7041              STRB     r1,[r0,#1]
;;;384    								trig_flag_state = 0;
000202  4889              LDR      r0,|L2.1064|
000204  7004              STRB     r4,[r0,#0]
;;;385    								Off_GPOI_ResetSet();  
000206  f7fffffe          BL       Off_GPOI_ResetSet
;;;386    //								mainswitch = 0;
;;;387    								if(Para.ACT_DELAY != 0)
00020a  e02e              B        |L2.618|
                  |L2.524|
;;;388    								{
;;;389    									recharge = 1000*Para.ACT_DELAY;
;;;390    								}else{
;;;391    									recharge = 1000;
00020c  6231              STR      r1,[r6,#0x20]  ; recharge
;;;392    								}
;;;393    								Para.POWER_OutPut_V = (int)(testv*1000) + 3000;
;;;394    								Para.POWER_Limit_C = 1000;
;;;395    								mainswitch = 1;
;;;396    								PowerCommWaitHandle(1,0);
;;;397    //								sendwait = 1;
;;;398    //								OnOff_GPOI_ResetSet(0,1);
;;;399    							}
;;;400    						}else{
;;;401    							if(DISS_Voltage < 0.1){
;;;402    								max_discahrgeNum = old_I;
;;;403    								Off_GPOI_ResetSet();
;;;404    								g_tModS.TxBuf[13] = (int)(max_discahrgeNum*100)>>8;
;;;405    								g_tModS.TxBuf[14] = (int)(max_discahrgeNum*100);
;;;406    								trig_flag_state = 0;
;;;407    	//							Off_GPOI_ResetSet();  
;;;408    //								mainswitch = 0;
;;;409    								if(Para.ACT_DELAY != 0)
;;;410    								{
;;;411    									recharge = 1000*Para.ACT_DELAY;
;;;412    								}else{
;;;413    									recharge = 1000;
;;;414    								}
;;;415    								Para.POWER_OutPut_V = (int)(testv*1000) + 3000;
00020e  ed960a0a          VLDR     s0,[r6,#0x28]
000212  ee200a28          VMUL.F32 s0,s0,s17
000216  eebd0ac0          VCVT.S32.F32 s0,s0
00021a  ee101a10          VMOV     r1,s0
00021e  f60131b8          ADD      r1,r1,#0xbb8
000222  6541              STR      r1,[r0,#0x54]  ; Para
;;;416    								Para.POWER_Limit_C = 1000;
000224  f8a09058          STRH     r9,[r0,#0x58]
;;;417    								mainswitch = 1;
000228  703d              STRB     r5,[r7,#0]
;;;418    								PowerCommWaitHandle(1,0);
00022a  2100              MOVS     r1,#0
00022c  2001              MOVS     r0,#1
00022e  f7fffffe          BL       PowerCommWaitHandle
000232  e029              B        |L2.648|
                  |L2.564|
000234  4984              LDR      r1,|L2.1096|
000236  6809              LDR      r1,[r1,#0]            ;401  ; DISS_Voltage
000238  4281              CMP      r1,r0                 ;401
00023a  da25              BGE      |L2.648|
00023c  487e              LDR      r0,|L2.1080|
00023e  ed800a00          VSTR     s0,[r0,#0]            ;402
000242  f7fffffe          BL       Off_GPOI_ResetSet
000246  487c              LDR      r0,|L2.1080|
000248  ed900a00          VLDR     s0,[r0,#0]            ;404
00024c  ee200a09          VMUL.F32 s0,s0,s18             ;404
000250  eebd0ac0          VCVT.S32.F32 s0,s0                 ;404
000254  ee100a10          VMOV     r0,s0                 ;404
000258  0a01              LSRS     r1,r0,#8              ;404
00025a  487c              LDR      r0,|L2.1100|
00025c  f8001f2b          STRB     r1,[r0,#0x2b]!        ;404
000260  ee101a10          VMOV     r1,s0                 ;405
000264  7041              STRB     r1,[r0,#1]            ;405
000266  4870              LDR      r0,|L2.1064|
000268  7004              STRB     r4,[r0,#0]            ;406
                  |L2.618|
00026a  4650              MOV      r0,r10                ;387
00026c  e000              B        |L2.624|
00026e  e09b              B        |L2.936|
                  |L2.624|
000270  f89a1052          LDRB     r1,[r10,#0x52]        ;387  ; Para
000274  b131              CBZ      r1,|L2.644|
000276  f8901052          LDRB     r1,[r0,#0x52]         ;411  ; Para
00027a  f44f727a          MOV      r2,#0x3e8             ;411
00027e  fb11f102          SMULBB   r1,r1,r2              ;411
000282  e7c3              B        |L2.524|
                  |L2.644|
000284  4649              MOV      r1,r9                 ;413
000286  e7c1              B        |L2.524|
                  |L2.648|
;;;419    //								sendwait = 1;
;;;420    							}
;;;421    						}
;;;422    					}								
;;;423    				}
;;;424    				if(recharge != 0)
000288  f8d80020          LDR      r0,[r8,#0x20]  ; recharge
00028c  4646              MOV      r6,r8
;;;425    				{
;;;426    					recharge --;
;;;427    					if(recharge == 0)
;;;428    					{
;;;429    						mainswitch = 0;
;;;430    						PowerCommWaitHandle(3,0);
;;;431    //						sendwait = 3;
;;;432    //						Off_GPOI_ResetSet();
;;;433    						LOAD_MODE = 1;
00028e  f8dfa1c0          LDR      r10,|L2.1104|
000292  b1b8              CBZ      r0,|L2.708|
000294  6a30              LDR      r0,[r6,#0x20]         ;426  ; recharge
000296  1e40              SUBS     r0,r0,#1              ;426
000298  6230              STR      r0,[r6,#0x20]         ;426  ; recharge
00029a  6a30              LDR      r0,[r6,#0x20]         ;427  ; recharge
00029c  b990              CBNZ     r0,|L2.708|
00029e  703c              STRB     r4,[r7,#0]            ;429
0002a0  2100              MOVS     r1,#0                 ;430
0002a2  2003              MOVS     r0,#3                 ;430
0002a4  f7fffffe          BL       PowerCommWaitHandle
0002a8  f8ca5018          STR      r5,[r10,#0x18]  ; Run_Control
;;;434    						GPIO_SetBits(GPIOC,GPIO_Pin_12);//CV模式
0002ac  f44f5180          MOV      r1,#0x1000
0002b0  4868              LDR      r0,|L2.1108|
0002b2  f7fffffe          BL       GPIO_SetBits
;;;435    						shortflag = 1;
0002b6  7075              STRB     r5,[r6,#1]
;;;436    						Para.CSET_Voltage_Laod = 0;
0002b8  485d              LDR      r0,|L2.1072|
0002ba  6104              STR      r4,[r0,#0x10]  ; Para
;;;437    //						Para.CSET_Current_Laod = (int)(max_discahrgeNum*1000) + 3000;
;;;438    						OnOff_GPOI_ResetSet(2,1);
0002bc  2101              MOVS     r1,#1
0002be  2002              MOVS     r0,#2
0002c0  f7fffffe          BL       OnOff_GPOI_ResetSet
                  |L2.708|
;;;439    					}
;;;440    				}
;;;441    				if(shortflag == 1)
0002c4  7870              LDRB     r0,[r6,#1]  ; shortflag
0002c6  2801              CMP      r0,#1
0002c8  d13f              BNE      |L2.842|
;;;442    				{
;;;443    					shorttime ++;
0002ca  7830              LDRB     r0,[r6,#0]  ; shorttime
0002cc  1c40              ADDS     r0,r0,#1
0002ce  7030              STRB     r0,[r6,#0]
;;;444    //					if( DISS_Current > shortold_I )
;;;445    //					{
;;;446    //						shortold_I = DISS_Current;
;;;447    //					}
;;;448    //					if( shortold_I != 0 )
;;;449    //					{
;;;450    //						if( shortold_I - DISS_Current > 0.002 /*DISS_Current < old_I*//* || DISS_Voltage < 0.1*/){
;;;451    //							shortflag = 0;
;;;452    //							Off_GPOI_ResetSet();
;;;453    //							g_tModS.TxBuf[15] = (shorttime)>>8;
;;;454    //							g_tModS.TxBuf[16] = (shorttime);
;;;455    //							MODS_SendWithCRC(g_tModS.TxBuf, g_tModS.TxCount);
;;;456    //							if(Para.ACT_DELAY != 0)
;;;457    //							{
;;;458    //								reboot = 1000*Para.ACT_DELAY;
;;;459    //							}else{
;;;460    //								reboot = 1000;
;;;461    //							}
;;;462    //	//						reboot = 5000;
;;;463    //							Para.POWER_OutPut_V = (int)(testv*1000) + 3000;
;;;464    //							Para.POWER_Limit_C = 1000;
;;;465    //							mainswitch = 1;
;;;466    //							sendwait = 1;
;;;467    //							shortold_I = 0;
;;;468    //						}
;;;469    //					}
;;;470    					if(DISS_Voltage/testv < 0.4 || shorttime==255)
0002d0  485d              LDR      r0,|L2.1096|
0002d2  ed961a0a          VLDR     s2,[r6,#0x28]
0002d6  4960              LDR      r1,|L2.1112|
0002d8  edd00a00          VLDR     s1,[r0,#0]
0002dc  ee800a81          VDIV.F32 s0,s1,s2
0002e0  ee100a10          VMOV     r0,s0
0002e4  4288              CMP      r0,r1
0002e6  db02              BLT      |L2.750|
0002e8  7830              LDRB     r0,[r6,#0]  ; shorttime
0002ea  28ff              CMP      r0,#0xff
0002ec  d12d              BNE      |L2.842|
                  |L2.750|
;;;471    					{
;;;472    						shortflag = 0;
0002ee  7074              STRB     r4,[r6,#1]
;;;473    						Off_GPOI_ResetSet();
0002f0  f7fffffe          BL       Off_GPOI_ResetSet
;;;474    						g_tModS.TxBuf[15] = (shorttime)>>8;
0002f4  7830              LDRB     r0,[r6,#0]  ; shorttime
0002f6  4855              LDR      r0,|L2.1100|
0002f8  f8004f2d          STRB     r4,[r0,#0x2d]!
;;;475    						g_tModS.TxBuf[16] = (shorttime);
0002fc  7831              LDRB     r1,[r6,#0]  ; shorttime
0002fe  7041              STRB     r1,[r0,#1]
;;;476    						MODS_SendWithCRC(g_tModS.TxBuf, g_tModS.TxCount);
000300  f8901075          LDRB     r1,[r0,#0x75]  ; g_tModS
000304  4851              LDR      r0,|L2.1100|
000306  301e              ADDS     r0,r0,#0x1e
000308  f7fffffe          BL       MODS_SendWithCRC
;;;477    						if(Para.ACT_DELAY != 0)
00030c  4848              LDR      r0,|L2.1072|
00030e  f8901052          LDRB     r1,[r0,#0x52]  ; Para
000312  b131              CBZ      r1,|L2.802|
;;;478    						{
;;;479    							reboot = 1000*Para.ACT_DELAY;
000314  f8901052          LDRB     r1,[r0,#0x52]  ; Para
000318  f44f727a          MOV      r2,#0x3e8
00031c  fb11f102          SMULBB   r1,r1,r2
000320  e000              B        |L2.804|
                  |L2.802|
;;;480    						}else{
;;;481    							reboot = 1000;
000322  4649              MOV      r1,r9
                  |L2.804|
000324  6271              STR      r1,[r6,#0x24]  ; reboot
;;;482    						}
;;;483    //						reboot = 5000;
;;;484    						Para.POWER_OutPut_V = (int)(testv*1000) + 3000;
000326  ed960a0a          VLDR     s0,[r6,#0x28]
00032a  ee200a28          VMUL.F32 s0,s0,s17
00032e  eebd0ac0          VCVT.S32.F32 s0,s0
000332  ee101a10          VMOV     r1,s0
000336  f60131b8          ADD      r1,r1,#0xbb8
00033a  6541              STR      r1,[r0,#0x54]  ; Para
;;;485    						Para.POWER_Limit_C = 1000;
00033c  f8a09058          STRH     r9,[r0,#0x58]
;;;486    						mainswitch = 1;
000340  703d              STRB     r5,[r7,#0]
;;;487    						PowerCommWaitHandle(1,0);
000342  2100              MOVS     r1,#0
000344  2001              MOVS     r0,#1
000346  f7fffffe          BL       PowerCommWaitHandle
                  |L2.842|
;;;488    //						sendwait = 1;
;;;489    					}
;;;490    				}
;;;491    				if(reboot != 0)
00034a  6a70              LDR      r0,[r6,#0x24]  ; reboot
00034c  2800              CMP      r0,#0
00034e  d02a              BEQ      |L2.934|
;;;492    				{
;;;493    					reboot --;
000350  6a71              LDR      r1,[r6,#0x24]  ; reboot
000352  46b0              MOV      r8,r6
000354  1e49              SUBS     r1,r1,#1
000356  6271              STR      r1,[r6,#0x24]  ; reboot
;;;494    					if(reboot == 0)
000358  6a70              LDR      r0,[r6,#0x24]  ; reboot
00035a  2800              CMP      r0,#0
00035c  d123              BNE      |L2.934|
;;;495    					{
;;;496    						mainswitch = 0;
00035e  703c              STRB     r4,[r7,#0]
;;;497    						PowerCommWaitHandle(3,0);
000360  2100              MOVS     r1,#0
000362  2003              MOVS     r0,#3
000364  f7fffffe          BL       PowerCommWaitHandle
;;;498    //						sendwait = 3;
;;;499    //						Off_GPOI_ResetSet();
;;;500    						Para.CSET_Current_Laod =  Para.IR_Start_C;
000368  4e31              LDR      r6,|L2.1072|
00036a  6c70              LDR      r0,[r6,#0x44]  ; Para
00036c  6170              STR      r0,[r6,#0x14]  ; Para
;;;501    						LOAD_MODE = 0;
00036e  f8ca4018          STR      r4,[r10,#0x18]  ; Run_Control
;;;502    						GPIO_ResetBits(GPIOC,GPIO_Pin_12);//CC模式
000372  f44f5180          MOV      r1,#0x1000
000376  4837              LDR      r0,|L2.1108|
000378  f7fffffe          BL       GPIO_ResetBits
;;;503    						finishflag = 1;
00037c  4640              MOV      r0,r8
00037e  f8885002          STRB     r5,[r8,#2]
;;;504    						mainswitch = 0;
000382  703c              STRB     r4,[r7,#0]
;;;505    						if(Para.ACT_DELAY != 0)
000384  f8961052          LDRB     r1,[r6,#0x52]  ; Para
000388  b131              CBZ      r1,|L2.920|
;;;506    						{
;;;507    							finishdelay = 1000*Para.ACT_DELAY;
00038a  f8962052          LDRB     r2,[r6,#0x52]  ; Para
00038e  f44f717a          MOV      r1,#0x3e8
000392  fb12f101          SMULBB   r1,r2,r1
000396  e000              B        |L2.922|
                  |L2.920|
;;;508    						}else{
;;;509    							finishdelay = 1000;
000398  4649              MOV      r1,r9
                  |L2.922|
00039a  62c1              STR      r1,[r0,#0x2c]  ; finishdelay
;;;510    						}
;;;511    						TIM_SetCompare1(TIM1,33000/2);
00039c  f2440174          MOV      r1,#0x4074
0003a0  482e              LDR      r0,|L2.1116|
0003a2  f7fffffe          BL       TIM_SetCompare1
                  |L2.934|
0003a6  e1d2              B        |L2.1870|
                  |L2.936|
;;;512    //						finishdelay = 5000;
;;;513    					}
;;;514    				}
;;;515    			}
;;;516    			break;
;;;517    			
;;;518    //			//程控负载	
;;;519    //			case 2:{
;;;520    //				
;;;521    //				
;;;522    //			}
;;;523    //			break;
;;;524    			
;;;525    			//充放电
;;;526    			case 3:{
;;;527    				
;;;528    				
;;;529    			}
;;;530    			break;
;;;531    			//曲线图
;;;532    			case 4:{
;;;533    				
;;;534    				
;;;535    			}
;;;536    			break;
;;;537    			//充放电
;;;538    			case 5:{
;;;539    				if(rmtrig[2] == 1)
0003a8  4818              LDR      r0,|L2.1036|
0003aa  7880              LDRB     r0,[r0,#2]  ; rmtrig
0003ac  2801              CMP      r0,#1
0003ae  d1fa              BNE      |L2.934|
;;;540    				{
;;;541    					if( ms_time%1000 == 0 && ms_time > 999 ){
0003b0  f8d82010          LDR      r2,[r8,#0x10]  ; ms_time
0003b4  4649              MOV      r1,r9
0003b6  fbb2f0f1          UDIV     r0,r2,r1
0003ba  fb092010          MLS      r0,r9,r0,r2
;;;542    				
;;;543    						if( mode_sw == 1 ){
0003be  4e28              LDR      r6,|L2.1120|
0003c0  b980              CBNZ     r0,|L2.996|
0003c2  f8d82010          LDR      r2,[r8,#0x10]         ;541  ; ms_time
0003c6  4640              MOV      r0,r8                 ;541
0003c8  454a              CMP      r2,r9                 ;541
0003ca  d37b              BCC      |L2.1220|
0003cc  7831              LDRB     r1,[r6,#0]  ; mode_sw
0003ce  2901              CMP      r1,#1
0003d0  d048              BEQ      |L2.1124|
;;;544    							dctime++;	
;;;545    							ftemp = DISS_Current * 1000 * 1/3600;
;;;546    							CDC_DCsumMah += ftemp;	 
;;;547    							battery_c = CDC_DCsumMah;
;;;548    						}else if( mode_sw == 0 ){
0003d2  7831              LDRB     r1,[r6,#0]  ; mode_sw
0003d4  b139              CBZ      r1,|L2.998|
;;;549    							ctime++;
;;;550    //							DISS_POW_Current=(float)Para.CCurrent/100;	
;;;551    							ftemp = DISS_POW_Current * 1000 * 1/3600;
;;;552    							CDC_CsumMah += ftemp;
;;;553    							battery_c = CDC_CsumMah;
;;;554    						}else if(mode_sw == 2){
0003d6  7831              LDRB     r1,[r6,#0]  ; mode_sw
0003d8  2902              CMP      r1,#2
0003da  d065              BEQ      |L2.1192|
;;;555    							battery_c = CDC_CsumMah;
;;;556    						}else if(mode_sw == 3){
0003dc  7831              LDRB     r1,[r6,#0]  ; mode_sw
0003de  2903              CMP      r1,#3
0003e0  d065              BEQ      |L2.1198|
0003e2  e06c              B        |L2.1214|
                  |L2.996|
0003e4  e06e              B        |L2.1220|
                  |L2.998|
0003e6  e04e              B        |L2.1158|
                  |L2.1000|
0003e8  00000000          DCFS     0x00000000 ; 0
                  |L2.1004|
                          DCD      0x40000400
                  |L2.1008|
                          DCD      readpowflag
                  |L2.1012|
                          DCD      setpowflag
                  |L2.1016|
                          DCD      ||area_number.11||
                  |L2.1020|
                          DCD      0x7ffffffe
                  |L2.1024|
                          DCD      MODE
                  |L2.1028|
000404  45610000          DCFS     0x45610000 ; 3600
                  |L2.1032|
000408  447a0000          DCFS     0x447a0000 ; 1000
                  |L2.1036|
                          DCD      rmtrig
                  |L2.1040|
                          DCD      CDC_CsumMah
                  |L2.1044|
                          DCD      mainswitch
                  |L2.1048|
                          DCD      DISS_Current
                  |L2.1052|
                          DCD      Vmon_Load_value
                  |L2.1056|
                          DCD      ||.bss||
                  |L2.1060|
                          DCD      DISS_POW_Current
                  |L2.1064|
                          DCD      trig_flag_state
                  |L2.1068|
                          DCD      C_DISCHARGE
                  |L2.1072|
                          DCD      Para
                  |L2.1076|
                          DCD      old_I
                  |L2.1080|
                          DCD      max_discahrgeNum
                  |L2.1084|
                          DCD      0x3dcccccd
                  |L2.1088|
000440  42c80000          DCFS     0x42c80000 ; 100
                  |L2.1092|
                          DCD      0x3b03126f
                  |L2.1096|
                          DCD      DISS_Voltage
                  |L2.1100|
                          DCD      g_tModS
                  |L2.1104|
                          DCD      Run_Control
                  |L2.1108|
                          DCD      0x40020800
                  |L2.1112|
                          DCD      0x3ecccccd
                  |L2.1116|
                          DCD      0x40010000
                  |L2.1120|
                          DCD      mode_sw
                  |L2.1124|
000464  6b81              LDR      r1,[r0,#0x38]         ;544  ; dctime
000466  1c49              ADDS     r1,r1,#1              ;544
000468  6381              STR      r1,[r0,#0x38]         ;544  ; dctime
00046a  eddb0a00          VLDR     s1,[r11,#0]           ;545
00046e  ee201aa8          VMUL.F32 s2,s1,s17             ;545
000472  eec10a00          VDIV.F32 s1,s2,s0              ;545
000476  49fe              LDR      r1,|L2.2160|
000478  ed910a00          VLDR     s0,[r1,#0]            ;546
00047c  ee300a20          VADD.F32 s0,s0,s1              ;546
000480  ed810a00          VSTR     s0,[r1,#0]            ;546
000484  e016              B        |L2.1204|
                  |L2.1158|
000486  6b41              LDR      r1,[r0,#0x34]         ;549  ; ctime
000488  1c49              ADDS     r1,r1,#1              ;549
00048a  6341              STR      r1,[r0,#0x34]         ;549  ; ctime
00048c  49f9              LDR      r1,|L2.2164|
00048e  edd10a00          VLDR     s1,[r1,#0]            ;551
000492  ee201aa8          VMUL.F32 s2,s1,s17             ;551
000496  eec10a00          VDIV.F32 s1,s2,s0              ;551
00049a  ed9a0a00          VLDR     s0,[r10,#0]           ;552
00049e  ee300a20          VADD.F32 s0,s0,s1              ;552
0004a2  ed8a0a00          VSTR     s0,[r10,#0]           ;552
0004a6  e005              B        |L2.1204|
                  |L2.1192|
0004a8  ed9a0a00          VLDR     s0,[r10,#0]           ;555
0004ac  e002              B        |L2.1204|
                  |L2.1198|
;;;557    							battery_c = CDC_DCsumMah;
0004ae  49f0              LDR      r1,|L2.2160|
0004b0  ed910a00          VLDR     s0,[r1,#0]
                  |L2.1204|
0004b4  eebc0ac0          VCVT.U32.F32 s0,s0
0004b8  ee101a10          VMOV     r1,s0
0004bc  6301              STR      r1,[r0,#0x30]  ; battery_c
                  |L2.1214|
;;;558    						}
;;;559    						SendToPC(2);
0004be  2002              MOVS     r0,#2
0004c0  f7fffffe          BL       SendToPC
                  |L2.1220|
;;;560    						
;;;561    						
;;;562    					}
;;;563    					if(mode_sw == 0)
0004c4  48ec              LDR      r0,|L2.2168|
0004c6  7801              LDRB     r1,[r0,#0]  ; mode_sw
;;;564    					{
;;;565    						if(sendmodeflag == 1)
0004c8  48ec              LDR      r0,|L2.2172|
0004ca  b171              CBZ      r1,|L2.1258|
;;;566    						{
;;;567    							for(i=0;i<3;i++)
;;;568    							{
;;;569    								MODS_SendWithCRC(sendmodepow,6);
;;;570    								Delay_ms(SENDPCDELAY);
;;;571    							}
;;;572    							sendmodeflag = 0;
;;;573    						}
;;;574    						if(cdcswdelay != 0)
;;;575    						{
;;;576    							cdcswdelay --;
;;;577    						}
;;;578    						if(Para.CaPCTIME == 0)
;;;579    						{
;;;580    //							if(charge_step == 1)
;;;581    //							{
;;;582    //								if(Para.CPOW_Voltage*10 >= Para.CDC_Ccutoff_V && Para.CDC_Ccutoff_V != 0 && cdcswdelay == 0)
;;;583    //								{
;;;584    //									Para.CSET_Voltage = Para.CDC_Ccutoff_V;
;;;585    //									charge_step = 2;
;;;586    //									cdcswdelay = 5000;
;;;587    //								}
;;;588    //							}else if(charge_step == 2){
;;;589    								if(Para.CCurrent*10 < Para.CDC_Ccutoff_C && Para.CDC_Ccutoff_C != 0 && cdcswdelay == 0)
;;;590    								{
;;;591    									charge_step = 1;
;;;592    	//								GPIO_ResetBits(GPIOC,GPIO_Pin_1); //关闭电源输出
;;;593    	//								Para.CSET_Voltage = 0;
;;;594    	//								Para.CSET_Current = 0;
;;;595    	//								GPIO_ResetBits(GPIOE,GPIO_Pin_2); //关闭电源输出继电器
;;;596    									mainswitch = 0;
;;;597    									ctime=0;
;;;598    									PowerCommWaitHandle(1,1);
;;;599    //									listsend = 1;
;;;600    									mode_sw = 2;
;;;601    //									mode_sw = 1;
;;;602    									sendmodeflag = 1;
;;;603    									capwait = Para.CDC_Gap_Time*1000;
;;;604    //									cdcswdelay = 5000;
;;;605    								}
;;;606    //							}
;;;607    						}else{
;;;608    							if(ctime >= Para.CaPCTIME && cdcswdelay == 0)
;;;609    							{
;;;610    								charge_step = 1;
;;;611    //								GPIO_ResetBits(GPIOC,GPIO_Pin_1); //关闭电源输出
;;;612    //								Para.CSET_Voltage = 0;
;;;613    //								Para.CSET_Current = 0;
;;;614    //								GPIO_ResetBits(GPIOE,GPIO_Pin_2); //关闭电源输出继电器
;;;615    								mainswitch = 0;
;;;616    								ctime=0;
;;;617    								PowerCommWaitHandle(1,1);
;;;618    //								listsend = 1;
;;;619    								mode_sw = 2;
;;;620    //									mode_sw = 1;
;;;621    								sendmodeflag = 1;
;;;622    								capwait = Para.CDC_Gap_Time*1000;
;;;623    //									cdcswdelay = 5000;
;;;624    							}
;;;625    						}
;;;626    					}else if(mode_sw == 1){//放电
0004cc  49ea              LDR      r1,|L2.2168|
0004ce  7809              LDRB     r1,[r1,#0]  ; mode_sw
0004d0  2901              CMP      r1,#1
0004d2  d049              BEQ      |L2.1384|
;;;627    						if(sendmodeflag == 1)
;;;628    						{
;;;629    							for(i=0;i<3;i++)
;;;630    							{
;;;631    								MODS_SendWithCRC(sendmodeload,6);
;;;632    								Delay_ms(SENDPCDELAY);
;;;633    							}
;;;634    							sendmodeflag = 0;
;;;635    							Delay_ms(100);
;;;636    							Flag_Swtich_ON = 1;
;;;637    							GPIO_ResetBits(GPIOC,GPIO_Pin_7);//On
;;;638    						}
;;;639    						if(cdcswdelay != 0)
;;;640    						{
;;;641    							cdcswdelay --;
;;;642    						}
;;;643    						if(Para.CaPDCTIME == 0)
;;;644    						{
;;;645    							if(Para.CVoltage < Para.CDC_Dcutoff_V && cdcswdelay == 0)
;;;646    							{
;;;647    								Flag_Swtich_ON = 0;
;;;648    								GPIO_SetBits(GPIOC,GPIO_Pin_7);//OFF
;;;649    								if(loop == Para.CDC_Cycle_Time)
;;;650    								{
;;;651    									loop = 1;
;;;652    									battery_c = battery_c/Para.CDC_Cycle_Time;
;;;653    									for(i=0;i<3;i++)
;;;654    									{
;;;655    										if(rmtrig[2] == 1)
;;;656    										{
;;;657    	//										SendToPC(2);
;;;658    										}
;;;659    										Delay_ms(SENDPCDELAY);
;;;660    										MODS_SendWithCRC(sendmodestop,6);
;;;661    										Delay_ms(SENDPCDELAY);
;;;662    									}
;;;663    									rmtrig[2] = 0;
;;;664    									CDC_CsumMah = 0;
;;;665    									CDC_DCsumMah = 0;
;;;666    									dctime = 0;
;;;667    								}else{
;;;668    	//								CDC_CsumMah = 0;
;;;669    	//								CDC_DCsumMah = 0;
;;;670    									Flag_Swtich_ON = 0;
;;;671    									GPIO_SetBits(GPIOC,GPIO_Pin_7);//OFF
;;;672    									Delay_ms(100);
;;;673    									dctime = 0;
;;;674    									mode_sw = 3;
;;;675    									sendmodeflag = 1;
;;;676    									capwait = Para.CDC_Gap_Time*1000;
;;;677    //									mode_sw = 0;
;;;678    	//								GPIO_SetBits(GPIOE,GPIO_Pin_2);   //打开电源输出继电器
;;;679    	//								Para.CSET_Voltage = Para.CDC_OutPut_V;
;;;680    	//								Para.CSET_Current = Para.CDC_Limit_C;
;;;681    	//								GPIO_SetBits(GPIOC,GPIO_Pin_1);   //打开电源输出
;;;682    //									mainswitch = 1;
;;;683    //									listsend = 1;
;;;684    //									sendmodeflag = 1;
;;;685    //									charge_step = 1;
;;;686    //									cdcswdelay = 5000;
;;;687    //									loop ++;	
;;;688    								}
;;;689    							}
;;;690    						}else{
;;;691    							if(dctime >= Para.CaPDCTIME && cdcswdelay == 0)
;;;692    							{
;;;693    								Flag_Swtich_ON = 0;
;;;694    								GPIO_SetBits(GPIOC,GPIO_Pin_7);//OFF
;;;695    								if(loop == Para.CDC_Cycle_Time)
;;;696    								{
;;;697    									loop = 1;
;;;698    									battery_c = battery_c/Para.CDC_Cycle_Time;
;;;699    									for(i=0;i<3;i++)
;;;700    									{
;;;701    										if(rmtrig[2] == 1)
;;;702    										{
;;;703    	//										SendToPC(2);
;;;704    										}
;;;705    										Delay_ms(SENDPCDELAY);
;;;706    										MODS_SendWithCRC(sendmodestop,6);
;;;707    										Delay_ms(SENDPCDELAY);
;;;708    									}
;;;709    									rmtrig[2] = 0;
;;;710    									CDC_CsumMah = 0;
;;;711    									CDC_DCsumMah = 0;
;;;712    									dctime = 0;
;;;713    								}else{
;;;714    	//								CDC_CsumMah = 0;
;;;715    	//								CDC_DCsumMah = 0;
;;;716    									Flag_Swtich_ON = 0;
;;;717    									GPIO_SetBits(GPIOC,GPIO_Pin_7);//OFF
;;;718    									Delay_ms(100);
;;;719    									dctime = 0;
;;;720    									mode_sw = 3;
;;;721    									sendmodeflag = 1;
;;;722    									capwait = Para.CDC_Gap_Time*1000;
;;;723    //									mode_sw = 0;
;;;724    	//								GPIO_SetBits(GPIOE,GPIO_Pin_2);   //打开电源输出继电器
;;;725    	//								Para.CSET_Voltage = Para.CDC_OutPut_V;
;;;726    	//								Para.CSET_Current = Para.CDC_Limit_C;
;;;727    	//								GPIO_SetBits(GPIOC,GPIO_Pin_1);   //打开电源输出
;;;728    //									mainswitch = 1;
;;;729    //									listsend = 1;
;;;730    //									sendmodeflag = 1;
;;;731    //									charge_step = 1;
;;;732    //									cdcswdelay = 5000;
;;;733    //									loop ++;	
;;;734    								}
;;;735    							}
;;;736    						}
;;;737    					}else if(mode_sw == 2){//充电搁置
0004d4  f8dfa3a0          LDR      r10,|L2.2168|
0004d8  f89a1000          LDRB     r1,[r10,#0]  ; mode_sw
0004dc  2902              CMP      r1,#2
0004de  d075              BEQ      |L2.1484|
;;;738    						if(sendmodeflag == 1)
;;;739    						{
;;;740    							for(i=0;i<3;i++)
;;;741    							{
;;;742    								MODS_SendWithCRC(sendmodegap,6);
;;;743    								Delay_ms(SENDPCDELAY);
;;;744    								
;;;745    							}
;;;746    							sendmodeflag = 0;
;;;747    						}
;;;748    						if(capwait == 0)
;;;749    						{
;;;750    							mainswitch = 1;
;;;751    							mode_sw = 1;
;;;752    							sendmodeflag = 1;
;;;753    							cdcswdelay = 5000;
;;;754    						}else{
;;;755    							capwait --;
;;;756    						}
;;;757    					}else if(mode_sw == 3){//放电搁置
0004e0  4651              MOV      r1,r10
0004e2  7809              LDRB     r1,[r1,#0]  ; mode_sw
0004e4  2903              CMP      r1,#3
0004e6  d072              BEQ      |L2.1486|
                  |L2.1256|
0004e8  e131              B        |L2.1870|
                  |L2.1258|
0004ea  4682              MOV      r10,r0                ;565
0004ec  7800              LDRB     r0,[r0,#0]            ;565  ; sendmodeflag
0004ee  2801              CMP      r0,#1                 ;565
0004f0  d10d              BNE      |L2.1294|
0004f2  2600              MOVS     r6,#0                 ;567
                  |L2.1268|
0004f4  2106              MOVS     r1,#6                 ;569
0004f6  48e2              LDR      r0,|L2.2176|
0004f8  f7fffffe          BL       MODS_SendWithCRC
0004fc  2096              MOVS     r0,#0x96              ;570
0004fe  f7fffffe          BL       Delay_ms
000502  1c76              ADDS     r6,r6,#1              ;570
000504  b2f6              UXTB     r6,r6                 ;567
000506  2e03              CMP      r6,#3                 ;567
000508  d3f4              BCC      |L2.1268|
00050a  f88a4000          STRB     r4,[r10,#0]           ;572
                  |L2.1294|
00050e  f8b80006          LDRH     r0,[r8,#6]            ;574  ; cdcswdelay
000512  4646              MOV      r6,r8                 ;574
000514  b108              CBZ      r0,|L2.1306|
000516  1e40              SUBS     r0,r0,#1              ;574
000518  80f0              STRH     r0,[r6,#6]            ;576
                  |L2.1306|
00051a  48da              LDR      r0,|L2.2180|
00051c  f8d010a8          LDR      r1,[r0,#0xa8]         ;578  ; Para
000520  b129              CBZ      r1,|L2.1326|
000522  f8d000a8          LDR      r0,[r0,#0xa8]         ;608  ; Para
000526  6b71              LDR      r1,[r6,#0x34]         ;608  ; ctime
000528  4288              CMP      r0,r1                 ;608
00052a  d90d              BLS      |L2.1352|
00052c  e10f              B        |L2.1870|
                  |L2.1326|
00052e  f8b01078          LDRH     r1,[r0,#0x78]         ;589  ; Para
000532  6b02              LDR      r2,[r0,#0x30]         ;589  ; Para
000534  eb020282          ADD      r2,r2,r2,LSL #2       ;589
000538  ebb10f42          CMP      r1,r2,LSL #1          ;589
00053c  d9d4              BLS      |L2.1256|
00053e  48d1              LDR      r0,|L2.2180|
000540  f8b00078          LDRH     r0,[r0,#0x78]         ;589  ; Para
000544  2800              CMP      r0,#0                 ;589
000546  d0cf              BEQ      |L2.1256|
                  |L2.1352|
000548  88f0              LDRH     r0,[r6,#6]            ;589  ; cdcswdelay
00054a  2800              CMP      r0,#0                 ;589
00054c  d1cc              BNE      |L2.1256|
00054e  70f5              STRB     r5,[r6,#3]            ;610
000550  703c              STRB     r4,[r7,#0]            ;615
000552  6374              STR      r4,[r6,#0x34]         ;616  ; ctime
000554  2101              MOVS     r1,#1                 ;617
000556  4608              MOV      r0,r1                 ;617
000558  f7fffffe          BL       PowerCommWaitHandle
00055c  49c6              LDR      r1,|L2.2168|
00055e  2002              MOVS     r0,#2                 ;619
000560  7008              STRB     r0,[r1,#0]            ;619
000562  f88a5000          STRB     r5,[r10,#0]           ;621
000566  e082              B        |L2.1646|
                  |L2.1384|
000568  48c4              LDR      r0,|L2.2172|
00056a  7800              LDRB     r0,[r0,#0]            ;627  ; sendmodeflag
00056c  2801              CMP      r0,#1                 ;627
00056e  d11a              BNE      |L2.1446|
000570  2600              MOVS     r6,#0                 ;629
                  |L2.1394|
000572  48c3              LDR      r0,|L2.2176|
000574  2106              MOVS     r1,#6                 ;631
000576  1d80              ADDS     r0,r0,#6              ;631
000578  f7fffffe          BL       MODS_SendWithCRC
00057c  2096              MOVS     r0,#0x96              ;632
00057e  f7fffffe          BL       Delay_ms
000582  1c76              ADDS     r6,r6,#1              ;632
000584  b2f6              UXTB     r6,r6                 ;629
000586  2e03              CMP      r6,#3                 ;629
000588  d3f3              BCC      |L2.1394|
00058a  48bc              LDR      r0,|L2.2172|
00058c  7004              STRB     r4,[r0,#0]            ;634
00058e  2064              MOVS     r0,#0x64              ;635
000590  f7fffffe          BL       Delay_ms
000594  48bc              LDR      r0,|L2.2184|
000596  6801              LDR      r1,[r0,#0]            ;636  ; flagA
000598  f0410140          ORR      r1,r1,#0x40           ;636
00059c  6001              STR      r1,[r0,#0]            ;637  ; flagA
00059e  2180              MOVS     r1,#0x80              ;637
0005a0  48ba              LDR      r0,|L2.2188|
0005a2  f7fffffe          BL       GPIO_ResetBits
                  |L2.1446|
0005a6  f8b81006          LDRH     r1,[r8,#6]            ;639  ; cdcswdelay
0005aa  4640              MOV      r0,r8                 ;639
0005ac  b109              CBZ      r1,|L2.1458|
0005ae  1e49              SUBS     r1,r1,#1              ;639
0005b0  80c1              STRH     r1,[r0,#6]            ;641
                  |L2.1458|
0005b2  4eb4              LDR      r6,|L2.2180|
0005b4  f8d610ac          LDR      r1,[r6,#0xac]         ;643  ; Para
0005b8  b151              CBZ      r1,|L2.1488|
0005ba  f8d610ac          LDR      r1,[r6,#0xac]         ;691  ; Para
0005be  6b82              LDR      r2,[r0,#0x38]         ;691  ; dctime
0005c0  4291              CMP      r1,r2                 ;691
0005c2  d802              BHI      |L2.1482|
0005c4  f8b80006          LDRH     r0,[r8,#6]            ;691  ; cdcswdelay
0005c8  b3f0              CBZ      r0,|L2.1608|
                  |L2.1482|
0005ca  e0c0              B        |L2.1870|
                  |L2.1484|
0005cc  e080              B        |L2.1744|
                  |L2.1486|
0005ce  e0a4              B        |L2.1818|
                  |L2.1488|
0005d0  6af1              LDR      r1,[r6,#0x2c]         ;645  ; Para
0005d2  f8d62080          LDR      r2,[r6,#0x80]         ;645  ; Para
0005d6  4291              CMP      r1,r2                 ;645
0005d8  d235              BCS      |L2.1606|
0005da  f8b80006          LDRH     r0,[r8,#6]            ;645  ; cdcswdelay
0005de  2800              CMP      r0,#0                 ;645
0005e0  d131              BNE      |L2.1606|
0005e2  48a9              LDR      r0,|L2.2184|
0005e4  6801              LDR      r1,[r0,#0]            ;647  ; flagA
0005e6  f0210140          BIC      r1,r1,#0x40           ;647
0005ea  6001              STR      r1,[r0,#0]            ;648  ; flagA
0005ec  2180              MOVS     r1,#0x80              ;648
0005ee  48a7              LDR      r0,|L2.2188|
0005f0  f7fffffe          BL       GPIO_SetBits
0005f4  48a3              LDR      r0,|L2.2180|
0005f6  f8900084          LDRB     r0,[r0,#0x84]         ;649  ; Para
0005fa  f8981004          LDRB     r1,[r8,#4]            ;649  ; loop
0005fe  4646              MOV      r6,r8                 ;649
000600  4288              CMP      r0,r1                 ;649
000602  d122              BNE      |L2.1610|
000604  7135              STRB     r5,[r6,#4]            ;651
000606  499f              LDR      r1,|L2.2180|
000608  f8911084          LDRB     r1,[r1,#0x84]         ;652  ; Para
00060c  6b32              LDR      r2,[r6,#0x30]         ;652  ; battery_c
00060e  fbb2f1f1          UDIV     r1,r2,r1              ;652
000612  6331              STR      r1,[r6,#0x30]         ;652  ; battery_c
000614  2600              MOVS     r6,#0                 ;653
                  |L2.1558|
000616  2096              MOVS     r0,#0x96              ;659
000618  f7fffffe          BL       Delay_ms
00061c  4898              LDR      r0,|L2.2176|
00061e  2106              MOVS     r1,#6                 ;660
000620  300c              ADDS     r0,r0,#0xc            ;660
000622  f7fffffe          BL       MODS_SendWithCRC
000626  2096              MOVS     r0,#0x96              ;661
000628  f7fffffe          BL       Delay_ms
00062c  1c76              ADDS     r6,r6,#1              ;661
00062e  b2f6              UXTB     r6,r6                 ;653
000630  2e03              CMP      r6,#3                 ;653
000632  d3f0              BCC      |L2.1558|
                  |L2.1588|
000634  4896              LDR      r0,|L2.2192|
000636  7084              STRB     r4,[r0,#2]            ;663
000638  488d              LDR      r0,|L2.2160|
00063a  ed8a8a00          VSTR     s16,[r10,#0]          ;664
00063e  ed808a00          VSTR     s16,[r0,#0]           ;665
000642  f8c84038          STR      r4,[r8,#0x38]         ;666  ; dctime
                  |L2.1606|
000646  e082              B        |L2.1870|
                  |L2.1608|
000648  e018              B        |L2.1660|
                  |L2.1610|
00064a  488f              LDR      r0,|L2.2184|
00064c  6801              LDR      r1,[r0,#0]            ;670  ; flagA
00064e  f0210140          BIC      r1,r1,#0x40           ;670
000652  6001              STR      r1,[r0,#0]            ;671  ; flagA
000654  2180              MOVS     r1,#0x80              ;671
000656  488d              LDR      r0,|L2.2188|
000658  f7fffffe          BL       GPIO_SetBits
00065c  2064              MOVS     r0,#0x64              ;672
00065e  f7fffffe          BL       Delay_ms
000662  63b4              STR      r4,[r6,#0x38]         ;673  ; dctime
000664  4984              LDR      r1,|L2.2168|
000666  2003              MOVS     r0,#3                 ;674
000668  7008              STRB     r0,[r1,#0]            ;674
00066a  4884              LDR      r0,|L2.2172|
00066c  7005              STRB     r5,[r0,#0]            ;675
                  |L2.1646|
00066e  4885              LDR      r0,|L2.2180|
000670  f8b00086          LDRH     r0,[r0,#0x86]         ;622  ; Para
000674  f44f717a          MOV      r1,#0x3e8             ;622
000678  4348              MULS     r0,r1,r0              ;622
00067a  e067              B        |L2.1868|
                  |L2.1660|
00067c  4882              LDR      r0,|L2.2184|
00067e  6801              LDR      r1,[r0,#0]            ;693  ; flagA
000680  f0210140          BIC      r1,r1,#0x40           ;693
000684  6001              STR      r1,[r0,#0]            ;694  ; flagA
000686  2180              MOVS     r1,#0x80              ;694
000688  4880              LDR      r0,|L2.2188|
00068a  f7fffffe          BL       GPIO_SetBits
00068e  487d              LDR      r0,|L2.2180|
000690  f8900084          LDRB     r0,[r0,#0x84]         ;695  ; Para
000694  f8981004          LDRB     r1,[r8,#4]            ;695  ; loop
000698  4646              MOV      r6,r8                 ;695
00069a  4288              CMP      r0,r1                 ;695
00069c  d1d5              BNE      |L2.1610|
00069e  7135              STRB     r5,[r6,#4]            ;697
0006a0  4978              LDR      r1,|L2.2180|
0006a2  f8911084          LDRB     r1,[r1,#0x84]         ;698  ; Para
0006a6  6b32              LDR      r2,[r6,#0x30]         ;698  ; battery_c
0006a8  fbb2f1f1          UDIV     r1,r2,r1              ;698
0006ac  6331              STR      r1,[r6,#0x30]         ;698  ; battery_c
0006ae  2600              MOVS     r6,#0                 ;699
                  |L2.1712|
0006b0  2096              MOVS     r0,#0x96              ;705
0006b2  f7fffffe          BL       Delay_ms
0006b6  4872              LDR      r0,|L2.2176|
0006b8  2106              MOVS     r1,#6                 ;706
0006ba  300c              ADDS     r0,r0,#0xc            ;706
0006bc  f7fffffe          BL       MODS_SendWithCRC
0006c0  2096              MOVS     r0,#0x96              ;707
0006c2  f7fffffe          BL       Delay_ms
0006c6  1c76              ADDS     r6,r6,#1              ;707
0006c8  b2f6              UXTB     r6,r6                 ;699
0006ca  2e03              CMP      r6,#3                 ;699
0006cc  d3f0              BCC      |L2.1712|
0006ce  e7b1              B        |L2.1588|
                  |L2.1744|
0006d0  486a              LDR      r0,|L2.2172|
0006d2  7800              LDRB     r0,[r0,#0]            ;738  ; sendmodeflag
0006d4  2801              CMP      r0,#1                 ;738
0006d6  d10e              BNE      |L2.1782|
0006d8  2600              MOVS     r6,#0                 ;740
                  |L2.1754|
0006da  4869              LDR      r0,|L2.2176|
0006dc  2106              MOVS     r1,#6                 ;742
0006de  3012              ADDS     r0,r0,#0x12           ;742
0006e0  f7fffffe          BL       MODS_SendWithCRC
0006e4  2096              MOVS     r0,#0x96              ;743
0006e6  f7fffffe          BL       Delay_ms
0006ea  1c76              ADDS     r6,r6,#1              ;743
0006ec  b2f6              UXTB     r6,r6                 ;740
0006ee  2e03              CMP      r6,#3                 ;740
0006f0  d3f3              BCC      |L2.1754|
0006f2  4862              LDR      r0,|L2.2172|
0006f4  7004              STRB     r4,[r0,#0]            ;746
                  |L2.1782|
0006f6  f8d8103c          LDR      r1,[r8,#0x3c]         ;748  ; capwait
0006fa  4640              MOV      r0,r8                 ;748
0006fc  b119              CBZ      r1,|L2.1798|
0006fe  6bc1              LDR      r1,[r0,#0x3c]         ;755  ; capwait
000700  1e49              SUBS     r1,r1,#1              ;755
000702  63c1              STR      r1,[r0,#0x3c]         ;755  ; capwait
000704  e023              B        |L2.1870|
                  |L2.1798|
000706  703d              STRB     r5,[r7,#0]            ;750
000708  f88a5000          STRB     r5,[r10,#0]           ;751
00070c  495b              LDR      r1,|L2.2172|
00070e  700d              STRB     r5,[r1,#0]            ;752
000710  f2413188          MOV      r1,#0x1388            ;753
000714  f8a81006          STRH     r1,[r8,#6]            ;753
000718  e019              B        |L2.1870|
                  |L2.1818|
;;;758    						if(sendmodeflag == 1)
00071a  4682              MOV      r10,r0
00071c  7800              LDRB     r0,[r0,#0]  ; sendmodeflag
00071e  2801              CMP      r0,#1
000720  d10e              BNE      |L2.1856|
;;;759    						{
;;;760    							for(i=0;i<3;i++)
000722  2600              MOVS     r6,#0
                  |L2.1828|
;;;761    							{
;;;762    								MODS_SendWithCRC(sendmodegap,6);
000724  4856              LDR      r0,|L2.2176|
000726  2106              MOVS     r1,#6
000728  3012              ADDS     r0,r0,#0x12
00072a  f7fffffe          BL       MODS_SendWithCRC
;;;763    								Delay_ms(SENDPCDELAY);
00072e  2096              MOVS     r0,#0x96
000730  f7fffffe          BL       Delay_ms
000734  1c76              ADDS     r6,r6,#1
000736  b2f6              UXTB     r6,r6                 ;760
000738  2e03              CMP      r6,#3                 ;760
00073a  d3f3              BCC      |L2.1828|
;;;764    								
;;;765    							}
;;;766    							sendmodeflag = 0;
00073c  f88a4000          STRB     r4,[r10,#0]
                  |L2.1856|
;;;767    						}
;;;768    						if(capwait == 0)
000740  f8d8003c          LDR      r0,[r8,#0x3c]  ; capwait
000744  4646              MOV      r6,r8
000746  b160              CBZ      r0,|L2.1890|
;;;769    						{
;;;770    							mode_sw = 0;
;;;771    							mainswitch = 1;
;;;772    							PowerCommWaitHandle(1,1);
;;;773    //							listsend = 1;
;;;774    							sendmodeflag = 1;
;;;775    							charge_step = 1;
;;;776    							charge_step = 1;
;;;777    							cdcswdelay = 5000;
;;;778    							loop ++;
;;;779    						}else{
;;;780    							capwait --;
000748  6bf0              LDR      r0,[r6,#0x3c]  ; capwait
00074a  1e40              SUBS     r0,r0,#1
                  |L2.1868|
00074c  63f0              STR      r0,[r6,#0x3c]  ; capwait
                  |L2.1870|
;;;781    						}
;;;782    					}
;;;783    				}
;;;784    			}	
;;;785    			break;
;;;786    			
;;;787    			//系统信息
;;;788    			case 6:{
;;;789    				
;;;790    				
;;;791    			}  	  
;;;792    			break;
;;;793    		}
;;;794    		
;;;795    		if( ms_time % 1000 == 0 && ms_time > 999 )
00074e  f8d81010          LDR      r1,[r8,#0x10]  ; ms_time
000752  4646              MOV      r6,r8
000754  4648              MOV      r0,r9
000756  fbb1f2f0          UDIV     r2,r1,r0
00075a  fb091112          MLS      r1,r9,r2,r1
00075e  b191              CBZ      r1,|L2.1926|
000760  e017              B        |L2.1938|
                  |L2.1890|
000762  4845              LDR      r0,|L2.2168|
000764  7004              STRB     r4,[r0,#0]            ;770
000766  703d              STRB     r5,[r7,#0]            ;771
000768  2101              MOVS     r1,#1                 ;772
00076a  4608              MOV      r0,r1                 ;772
00076c  f7fffffe          BL       PowerCommWaitHandle
000770  f88a5000          STRB     r5,[r10,#0]           ;774
000774  70f5              STRB     r5,[r6,#3]            ;775
000776  70f5              STRB     r5,[r6,#3]            ;776
000778  f2413088          MOV      r0,#0x1388            ;777
00077c  80f0              STRH     r0,[r6,#6]            ;777
00077e  7930              LDRB     r0,[r6,#4]            ;778  ; loop
000780  1c40              ADDS     r0,r0,#1              ;778
000782  7130              STRB     r0,[r6,#4]            ;778
000784  e7e3              B        |L2.1870|
                  |L2.1926|
000786  6931              LDR      r1,[r6,#0x10]  ; ms_time
000788  4549              CMP      r1,r9
00078a  d302              BCC      |L2.1938|
;;;796    			
;;;797    			abc_time++; 
00078c  68f0              LDR      r0,[r6,#0xc]  ; abc_time
00078e  1c40              ADDS     r0,r0,#1
000790  60f0              STR      r0,[r6,#0xc]  ; abc_time
                  |L2.1938|
;;;798    	
;;;799    		ms_time++;
000792  6930              LDR      r0,[r6,#0x10]  ; ms_time
000794  1c40              ADDS     r0,r0,#1
000796  6130              STR      r0,[r6,#0x10]  ; ms_time
;;;800    		if(calflag == 0)
000798  483e              LDR      r0,|L2.2196|
00079a  7800              LDRB     r0,[r0,#0]  ; calflag
00079c  b358              CBZ      r0,|L2.2038|
;;;801    		{
;;;802    			PPower = DISS_POW_Voltage * DISS_POW_Current;
;;;803    			LPower = DISS_Voltage * DISS_Current;
;;;804    		}else{
;;;805    			PPower=0;
00079e  eeb00a48          VMOV.F32 s0,s16
                  |L2.1954|
;;;806    			LPower=0;
;;;807    		}
;;;808    //		if((PPower > 80) || (LPower > 80))
;;;809    //		{
;;;810    //			Off_GPOI_ResetSet();
;;;811    //			shutcount1 = 0;
;;;812    //			shutcount2 = 0;
;;;813    //			mainswitch = 0;
;;;814    //		}
;;;815    //		if((PPower >= 300) || (LPower >= 600))
;;;816    //		{
;;;817    //			shutcount3++;
;;;818    //			if(shutcount3 >= 500)
;;;819    //			{
;;;820    //				Off_GPOI_ResetSet();
;;;821    //				shutcount1 = 0;
;;;822    //				shutcount2 = 0;
;;;823    //				shutcount3 = 0;
;;;824    //				mainswitch = 0;
;;;825    //			}
;;;826    //		}else if((PPower > 100 && PPower < 200) || (LPower > 500 && LPower < 600)){
;;;827    //			shutcount1 ++;
;;;828    //			if(shutcount1 >= 180000)
;;;829    //			{
;;;830    //				Off_GPOI_ResetSet();
;;;831    //				mainswitch = 0;
;;;832    //				shutcount1 = 0;
;;;833    //			}			
;;;834    //		}else if((PPower >= 200 && PPower < 300) || (LPower >= 500 && LPower < 600)){
;;;835    //			shutcount2 ++;
;;;836    //			if(shutcount2 >= 10000)
;;;837    //			{
;;;838    //				Off_GPOI_ResetSet();
;;;839    //				mainswitch = 0;
;;;840    //				shutcount2 = 0;
;;;841    //			}
;;;842    //		}else{
;;;843    //			shutcount1 = 0;
;;;844    //			shutcount2 = 0;
;;;845    //			shutcount3 = 0;
;;;846    //		}
;;;847    //		if(HARDVER == 1)
;;;848    //		{
;;;849    //			if(MODE != 2)
;;;850    //			{
;;;851    //				if((PPower >= 600) || (LPower >= 1800) || (DISS_Current >= 100))
;;;852    //				{
;;;853    //					shutcount3++;
;;;854    //					if(shutcount3 >= 500)
;;;855    //					{
;;;856    //						overflag = 1;
;;;857    //						Off_GPOI_ResetSet();
;;;858    //	//					shutcount1 = 0;
;;;859    //	//					shutcount2 = 0;
;;;860    //						shutcount3 = 0;
;;;861    //						mainswitch = 0;
;;;862    //					}
;;;863    //				}else{
;;;864    //	//				shutcount1 = 0;
;;;865    //	//				shutcount2 = 0;
;;;866    //					shutcount3 = 0;
;;;867    //				}
;;;868    //				if(DISS_Current > 60 && DISS_Current < 100)
;;;869    //				{
;;;870    //					shutcount4 ++;
;;;871    //					if(shutcount4 >= 20000)
;;;872    //					{
;;;873    //						overflag = 1;
;;;874    //						Off_GPOI_ResetSet();
;;;875    //						mainswitch = 0;
;;;876    //						shutcount1 = 0;
;;;877    //					}
;;;878    //				}else{
;;;879    //					shutcount4 = 0;
;;;880    //				}
;;;881    //			}else{
;;;882    //				if((PPower >= 600) || (LPower >= 3600) || DISS_Current >= 160)
;;;883    //				{
;;;884    //					shutcount3++;
;;;885    //					if(shutcount3 >= 500)
;;;886    //					{
;;;887    //						overflag = 1;
;;;888    //						Off_GPOI_ResetSet();
;;;889    //	//					shutcount1 = 0;
;;;890    //	//					shutcount2 = 0;
;;;891    //						shutcount3 = 0;
;;;892    //						mainswitch = 0;
;;;893    //					}
;;;894    //				}else{
;;;895    //	//				shutcount1 = 0;
;;;896    //	//				shutcount2 = 0;
;;;897    //					shutcount3 = 0;
;;;898    //				}
;;;899    //				if(DISS_Current > 60 && DISS_Current < 160)
;;;900    //				{
;;;901    //					shutcount4 ++;
;;;902    //					if(shutcount4 >= 2000)
;;;903    //					{
;;;904    //						overflag = 1;
;;;905    //						Off_GPOI_ResetSet();
;;;906    //						mainswitch = 0;
;;;907    //						shutcount4 = 0;
;;;908    //					}
;;;909    //				}else{
;;;910    //					shutcount4 = 0;
;;;911    //	//				shutcount2 = 0;
;;;912    //	//				shutcount3 = 0;
;;;913    //				}
;;;914    //			}
;;;915    //		}else if(HARDVER == 2){
;;;916    			if(MODE != 2)
0007a2  483d              LDR      r0,|L2.2200|
0007a4  7800              LDRB     r0,[r0,#0]  ; MODE
;;;917    			{
;;;918    
;;;919    				if((PPower >= 1200) || (LPower >= 1800) || (DISS_Current >= 120))
0007a6  4a3d              LDR      r2,|L2.2204|
0007a8  2802              CMP      r0,#2                 ;916
;;;920    				{
;;;921    					shutcount3++;
;;;922    					shutcount2++;
;;;923    					if(shutcount3 >= 500)
;;;924    					{
;;;925    						overflag = 1;
;;;926    						Off_GPOI_ResetSet();
;;;927    	//					shutcount1 = 0;
;;;928    	//					shutcount2 = 0;
;;;929    						shutcount3 = 0;
;;;930    						shutcount2 = 0;
;;;931    						mainswitch = 0;
;;;932    					}
;;;933    				}else{
;;;934    	//				shutcount1 = 0;
;;;935    	//				shutcount2 = 0;
;;;936    						shutcount3 = 0;
;;;937    				}
;;;938    				if(DISS_Current >= 100 && DISS_Current < 120)
;;;939    				{
;;;940    					shutcount2 ++;
;;;941    					if(shutcount2 >= 20000)
;;;942    					{
;;;943    						overflag = 1;
;;;944    						Off_GPOI_ResetSet();
;;;945    						mainswitch = 0;
;;;946    						shutcount2 = 0;
;;;947    					}
;;;948    				}else{
;;;949    					if(DISS_Current<100)
;;;950    						shutcount2 = 0;
;;;951    				}
;;;952    			}else{
;;;953    				if((PPower >= 1200) || (LPower >= 3600) || DISS_Current >= 160)
0007aa  ee100a10          VMOV     r0,s0
0007ae  f8df80f0          LDR      r8,|L2.2208|
0007b2  f8df90f0          LDR      r9,|L2.2212|
0007b6  f44f71fa          MOV      r1,#0x1f4             ;923
0007ba  f6446a20          MOV      r10,#0x4e20           ;941
0007be  d042              BEQ      |L2.2118|
0007c0  4290              CMP      r0,r2                 ;919
0007c2  da08              BGE      |L2.2006|
0007c4  ee180a10          VMOV     r0,s16                ;919
0007c8  4a37              LDR      r2,|L2.2216|
0007ca  4290              CMP      r0,r2                 ;919
0007cc  da03              BGE      |L2.2006|
0007ce  f8db0000          LDR      r0,[r11,#0]           ;919  ; DISS_Current
0007d2  4540              CMP      r0,r8                 ;919
0007d4  db1f              BLT      |L2.2070|
                  |L2.2006|
0007d6  69b0              LDR      r0,[r6,#0x18]         ;921  ; shutcount3
0007d8  1c40              ADDS     r0,r0,#1              ;921
0007da  61b0              STR      r0,[r6,#0x18]         ;921  ; shutcount3
0007dc  6970              LDR      r0,[r6,#0x14]         ;922  ; shutcount2
0007de  1c40              ADDS     r0,r0,#1              ;922
0007e0  6170              STR      r0,[r6,#0x14]         ;922  ; shutcount2
0007e2  69b0              LDR      r0,[r6,#0x18]         ;923  ; shutcount3
0007e4  4288              CMP      r0,r1                 ;923
0007e6  d317              BCC      |L2.2072|
0007e8  7175              STRB     r5,[r6,#5]            ;925
0007ea  f7fffffe          BL       Off_GPOI_ResetSet
0007ee  61b4              STR      r4,[r6,#0x18]         ;929  ; shutcount3
0007f0  6174              STR      r4,[r6,#0x14]         ;930  ; shutcount2
0007f2  703c              STRB     r4,[r7,#0]            ;931
0007f4  e010              B        |L2.2072|
                  |L2.2038|
0007f6  482d              LDR      r0,|L2.2220|
0007f8  ed9b1a00          VLDR     s2,[r11,#0]           ;803
0007fc  ed900a00          VLDR     s0,[r0,#0]            ;802
000800  481c              LDR      r0,|L2.2164|
000802  edd00a00          VLDR     s1,[r0,#0]            ;802
000806  482a              LDR      r0,|L2.2224|
000808  ee200a20          VMUL.F32 s0,s0,s1              ;802
00080c  edd00a00          VLDR     s1,[r0,#0]            ;803
000810  ee208a81          VMUL.F32 s16,s1,s2             ;803
000814  e7c5              B        |L2.1954|
                  |L2.2070|
000816  61b4              STR      r4,[r6,#0x18]         ;936  ; shutcount3
                  |L2.2072|
000818  4922              LDR      r1,|L2.2212|
00081a  f8db0000          LDR      r0,[r11,#0]           ;938  ; DISS_Current
00081e  4249              RSBS     r1,r1,#0              ;938
000820  4401              ADD      r1,r1,r0              ;938
000822  f5b11f20          CMP      r1,#0x280000          ;938
000826  d20a              BCS      |L2.2110|
000828  6970              LDR      r0,[r6,#0x14]         ;940  ; shutcount2
00082a  1c40              ADDS     r0,r0,#1              ;940
00082c  6170              STR      r0,[r6,#0x14]         ;940  ; shutcount2
00082e  6971              LDR      r1,[r6,#0x14]         ;941  ; shutcount2
000830  4551              CMP      r1,r10                ;941
000832  d307              BCC      |L2.2116|
000834  7175              STRB     r5,[r6,#5]            ;943
000836  f7fffffe          BL       Off_GPOI_ResetSet
00083a  703c              STRB     r4,[r7,#0]            ;945
00083c  e001              B        |L2.2114|
                  |L2.2110|
00083e  4548              CMP      r0,r9                 ;949
000840  da7a              BGE      |L2.2360|
                  |L2.2114|
000842  6174              STR      r4,[r6,#0x14]         ;950  ; shutcount2
                  |L2.2116|
000844  e078              B        |L2.2360|
                  |L2.2118|
000846  4290              CMP      r0,r2
000848  da09              BGE      |L2.2142|
00084a  ee180a10          VMOV     r0,s16
00084e  4a19              LDR      r2,|L2.2228|
000850  4290              CMP      r0,r2
000852  da04              BGE      |L2.2142|
000854  4a18              LDR      r2,|L2.2232|
000856  f8db0000          LDR      r0,[r11,#0]  ; DISS_Current
00085a  4290              CMP      r0,r2
00085c  db3a              BLT      |L2.2260|
                  |L2.2142|
;;;954    				{
;;;955    					shutcount2++;
00085e  6970              LDR      r0,[r6,#0x14]  ; shutcount2
000860  1c40              ADDS     r0,r0,#1
000862  6170              STR      r0,[r6,#0x14]  ; shutcount2
;;;956    					shutcount4 ++;
000864  69f0              LDR      r0,[r6,#0x1c]  ; shutcount4
000866  1c40              ADDS     r0,r0,#1
000868  61f0              STR      r0,[r6,#0x1c]  ; shutcount4
;;;957    					shutcount3++;
00086a  69b0              LDR      r0,[r6,#0x18]  ; shutcount3
00086c  1c40              ADDS     r0,r0,#1
00086e  e025              B        |L2.2236|
                  |L2.2160|
                          DCD      CDC_DCsumMah
                  |L2.2164|
                          DCD      DISS_POW_Current
                  |L2.2168|
                          DCD      mode_sw
                  |L2.2172|
                          DCD      sendmodeflag
                  |L2.2176|
                          DCD      ||area_number.11||+0x40
                  |L2.2180|
                          DCD      Para
                  |L2.2184|
                          DCD      flagA
                  |L2.2188|
                          DCD      0x40020800
                  |L2.2192|
                          DCD      rmtrig
                  |L2.2196|
                          DCD      calflag
                  |L2.2200|
                          DCD      MODE
                  |L2.2204|
                          DCD      0x44960000
                  |L2.2208|
                          DCD      0x42f00000
                  |L2.2212|
                          DCD      0x42c80000
                  |L2.2216|
                          DCD      0x44e10000
                  |L2.2220|
                          DCD      DISS_POW_Voltage
                  |L2.2224|
                          DCD      DISS_Voltage
                  |L2.2228|
                          DCD      0x45610000
                  |L2.2232|
                          DCD      0x43200000
                  |L2.2236|
0008bc  61b0              STR      r0,[r6,#0x18]  ; shutcount3
;;;958    					if(shutcount3 >= 500)
0008be  69b0              LDR      r0,[r6,#0x18]  ; shutcount3
0008c0  4288              CMP      r0,r1
0008c2  d308              BCC      |L2.2262|
;;;959    					{
;;;960    						overflag = 1;
0008c4  7175              STRB     r5,[r6,#5]
;;;961    						Off_GPOI_ResetSet();
0008c6  f7fffffe          BL       Off_GPOI_ResetSet
;;;962    	//					shutcount1 = 0;
;;;963    						shutcount2 = 0;
0008ca  6174              STR      r4,[r6,#0x14]  ; shutcount2
;;;964    						shutcount3 = 0;
0008cc  61b4              STR      r4,[r6,#0x18]  ; shutcount3
;;;965    						shutcount4  =0;
0008ce  61f4              STR      r4,[r6,#0x1c]  ; shutcount4
;;;966    						mainswitch = 0;
0008d0  703c              STRB     r4,[r7,#0]
0008d2  e000              B        |L2.2262|
                  |L2.2260|
;;;967    					}
;;;968    				}else{
;;;969    	//				shutcount1 = 0;
;;;970    	//				shutcount2 = 0;
;;;971    						shutcount3 = 0;
0008d4  61b4              STR      r4,[r6,#0x18]  ; shutcount3
                  |L2.2262|
;;;972    				}
;;;973    				if(DISS_Current > 100 && DISS_Current < 120)
0008d6  491e              LDR      r1,|L2.2384|
0008d8  f8db0000          LDR      r0,[r11,#0]  ; DISS_Current
0008dc  4a1d              LDR      r2,|L2.2388|
0008de  4401              ADD      r1,r1,r0
0008e0  4291              CMP      r1,r2
0008e2  d20c              BCS      |L2.2302|
;;;974    				{
;;;975    					shutcount2 ++;
0008e4  6970              LDR      r0,[r6,#0x14]  ; shutcount2
0008e6  1c40              ADDS     r0,r0,#1
0008e8  6170              STR      r0,[r6,#0x14]  ; shutcount2
;;;976    					if(shutcount2 >= 20000)
0008ea  6971              LDR      r1,[r6,#0x14]  ; shutcount2
0008ec  4551              CMP      r1,r10
0008ee  d309              BCC      |L2.2308|
;;;977    					{
;;;978    						overflag = 1;
0008f0  7175              STRB     r5,[r6,#5]
;;;979    						Off_GPOI_ResetSet();
0008f2  e000              B        |L2.2294|
                  |L2.2292|
0008f4  e028              B        |L2.2376|
                  |L2.2294|
0008f6  f7fffffe          BL       Off_GPOI_ResetSet
;;;980    						mainswitch = 0;
0008fa  703c              STRB     r4,[r7,#0]
;;;981    						shutcount2 = 0;
0008fc  e001              B        |L2.2306|
                  |L2.2302|
;;;982    					}
;;;983    				}else{
;;;984    					if(DISS_Current<100)
0008fe  4548              CMP      r0,r9
000900  da00              BGE      |L2.2308|
                  |L2.2306|
;;;985    						shutcount2 = 0;
000902  6174              STR      r4,[r6,#0x14]  ; shutcount2
                  |L2.2308|
;;;986    				}
;;;987    				if(DISS_Current >= 120 && DISS_Current < 160)
000904  4914              LDR      r1,|L2.2392|
000906  f8db0000          LDR      r0,[r11,#0]  ; DISS_Current
00090a  4401              ADD      r1,r1,r0
00090c  f5b11f40          CMP      r1,#0x300000
000910  d20f              BCS      |L2.2354|
;;;988    				{
;;;989    					shutcount2++;
000912  6970              LDR      r0,[r6,#0x14]  ; shutcount2
000914  1c40              ADDS     r0,r0,#1
000916  6170              STR      r0,[r6,#0x14]  ; shutcount2
;;;990    					shutcount4 ++;
000918  69f0              LDR      r0,[r6,#0x1c]  ; shutcount4
00091a  1c40              ADDS     r0,r0,#1
00091c  61f0              STR      r0,[r6,#0x1c]  ; shutcount4
;;;991    					if(shutcount4 >= 2000)
00091e  69f0              LDR      r0,[r6,#0x1c]  ; shutcount4
000920  f5b06ffa          CMP      r0,#0x7d0
000924  d308              BCC      |L2.2360|
;;;992    					{
;;;993    						overflag = 1;
000926  7175              STRB     r5,[r6,#5]
;;;994    						Off_GPOI_ResetSet();
000928  f7fffffe          BL       Off_GPOI_ResetSet
;;;995    						mainswitch = 0;
00092c  703c              STRB     r4,[r7,#0]
;;;996    						shutcount4 = 0;
00092e  61f4              STR      r4,[r6,#0x1c]  ; shutcount4
;;;997    						shutcount2 = 0;
000930  e787              B        |L2.2114|
                  |L2.2354|
;;;998    					}
;;;999    				}else{
;;;1000   					if(DISS_Current<120)
000932  4540              CMP      r0,r8
000934  da00              BGE      |L2.2360|
;;;1001   						shutcount4 = 0;
000936  61f4              STR      r4,[r6,#0x1c]  ; shutcount4
                  |L2.2360|
;;;1002   	//				shutcount2 = 0;
;;;1003   	//				shutcount3 = 0;
;;;1004   				}
;;;1005   			}
;;;1006   //		}
;;;1007   //		else if((PPower > 100 && PPower < 200) || (LPower > 100 && LPower < 200)){
;;;1008   //			shutcount1 ++;
;;;1009   //			if(shutcount1 >= 180000)
;;;1010   //			{
;;;1011   //				Off_GPOI_ResetSet();
;;;1012   //				mainswitch = 0;
;;;1013   //				shutcount1 = 0;
;;;1014   //			}			
;;;1015   //		}else if((PPower >= 200 && PPower < 300) || (LPower >= 200 && LPower < 300)){
;;;1016   //			shutcount2 ++;
;;;1017   //			if(shutcount2 >= 10000)
;;;1018   //			{
;;;1019   //				Off_GPOI_ResetSet();
;;;1020   //				mainswitch = 0;
;;;1021   //				shutcount2 = 0;
;;;1022   //			}
;;;1023   //		}
;;;1024   		
;;;1025   		
;;;1026   //		if((PPower > 80) || (LPower > 80))
;;;1027   //		{
;;;1028   //			Off_GPOI_ResetSet();
;;;1029   //			shutcount1 = 0;
;;;1030   //			shutcount2 = 0;
;;;1031   //			mainswitch = 0;
;;;1032   //		}
;;;1033   		
;;;1034   		TIM_ClearITPendingBit(TIM3,TIM_IT_Update);
000938  2101              MOVS     r1,#1
00093a  ecbd8b04          VPOP     {d8-d9}
00093e  e8bd5ff0          POP      {r4-r12,lr}
000942  4806              LDR      r0,|L2.2396|
000944  f7ffbffe          B.W      TIM_ClearITPendingBit
                  |L2.2376|
;;;1035   	}
;;;1036   	  
;;;1037   }
000948  ecbd8b04          VPOP     {d8-d9}
00094c  e8bd9ff0          POP      {r4-r12,pc}
;;;1038   
                          ENDP

                  |L2.2384|
                          DCD      0xbd37ffff
                  |L2.2388|
                          DCD      0x0027ffff
                  |L2.2392|
                          DCD      0xbd100000
                  |L2.2396|
                          DCD      0x40000400

                          AREA ||i.TIM3_Int_Init||, CODE, READONLY, ALIGN=2

                  TIM3_Int_Init PROC
;;;220    
;;;221    void TIM3_Int_Init(u16 arr,u16 psc)
000000  b57f              PUSH     {r0-r6,lr}
;;;222    {
000002  460c              MOV      r4,r1
000004  4605              MOV      r5,r0
;;;223        TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;
;;;224        NVIC_InitTypeDef NVIC_InitStructure;
;;;225    
;;;226        //使用定时器之前都必须开启定时器时钟，基本定时器属于APB1 总线外设。
;;;227        //开启Time x Clk， x
;;;228        RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM3,ENABLE);
000006  2101              MOVS     r1,#1
000008  2002              MOVS     r0,#2
00000a  f7fffffe          BL       RCC_APB1PeriphClockCmd
;;;229       
;;;230    		/*  累计 TIM_Period 个后产生一个更新或者中断  */
;;;231        //  当定时器从0 计数到4999，即为5000 次，为一个定时周期
;;;232        TIM_TimeBaseInitStructure.TIM_Period = arr;  
;;;233    
;;;234        //定时器时钟源TIMxCLK = 2 * PCLK1
;;;235        // PCLK1 = HCLK / 4
;;;236        // => TIMxCLK=HCLK/2=SystemCoreClock/2=90MHz
;;;237        // 设定定时器频率为=TIMxCLK/(TIM_Prescaler+1)=10000Hz   
;;;238        TIM_TimeBaseInitStructure.TIM_Prescaler = psc; 
00000e  f8ad4000          STRH     r4,[sp,#0]
;;;239    
;;;240        //计数方式
;;;241        TIM_TimeBaseInitStructure.TIM_CounterMode=TIM_CounterMode_Up; 
000012  2000              MOVS     r0,#0
;;;242    
;;;243    		//采样时钟分频
;;;244        TIM_TimeBaseInitStructure.TIM_ClockDivision=TIM_CKD_DIV1;
;;;245    
;;;246    		//初始化定时器TIMx, x[1,8]
;;;247        TIM_TimeBaseInit(TIM3,&TIM_TimeBaseInitStructure);
000014  4c10              LDR      r4,|L3.88|
000016  f8ad0002          STRH     r0,[sp,#2]            ;241
00001a  f8ad0008          STRH     r0,[sp,#8]            ;244
00001e  9501              STR      r5,[sp,#4]            ;238
000020  4669              MOV      r1,sp
000022  4620              MOV      r0,r4
000024  f7fffffe          BL       TIM_TimeBaseInit
;;;248    
;;;249    	  //允许定时器x 更新中断
;;;250        TIM_ITConfig(TIM3,TIM_IT_Update,ENABLE); 
000028  2201              MOVS     r2,#1
00002a  4611              MOV      r1,r2
00002c  4620              MOV      r0,r4
00002e  f7fffffe          BL       TIM_ITConfig
;;;251    
;;;252    		//定时器x 中断
;;;253        NVIC_InitStructure.NVIC_IRQChannel=TIM3_IRQn;   
000032  201d              MOVS     r0,#0x1d
000034  f88d000c          STRB     r0,[sp,#0xc]
;;;254    
;;;255    		// 设置抢占优先级
;;;256        NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0x01; 
000038  2101              MOVS     r1,#1
00003a  f88d100d          STRB     r1,[sp,#0xd]
;;;257    
;;;258    		// 设置子优先级
;;;259        NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0x01;   
00003e  f88d100e          STRB     r1,[sp,#0xe]
;;;260    
;;;261    		/* 使能中断通道 */
;;;262        NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
000042  f88d100f          STRB     r1,[sp,#0xf]
;;;263        NVIC_Init(&NVIC_InitStructure);
000046  a803              ADD      r0,sp,#0xc
000048  f7fffffe          BL       NVIC_Init
;;;264    
;;;265    		// 使能定时器
;;;266        TIM_Cmd(TIM3,ENABLE); 
00004c  2101              MOVS     r1,#1
00004e  4620              MOV      r0,r4
000050  f7fffffe          BL       TIM_Cmd
;;;267    }
000054  bd7f              POP      {r0-r6,pc}
;;;268    
                          ENDP

000056  0000              DCW      0x0000
                  |L3.88|
                          DCD      0x40000400

                          AREA ||i.TIM4_Config||, CODE, READONLY, ALIGN=2

                  TIM4_Config PROC
;;;56     /*****************************************************************/
;;;57     void TIM4_Config(void)
000000  b57c              PUSH     {r2-r6,lr}
;;;58     {
;;;59     	GPIO_InitTypeDef GPIO_InitStructure;//调用GPIO结构体
;;;60       /* 配置GPIO管脚复用*/
;;;61     	GPIO_PinAFConfig(GPIOB,GPIO_PinSource8,GPIO_AF_TIM4);
000002  4e13              LDR      r6,|L4.80|
000004  2202              MOVS     r2,#2
000006  2108              MOVS     r1,#8
000008  4630              MOV      r0,r6
00000a  f7fffffe          BL       GPIO_PinAFConfig
;;;62     	GPIO_PinAFConfig(GPIOB,GPIO_PinSource9,GPIO_AF_TIM4);
00000e  2202              MOVS     r2,#2
000010  2109              MOVS     r1,#9
000012  4630              MOV      r0,r6
000014  f7fffffe          BL       GPIO_PinAFConfig
;;;63       GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8;
;;;64       GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
000018  2402              MOVS     r4,#2
00001a  15b0              ASRS     r0,r6,#22             ;63
00001c  f88d4004          STRB     r4,[sp,#4]
;;;65     	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
000020  2500              MOVS     r5,#0
000022  9000              STR      r0,[sp,#0]            ;64
000024  f88d5006          STRB     r5,[sp,#6]
;;;66       GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
000028  f88d4005          STRB     r4,[sp,#5]
;;;67       GPIO_Init(GPIOB, &GPIO_InitStructure);//将设置输入函数
00002c  4669              MOV      r1,sp
00002e  4630              MOV      r0,r6
000030  f7fffffe          BL       GPIO_Init
;;;68       
;;;69     	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_9;
000034  0220              LSLS     r0,r4,#8
;;;70       GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
000036  f88d4004          STRB     r4,[sp,#4]
00003a  9000              STR      r0,[sp,#0]
;;;71     	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
00003c  f88d5006          STRB     r5,[sp,#6]
;;;72       GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
000040  f88d4005          STRB     r4,[sp,#5]
;;;73       GPIO_Init(GPIOB, &GPIO_InitStructure);//将设置输入函数
000044  4669              MOV      r1,sp
000046  4630              MOV      r0,r6
000048  f7fffffe          BL       GPIO_Init
;;;74     }
00004c  bd7c              POP      {r2-r6,pc}
;;;75     /*****************************************************************/
                          ENDP

00004e  0000              DCW      0x0000
                  |L4.80|
                          DCD      0x40020400

                          AREA ||i.TIM4_PWM_Config||, CODE, READONLY, ALIGN=2

                  TIM4_PWM_Config PROC
;;;75     /*****************************************************************/
;;;76     void TIM4_PWM_Config(void)
000000  b530              PUSH     {r4,r5,lr}
;;;77     {
000002  b089              SUB      sp,sp,#0x24
;;;78     	TIM_TimeBaseInitTypeDef  TIM_TimeBaseStructure;
;;;79     	TIM_OCInitTypeDef  TIM_OCInitStructure;
;;;80     	/* TIM3 的配置 ---------------------------------------------------
;;;81        TIM3 输入时钟(TIM3CLK) 设置为 APB2 时钟 (PCLK2)    
;;;82         => TIM3CLK = PCLK2 = SystemCoreClock
;;;83        TIM3CLK = SystemCoreClock, Prescaler = 0, TIM3 counter clock = SystemCoreClock
;;;84        SystemCoreClock 为48 MHz */
;;;85       /* TIM4 时钟使能 */
;;;86       RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM4,ENABLE);
000004  2101              MOVS     r1,#1
000006  2004              MOVS     r0,#4
000008  f7fffffe          BL       RCC_APB1PeriphClockCmd
;;;87     	TIM4_Config();
00000c  f7fffffe          BL       TIM4_Config
;;;88     
;;;89       /* Time 定时基础设置*/
;;;90       TIM_TimeBaseStructure.TIM_Prescaler = 6;//时钟预分频
;;;91       TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_Up;  /* Time 定时设置为上升沿计算模式*/
000010  2400              MOVS     r4,#0
000012  2006              MOVS     r0,#6                 ;90
000014  f8ad0014          STRH     r0,[sp,#0x14]         ;90
;;;92       TIM_TimeBaseStructure.TIM_Period = 0;
;;;93       TIM_TimeBaseStructure.TIM_ClockDivision = 0;
;;;94       TIM_TimeBaseStructure.TIM_RepetitionCounter = 0;
;;;95     
;;;96       TIM_TimeBaseInit(TIM4,&TIM_TimeBaseStructure);
000018  4d21              LDR      r5,|L5.160|
00001a  f8ad401c          STRH     r4,[sp,#0x1c]         ;93
00001e  f8ad4016          STRH     r4,[sp,#0x16]         ;91
000022  9406              STR      r4,[sp,#0x18]         ;93
000024  f88d401e          STRB     r4,[sp,#0x1e]         ;94
000028  a905              ADD      r1,sp,#0x14
00002a  4628              MOV      r0,r5
00002c  f7fffffe          BL       TIM_TimeBaseInit
;;;97     
;;;98       /* 频道1的PWM 模式设置 */
;;;99       TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;
000030  2060              MOVS     r0,#0x60
000032  f8ad0000          STRH     r0,[sp,#0]
;;;100      TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;
000036  2001              MOVS     r0,#1
000038  f8ad0002          STRH     r0,[sp,#2]
;;;101      TIM_OCInitStructure.TIM_OutputNState = TIM_OutputNState_Enable;
00003c  2004              MOVS     r0,#4
00003e  f8ad0004          STRH     r0,[sp,#4]
;;;102      TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_Low;
000042  2002              MOVS     r0,#2
000044  f8ad000c          STRH     r0,[sp,#0xc]
;;;103      TIM_OCInitStructure.TIM_OCNPolarity = TIM_OCNPolarity_High;
;;;104      TIM_OCInitStructure.TIM_OCIdleState = TIM_OCIdleState_Set;
000048  01c0              LSLS     r0,r0,#7
00004a  f8ad0010          STRH     r0,[sp,#0x10]
;;;105      TIM_OCInitStructure.TIM_OCNIdleState = TIM_OCIdleState_Reset;
;;;106    	TIM_OCInitStructure.TIM_Pulse = 0x0f;//使能频道1配置
00004e  200f              MOVS     r0,#0xf
;;;107      TIM_OC3Init(TIM4, &TIM_OCInitStructure);
000050  9002              STR      r0,[sp,#8]
000052  f8ad400e          STRH     r4,[sp,#0xe]          ;103
000056  f8ad4012          STRH     r4,[sp,#0x12]         ;105
00005a  4669              MOV      r1,sp
00005c  4628              MOV      r0,r5
00005e  f7fffffe          BL       TIM_OC3Init
;;;108    	
;;;109    	TIM_OC3PreloadConfig(TIM4, TIM_OCPreload_Enable);
000062  2108              MOVS     r1,#8
000064  4628              MOV      r0,r5
000066  f7fffffe          BL       TIM_OC3PreloadConfig
;;;110    	TIM_OC4Init(TIM4, &TIM_OCInitStructure);
00006a  4669              MOV      r1,sp
00006c  4628              MOV      r0,r5
00006e  f7fffffe          BL       TIM_OC4Init
;;;111    	TIM_OC4PreloadConfig(TIM4, TIM_OCPreload_Enable);
000072  2108              MOVS     r1,#8
000074  4628              MOV      r0,r5
000076  f7fffffe          BL       TIM_OC4PreloadConfig
;;;112    	TIM_SetAutoreload(TIM4, 0x7530);//璁剧疆PWM杈ㄧ?
00007a  f2475130          MOV      r1,#0x7530
00007e  4628              MOV      r0,r5
000080  f7fffffe          BL       TIM_SetAutoreload
;;;113    	TIM_ARRPreloadConfig(TIM4, ENABLE);
000084  2101              MOVS     r1,#1
000086  4628              MOV      r0,r5
000088  f7fffffe          BL       TIM_ARRPreloadConfig
;;;114      /* TIM4 浣胯*/
;;;115      TIM_Cmd(TIM4, ENABLE);
00008c  2101              MOVS     r1,#1
00008e  4628              MOV      r0,r5
000090  f7fffffe          BL       TIM_Cmd
;;;116    	
;;;117      /* TIM4 寮濮杈?*/
;;;118      TIM_CtrlPWMOutputs(TIM4, ENABLE);	
000094  2101              MOVS     r1,#1
000096  4628              MOV      r0,r5
000098  f7fffffe          BL       TIM_CtrlPWMOutputs
;;;119    }
00009c  b009              ADD      sp,sp,#0x24
00009e  bd30              POP      {r4,r5,pc}
;;;120    /**************************************************************************************/
                          ENDP

                  |L5.160|
                          DCD      0x40000800

                          AREA ||i.Temp_Comapre||, CODE, READONLY, ALIGN=2

                  Temp_Comapre PROC
;;;120    /**************************************************************************************/
;;;121    void Temp_Comapre(void)	  //温度来控制风扇
000000  b570              PUSH     {r4-r6,lr}
;;;122    {
;;;123    	if(NTC_value<=2650)
000002  4a0e              LDR      r2,|L6.60|
000004  8813              LDRH     r3,[r2,#0]  ; NTC_value
000006  f640255a          MOV      r5,#0xa5a
;;;124    	{
;;;125    		GPIO_SetBits(GPIOB,GPIO_Pin_12);//开启风扇
00000a  480d              LDR      r0,|L6.64|
;;;126    		flag_FAN_ON=1;
00000c  4c0d              LDR      r4,|L6.68|
00000e  f44f5180          MOV      r1,#0x1000            ;125
000012  42ab              CMP      r3,r5                 ;123
000014  d805              BHI      |L6.34|
000016  f7fffffe          BL       GPIO_SetBits
00001a  6820              LDR      r0,[r4,#0]  ; flagG
00001c  f0400020          ORR      r0,r0,#0x20
000020  e009              B        |L6.54|
                  |L6.34|
;;;127    	}
;;;128    	else if(NTC_value>=2700)
000022  8812              LDRH     r2,[r2,#0]  ; NTC_value
000024  f640238c          MOV      r3,#0xa8c
000028  429a              CMP      r2,r3
00002a  d305              BCC      |L6.56|
;;;129    	{
;;;130    		GPIO_ResetBits(GPIOB,GPIO_Pin_12);//关闭风扇
00002c  f7fffffe          BL       GPIO_ResetBits
;;;131    		flag_FAN_ON=0;
000030  6820              LDR      r0,[r4,#0]  ; flagG
000032  f0200020          BIC      r0,r0,#0x20
                  |L6.54|
000036  6020              STR      r0,[r4,#0]            ;126  ; flagG
                  |L6.56|
;;;132    	}
;;;133    }
000038  bd70              POP      {r4-r6,pc}
;;;134    
                          ENDP

00003a  0000              DCW      0x0000
                  |L6.60|
                          DCD      NTC_value
                  |L6.64|
                          DCD      0x40020400
                  |L6.68|
                          DCD      flagG

                          AREA ||.bss||, DATA, NOINIT, ALIGN=1

                  watchcurrent
                          %        2000
                  vccbuf
                          %        15

                          AREA ||.data||, DATA, ALIGN=0

                  version
000000  17                DCB      0x17

                          AREA ||area_number.11||, DATA, ALIGN=2

                          EXPORTAS ||area_number.11||, ||.data||
                  shorttime
000000  00                DCB      0x00
                  shortflag
000001  00                DCB      0x00
                  finishflag
000002  00                DCB      0x00
                  charge_step
000003  00                DCB      0x00
                  loop
000004  00                DCB      0x00
                  overflag
000005  00                DCB      0x00
                  cdcswdelay
000006  0000              DCB      0x00,0x00
                  watchcount
000008  00000000          DCB      0x00,0x00,0x00,0x00
                  abc_time
                          DCD      0x00000000
                  ms_time
                          DCD      0x00000000
                  shutcount2
                          DCD      0x00000000
                  shutcount3
                          DCD      0x00000000
                  shutcount4
                          DCD      0x00000000
                  recharge
                          DCD      0x00000000
                  reboot
                          DCD      0x00000000
                  testv
                          DCD      0x00000000
                  finishdelay
                          DCD      0x00000000
                  battery_c
                          DCD      0x00000000
                  ctime
                          DCD      0x00000000
                  dctime
                          DCD      0x00000000
                  capwait
                          DCD      0x00000000
                  sendmodepow
000040  01530000          DCB      0x01,0x53,0x00,0x00
000044  0001              DCB      0x00,0x01
                  sendmodeload
000046  0153              DCB      0x01,0x53
000048  00000002          DCB      0x00,0x00,0x00,0x02
                  sendmodestop
00004c  01520000          DCB      0x01,0x52,0x00,0x00
000050  0004              DCB      0x00,0x04
                  sendmodegap
000052  0153              DCB      0x01,0x53
000054  00000003          DCB      0x00,0x00,0x00,0x03

                          AREA ||area_number.12||, DATA, ALIGN=2

                          EXPORTAS ||area_number.12||, ||.data||
                  shortold_I
000000  00000000          DCFS     0x00000000 ; 0

                          AREA ||area_number.13||, DATA, ALIGN=2

                          EXPORTAS ||area_number.13||, ||.data||
                  shutcount1
                          DCD      0x00000000

                          AREA ||area_number.14||, DATA, ALIGN=0

                          EXPORTAS ||area_number.14||, ||.data||
                  lockflag
000000  00                DCB      0x00

;*** Start embedded assembler ***

#line 1 "..\\drive\\TIM4.c"
	AREA ||.rev16_text||, CODE
	THUMB
	EXPORT |__asm___6_TIM4_c_version____REV16|
#line 129 "C:\\Keil_v5\\ARM\\CMSIS\\Include\\core_cmInstr.h"
|__asm___6_TIM4_c_version____REV16| PROC
#line 130

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE
	THUMB
	EXPORT |__asm___6_TIM4_c_version____REVSH|
#line 144
|__asm___6_TIM4_c_version____REVSH| PROC
#line 145

 revsh r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***
