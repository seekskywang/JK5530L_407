; generated by Component: ARM Compiler 5.06 update 4 (build 422) Tool: ArmCC [4d3604]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o..\output\tim4.o --asm_dir=..\Listing\ --list_dir=..\Listing\ --depend=..\output\tim4.d --cpu=Cortex-M4.fp.sp --apcs=interwork -O3 --diag_suppress=9931,870 -I..\APP -I..\drive -I..\Include -I..\Libraries\CMSIS\inc -I..\Libraries\CMSIS\src -I..\Libraries\FWlib\inc -I..\Libraries\FWlib\src -I..\Listing -I..\Output -I..\Project -I..\STemWinLibrary522\Config -I..\STemWinLibrary522\emWinTask -I..\STemWinLibrary522\GUILib -I..\STemWinLibrary522\inc -I..\User -I..\USB\STM32_USB_HOST_Library\Class\HID\inc -I..\USB\STM32_USB_HOST_Library\Class\MSC\src -I..\USB\STM32_USB_HOST_Library\Core\src -I..\USB\USB_APP -I..\USB\STM32_USB_HOST_Library\Class\HID\src -I..\USB\STM32_USB_HOST_Library\Class\MSC\inc -I..\USB\STM32_USB_HOST_Library\Core\inc -I..\USB\STM32_USB_OTG_Driver\inc -I..\FATFS\exfuns -I..\FATFS\src\option -I..\FATFS\src -I..\MALLOC -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMSIS\Include -IC:\Keil_v5\ARM\INC\ST\STM32F4xx -D__UVISION_VERSION=538 -DUSE_STDPERIPH_DRIVER -DSTM32F40XX -DUSE_USB_OTG_FS -DUSE_EMBEDDED_PHY -DUSE_USB_OTG_HS -DSTM32F40XX -W --omf_browse=..\output\tim4.crf --no_multibyte_chars ..\drive\TIM4.c]
                          THUMB

                          AREA ||i.SendToPC||, CODE, READONLY, ALIGN=2

                  SendToPC PROC
;;;134    
;;;135    void SendToPC(u8 mode)
000000  b4f0              PUSH     {r4-r7}
;;;136    {
;;;137    	
;;;138    	
;;;139    	vccbuf[0] = 0x01;
000002  4944              LDR      r1,|L1.276|
000004  2201              MOVS     r2,#1
;;;140    	vccbuf[2] = 0x0C;
;;;141    	if(mode == 0)//动态负载模式
;;;142    	{
;;;143    		vccbuf[1] = 0x50;//负载功能
;;;144    		
;;;145    		vccbuf[3] = (vu16)(DISS_Voltage*1000)>>8;
000006  4e44              LDR      r6,|L1.280|
000008  700a              STRB     r2,[r1,#0]            ;139
00000a  220c              MOVS     r2,#0xc               ;140
00000c  708a              STRB     r2,[r1,#2]            ;140
00000e  eddf0a43          VLDR     s1,|L1.284|
;;;146    		vccbuf[4] = (vu16)(DISS_Voltage*1000);//2字节负载电压
;;;147    		
;;;148    		vccbuf[5] = ((vu32)(DISS_Current*1000))>>24;
000012  4f43              LDR      r7,|L1.288|
000014  ed961a00          VLDR     s2,[r6,#0]            ;145
;;;149    		vccbuf[6] = ((vu32)(DISS_Current*1000))>>16;
;;;150    		vccbuf[7] = ((vu32)(DISS_Current*1000))>>8;
;;;151    		vccbuf[8] = ((vu32)(DISS_Current*1000));//4字节负载电流
;;;152    		
;;;153    		vccbuf[9] = battery_c>>24;
;;;154    		vccbuf[10] = battery_c>>16;
;;;155    		vccbuf[11] = battery_c>>8;
;;;156    		vccbuf[12] = battery_c;//4字节容量
;;;157    		vccbuf[13] = Temperature>>8;
000018  4b43              LDR      r3,|L1.296|
00001a  ed970a00          VLDR     s0,[r7,#0]            ;148
00001e  4a41              LDR      r2,|L1.292|
000020  881b              LDRH     r3,[r3,#0]
000022  ee200a20          VMUL.F32 s0,s0,s1              ;148
000026  ee610a20          VMUL.F32 s1,s2,s1              ;145
00002a  f3c32507          UBFX     r5,r3,#8,#8
;;;158    		vccbuf[14] = (vu8)Temperature;//2字节温度
00002e  b2dc              UXTB     r4,r3
000030  eebc0ac0          VCVT.U32.F32 s0,s0                 ;148
000034  eefc0ae0          VCVT.U32.F32 s1,s1                 ;145
000038  b128              CBZ      r0,|L1.70|
;;;159    	}else if(mode == 1){//动态电源模式
;;;160    		vccbuf[1] = 0x51;
;;;161    		
;;;162    		vccbuf[3] = (vu16)(Para.CPOW_Voltage*10)>>8;
00003a  4b3c              LDR      r3,|L1.300|
00003c  2801              CMP      r0,#1                 ;159
00003e  d005              BEQ      |L1.76|
;;;163    		vccbuf[4] = (vu16)(Para.CPOW_Voltage*10);//2字节电源电压
;;;164    		
;;;165    		vccbuf[5] = ((vu32)(Para.CCurrent*10))>>24;
;;;166    		vccbuf[6] = ((vu32)(Para.CCurrent*10))>>16;
;;;167    		vccbuf[7] = ((vu32)(Para.CCurrent*10))>>8;
;;;168    		vccbuf[8] = ((vu32)(Para.CCurrent*10));//4字节电源电流
;;;169    		
;;;170    		vccbuf[9] = battery_c>>24;
;;;171    		vccbuf[10] = battery_c>>16;
;;;172    		vccbuf[11] = battery_c>>8;
;;;173    		vccbuf[12] = battery_c;//4字节容量
;;;174    		vccbuf[13] = Temperature>>8;
;;;175    		vccbuf[14] = (vu8)Temperature;//2字节温度
;;;176    	}else if(mode == 2){//动态充放电
000040  2802              CMP      r0,#2
000042  d008              BEQ      |L1.86|
000044  e022              B        |L1.140|
                  |L1.70|
000046  2050              MOVS     r0,#0x50              ;143
000048  7048              STRB     r0,[r1,#1]            ;143
00004a  e02f              B        |L1.172|
                  |L1.76|
00004c  2051              MOVS     r0,#0x51              ;160
00004e  7048              STRB     r0,[r1,#1]            ;160
000050  e021              B        |L1.150|
                  |L1.82|
000052  7208              STRB     r0,[r1,#8]            ;151
000054  e00d              B        |L1.114|
                  |L1.86|
;;;177    		vccbuf[1] = 0x52;
000056  2052              MOVS     r0,#0x52
000058  7048              STRB     r0,[r1,#1]
;;;178    		
;;;179    		
;;;180    		if(mode_sw == 0)//放电
00005a  4835              LDR      r0,|L1.304|
00005c  7806              LDRB     r6,[r0,#0]  ; mode_sw
00005e  b1d6              CBZ      r6,|L1.150|
;;;181    		{
;;;182    			vccbuf[3] = (vu16)(Para.CPOW_Voltage*10)>>8;
;;;183    			vccbuf[4] = (vu16)(Para.CPOW_Voltage*10);//2字节电源电压
;;;184    			vccbuf[5] = ((vu32)(Para.CCurrent*10))>>24;
;;;185    			vccbuf[6] = ((vu32)(Para.CCurrent*10))>>16;
;;;186    			vccbuf[7] = ((vu32)(Para.CCurrent*10))>>8;
;;;187    			vccbuf[8] = ((vu32)(Para.CCurrent*10));//4字节电源电流
;;;188    		}else if(mode_sw == 1){//充电
000060  7806              LDRB     r6,[r0,#0]  ; mode_sw
000062  2e01              CMP      r6,#1
000064  d022              BEQ      |L1.172|
;;;189    			vccbuf[3] = (vu16)(DISS_Voltage*1000)>>8;
;;;190    			vccbuf[4] = (vu16)(DISS_Voltage*1000);//2字节负载电压
;;;191    			vccbuf[5] = ((vu32)(DISS_Current*1000))>>24;
;;;192    			vccbuf[6] = ((vu32)(DISS_Current*1000))>>16;
;;;193    			vccbuf[7] = ((vu32)(DISS_Current*1000))>>8;
;;;194    			vccbuf[8] = ((vu32)(DISS_Current*1000));//4字节负载电流
;;;195    		}else if(mode_sw == 2){//充电搁置
000066  7806              LDRB     r6,[r0,#0]  ; mode_sw
000068  2e02              CMP      r6,#2
00006a  d035              BEQ      |L1.216|
;;;196    			vccbuf[3] = (vu16)(DISS_Voltage*1000)>>8;
;;;197    			vccbuf[4] = (vu16)(DISS_Voltage*1000);//2字节负载电压
;;;198    			vccbuf[5] = ((vu32)(Para.CCurrent*10))>>24;
;;;199    			vccbuf[6] = ((vu32)(Para.CCurrent*10))>>16;
;;;200    			vccbuf[7] = ((vu32)(Para.CCurrent*10))>>8;
;;;201    			vccbuf[8] = ((vu32)(Para.CCurrent*10));//4字节电源电流
;;;202    		}else if(mode_sw == 3){//放电搁置
00006c  7800              LDRB     r0,[r0,#0]  ; mode_sw
00006e  2803              CMP      r0,#3
000070  d01c              BEQ      |L1.172|
                  |L1.114|
;;;203    			vccbuf[3] = (vu16)(DISS_Voltage*1000)>>8;
;;;204    			vccbuf[4] = (vu16)(DISS_Voltage*1000);
;;;205    			vccbuf[5] = ((vu32)(DISS_Current*1000))>>24;
;;;206    			vccbuf[6] = ((vu32)(DISS_Current*1000))>>16;
;;;207    			vccbuf[7] = ((vu32)(DISS_Current*1000))>>8;
;;;208    			vccbuf[8] = ((vu32)(DISS_Current*1000));//4字节负载电流
;;;209    		}
;;;210    		
;;;211    		vccbuf[9] = battery_c>>24;
000072  6b10              LDR      r0,[r2,#0x30]  ; battery_c
000074  0e00              LSRS     r0,r0,#24
000076  7248              STRB     r0,[r1,#9]
;;;212    		vccbuf[10] = battery_c>>16;
000078  6b10              LDR      r0,[r2,#0x30]  ; battery_c
00007a  0c00              LSRS     r0,r0,#16
00007c  7288              STRB     r0,[r1,#0xa]
;;;213    		vccbuf[11] = battery_c>>8;
00007e  6b10              LDR      r0,[r2,#0x30]  ; battery_c
000080  0a00              LSRS     r0,r0,#8
000082  72c8              STRB     r0,[r1,#0xb]
;;;214    		vccbuf[12] = battery_c;//4字节容量
000084  6b10              LDR      r0,[r2,#0x30]  ; battery_c
000086  7308              STRB     r0,[r1,#0xc]
;;;215    		vccbuf[13] = Temperature>>8;
000088  734d              STRB     r5,[r1,#0xd]
;;;216    		vccbuf[14] = (vu8)Temperature;//2字节温度
00008a  738c              STRB     r4,[r1,#0xe]
                  |L1.140|
;;;217    	}
;;;218    	MODS_SendWithCRC(vccbuf, 15);
00008c  bcf0              POP      {r4-r7}
00008e  210f              MOVS     r1,#0xf
000090  4820              LDR      r0,|L1.276|
000092  f7ffbffe          B.W      MODS_SendWithCRC
                  |L1.150|
000096  6a98              LDR      r0,[r3,#0x28]         ;182  ; Para
000098  eb000080          ADD      r0,r0,r0,LSL #2       ;182
00009c  f3c010d7          UBFX     r0,r0,#7,#24          ;182
0000a0  70c8              STRB     r0,[r1,#3]            ;182
0000a2  6a98              LDR      r0,[r3,#0x28]         ;183  ; Para
0000a4  eb000080          ADD      r0,r0,r0,LSL #2       ;183
0000a8  0040              LSLS     r0,r0,#1              ;183
0000aa  e01b              B        |L1.228|
                  |L1.172|
0000ac  ee100a90          VMOV     r0,s1                 ;189
0000b0  0a00              LSRS     r0,r0,#8              ;189
0000b2  70c8              STRB     r0,[r1,#3]            ;189
0000b4  ee100a90          VMOV     r0,s1                 ;190
0000b8  7108              STRB     r0,[r1,#4]            ;190
0000ba  ee100a10          VMOV     r0,s0                 ;191
0000be  0e00              LSRS     r0,r0,#24             ;191
0000c0  7148              STRB     r0,[r1,#5]            ;191
0000c2  ee100a10          VMOV     r0,s0                 ;192
0000c6  0c00              LSRS     r0,r0,#16             ;192
0000c8  7188              STRB     r0,[r1,#6]            ;192
0000ca  ee100a10          VMOV     r0,s0                 ;193
0000ce  0a00              LSRS     r0,r0,#8              ;193
0000d0  71c8              STRB     r0,[r1,#7]            ;193
0000d2  ee100a10          VMOV     r0,s0                 ;194
0000d6  e7bc              B        |L1.82|
                  |L1.216|
0000d8  ee100a90          VMOV     r0,s1                 ;196
0000dc  0a00              LSRS     r0,r0,#8              ;196
0000de  70c8              STRB     r0,[r1,#3]            ;196
0000e0  ee100a90          VMOV     r0,s1                 ;197
                  |L1.228|
0000e4  7108              STRB     r0,[r1,#4]            ;183
0000e6  6b18              LDR      r0,[r3,#0x30]         ;184  ; Para
0000e8  eb000080          ADD      r0,r0,r0,LSL #2       ;184
0000ec  f3c050c7          UBFX     r0,r0,#23,#8          ;184
0000f0  7148              STRB     r0,[r1,#5]            ;184
0000f2  6b18              LDR      r0,[r3,#0x30]         ;185  ; Para
0000f4  eb000080          ADD      r0,r0,r0,LSL #2       ;185
0000f8  f3c030cf          UBFX     r0,r0,#15,#16         ;185
0000fc  7188              STRB     r0,[r1,#6]            ;185
0000fe  6b18              LDR      r0,[r3,#0x30]         ;186  ; Para
000100  eb000080          ADD      r0,r0,r0,LSL #2       ;186
000104  f3c010d7          UBFX     r0,r0,#7,#24          ;186
000108  71c8              STRB     r0,[r1,#7]            ;186
00010a  6b18              LDR      r0,[r3,#0x30]         ;187  ; Para
00010c  eb000080          ADD      r0,r0,r0,LSL #2       ;187
000110  0040              LSLS     r0,r0,#1              ;187
000112  e79e              B        |L1.82|
;;;219    }
;;;220    
                          ENDP

                  |L1.276|
                          DCD      ||.bss||+0x7d0
                  |L1.280|
                          DCD      DISS_Voltage
                  |L1.284|
00011c  447a0000          DCFS     0x447a0000 ; 1000
                  |L1.288|
                          DCD      DISS_Current
                  |L1.292|
                          DCD      ||area_number.11||
                  |L1.296|
                          DCD      Temperature
                  |L1.300|
                          DCD      Para
                  |L1.304|
                          DCD      mode_sw

                          AREA ||i.TIM3_IRQHandler||, CODE, READONLY, ALIGN=2

                  TIM3_IRQHandler PROC
;;;268    
;;;269    void TIM3_IRQHandler(void){
000000  e92d5ff0          PUSH     {r4-r12,lr}
000004  ed2d8b04          VPUSH    {d8-d9}
;;;270    	
;;;271    	float ftemp = 0;
000008  ed9f8af9          VLDR     s16,|L2.1008|
;;;272    	float step_c = 0;
;;;273    	int step_time = 0;
;;;274    	float LPower,PPower;
;;;275    	u8 i;
;;;276    
;;;277    	
;;;278        if(TIM_GetITStatus(TIM3,TIM_IT_Update) == SET) 
00000c  2101              MOVS     r1,#1
00000e  48f9              LDR      r0,|L2.1012|
000010  f7fffffe          BL       TIM_GetITStatus
000014  2801              CMP      r0,#1
000016  d172              BNE      |L2.254|
;;;279        {
;;;280    		readpowflag ++;//读取电源数据计时
000018  48f7              LDR      r0,|L2.1016|
00001a  6801              LDR      r1,[r0,#0]  ; readpowflag
00001c  1c49              ADDS     r1,r1,#1
00001e  6001              STR      r1,[r0,#0]  ; readpowflag
;;;281    		
;;;282    		if( ms_time > (1 << 31) - 2 )
000020  48f6              LDR      r0,|L2.1020|
000022  6902              LDR      r2,[r0,#0x10]  ; ms_time
000024  49f6              LDR      r1,|L2.1024|
000026  2400              MOVS     r4,#0
000028  428a              CMP      r2,r1
00002a  d900              BLS      |L2.46|
;;;283    			
;;;284    			ms_time = 0;
00002c  6104              STR      r4,[r0,#0x10]  ; ms_time
                  |L2.46|
;;;285    		
;;;286    		if( abc_time > (1 << 31) - 2 )
00002e  68c2              LDR      r2,[r0,#0xc]  ; abc_time
000030  428a              CMP      r2,r1
000032  d900              BLS      |L2.54|
;;;287    			
;;;288    			abc_time = 0;
000034  60c4              STR      r4,[r0,#0xc]  ; abc_time
                  |L2.54|
;;;289    		if(finishdelay != 0)
000036  4680              MOV      r8,r0
000038  6ac0              LDR      r0,[r0,#0x2c]  ; finishdelay
00003a  b120              CBZ      r0,|L2.70|
;;;290    		{
;;;291    			finishdelay --;
00003c  f8d8102c          LDR      r1,[r8,#0x2c]  ; finishdelay
000040  1e49              SUBS     r1,r1,#1
000042  f8c8102c          STR      r1,[r8,#0x2c]  ; finishdelay
                  |L2.70|
;;;292    		}
;;;293    		
;;;294    		switch(MODE){
000046  48ef              LDR      r0,|L2.1028|
000048  7801              LDRB     r1,[r0,#0]  ; MODE
;;;295    			
;;;296    			//程控负载
;;;297    			case 0:{
;;;298    				
;;;299    				if(rmtrig[0] == 1)
;;;300    				{
;;;301    					if( ms_time%1000 == 0 && ms_time > 999 ){
;;;302    						ftemp = DISS_Current * 1000 * 1/3600;
00004a  ed9f0aef          VLDR     s0,|L2.1032|
00004e  eddf8aef          VLDR     s17,|L2.1036|
000052  48ef              LDR      r0,|L2.1040|
;;;303    						CDC_CsumMah += ftemp ;
000054  f8dfa3bc          LDR      r10,|L2.1044|
000058  2501              MOVS     r5,#1                 ;278
;;;304    						battery_c = CDC_CsumMah;
;;;305    						SendToPC(0);
;;;306    					}
;;;307    					
;;;308    				}else{
;;;309    					CDC_CsumMah = 0;
;;;310    					battery_c = 0;
;;;311    				}
;;;312    				if(mainswitch == 1)
00005a  4fef              LDR      r7,|L2.1048|
00005c  f8dfb3bc          LDR      r11,|L2.1052|
000060  f44f797a          MOV      r9,#0x3e8             ;301
000064  2906              CMP      r1,#6                 ;294
000066  d210              BCS      |L2.138|
000068  e8dff001          TBB      [pc,r1]               ;294
00006c  03416d0f          DCB      0x03,0x41,0x6d,0x0f
000070  0ffd              DCB      0x0f,0xfd
000072  7800              LDRB     r0,[r0,#0]            ;299  ; rmtrig
000074  2801              CMP      r0,#1                 ;299
000076  d009              BEQ      |L2.140|
000078  ed8a8a00          VSTR     s16,[r10,#0]          ;309
00007c  f8c84030          STR      r4,[r8,#0x30]         ;310  ; battery_c
                  |L2.128|
000080  7838              LDRB     r0,[r7,#0]  ; mainswitch
000082  2801              CMP      r0,#1
000084  d024              BEQ      |L2.208|
;;;313    				{
;;;314    					if(watchcount < 999)
;;;315    					{
;;;316    						watchcurrent[watchcount] = Vmon_Load_value;
;;;317    						watchcount++;
;;;318    					}
;;;319    				}else{
;;;320    					watchcount = 0;
000086  f8a84008          STRH     r4,[r8,#8]
                  |L2.138|
00008a  e351              B        |L2.1840|
                  |L2.140|
00008c  f8d82010          LDR      r2,[r8,#0x10]         ;301  ; ms_time
000090  4640              MOV      r0,r8                 ;301
000092  4649              MOV      r1,r9                 ;301
000094  fbb2f3f1          UDIV     r3,r2,r1              ;301
000098  fb092213          MLS      r2,r9,r3,r2           ;301
00009c  2a00              CMP      r2,#0                 ;301
00009e  d1ef              BNE      |L2.128|
0000a0  6902              LDR      r2,[r0,#0x10]         ;301  ; ms_time
0000a2  454a              CMP      r2,r9                 ;301
0000a4  d3ec              BCC      |L2.128|
0000a6  eddb0a00          VLDR     s1,[r11,#0]           ;302
0000aa  ee201aa8          VMUL.F32 s2,s1,s17             ;302
0000ae  eec10a00          VDIV.F32 s1,s2,s0              ;302
0000b2  ed9a0a00          VLDR     s0,[r10,#0]           ;303
0000b6  ee300a20          VADD.F32 s0,s0,s1              ;303
0000ba  ed8a0a00          VSTR     s0,[r10,#0]           ;303
0000be  eebc0ac0          VCVT.U32.F32 s0,s0                 ;304
0000c2  ee101a10          VMOV     r1,s0                 ;304
0000c6  6301              STR      r1,[r0,#0x30]         ;304  ; battery_c
0000c8  2000              MOVS     r0,#0                 ;305
0000ca  f7fffffe          BL       SendToPC
0000ce  e7d7              B        |L2.128|
                  |L2.208|
0000d0  f8b80008          LDRH     r0,[r8,#8]            ;314  ; watchcount
0000d4  f24032e7          MOV      r2,#0x3e7             ;314
0000d8  4290              CMP      r0,r2                 ;314
0000da  d2d6              BCS      |L2.138|
0000dc  4ad0              LDR      r2,|L2.1056|
0000de  8812              LDRH     r2,[r2,#0]            ;316  ; Vmon_Load_value
0000e0  4bd0              LDR      r3,|L2.1060|
0000e2  f8232010          STRH     r2,[r3,r0,LSL #1]     ;316
0000e6  1c40              ADDS     r0,r0,#1              ;316
0000e8  f8a80008          STRH     r0,[r8,#8]            ;317
0000ec  e320              B        |L2.1840|
;;;321    				}
;;;322    			}
;;;323    			break;
;;;324    			
;;;325    			//程控电源
;;;326    			case 1:{
;;;327    				if(rmtrig[1] == 1)
0000ee  7840              LDRB     r0,[r0,#1]  ; rmtrig
0000f0  2801              CMP      r0,#1
0000f2  d005              BEQ      |L2.256|
;;;328    				{
;;;329    					if( ms_time%1000 == 0 && ms_time > 999 ){
;;;330    	
;;;331    						ftemp = DISS_POW_Current * 1000 * 1/3600;
;;;332    						
;;;333    						CDC_CsumMah += ftemp ;
;;;334    						battery_c = CDC_CsumMah;
;;;335    						SendToPC(1);
;;;336    					}
;;;337    					
;;;338    					
;;;339    				}else{
;;;340    					CDC_CsumMah = 0;
0000f4  ed8a8a00          VSTR     s16,[r10,#0]
;;;341    					battery_c = 0;
0000f8  f8c84030          STR      r4,[r8,#0x30]  ; battery_c
0000fc  e318              B        |L2.1840|
                  |L2.254|
0000fe  e3fd              B        |L2.2300|
                  |L2.256|
000100  f8d82010          LDR      r2,[r8,#0x10]         ;329  ; ms_time
000104  4640              MOV      r0,r8                 ;329
000106  4649              MOV      r1,r9                 ;329
000108  fbb2f3f1          UDIV     r3,r2,r1              ;329
00010c  fb092213          MLS      r2,r9,r3,r2           ;329
000110  2a00              CMP      r2,#0                 ;329
000112  d1ba              BNE      |L2.138|
000114  6902              LDR      r2,[r0,#0x10]         ;329  ; ms_time
000116  454a              CMP      r2,r9                 ;329
000118  d3b7              BCC      |L2.138|
00011a  49c3              LDR      r1,|L2.1064|
00011c  edd10a00          VLDR     s1,[r1,#0]            ;331
000120  ee201aa8          VMUL.F32 s2,s1,s17             ;331
000124  eec10a00          VDIV.F32 s1,s2,s0              ;331
000128  ed9a0a00          VLDR     s0,[r10,#0]           ;333
00012c  ee300a20          VADD.F32 s0,s0,s1              ;333
000130  ed8a0a00          VSTR     s0,[r10,#0]           ;333
000134  eebc0ac0          VCVT.U32.F32 s0,s0                 ;334
000138  ee101a10          VMOV     r1,s0                 ;334
00013c  6301              STR      r1,[r0,#0x30]         ;334  ; battery_c
00013e  2001              MOVS     r0,#1                 ;335
000140  f7fffffe          BL       SendToPC
000144  e2f4              B        |L2.1840|
;;;342    				}
;;;343    			}
;;;344    			break;
;;;345    			
;;;346    			//过流
;;;347    			case 2:{
;;;348    				
;;;349    				if( trig_flag_state == 1 && C_DISCHARGE == 1){		
000146  4ab9              LDR      r2,|L2.1068|
000148  7810              LDRB     r0,[r2,#0]  ; trig_flag_state
;;;350    //					finishflag = 0;
;;;351    					step_c =  (float)Para.IR_Step_C / 1000 ;
;;;352    					
;;;353    					step_time = (int)Para.IR_Step_Time;
;;;354    					
;;;355    					if( step_time < 1 ){
;;;356    						
;;;357    						step_time = 1;
;;;358    					}
;;;359    					
;;;360    													
;;;361    					
;;;362    					if( trig_flag_state != 0 )
;;;363    					{						
;;;364    						if( DISS_Current > old_I )
;;;365    								
;;;366    							old_I = DISS_Current;
;;;367    
;;;368    						if( ms_time%step_time == 0)
;;;369    						{
;;;370    								
;;;371    //							max_discahrgeNum += step_c;
;;;372    //									
;;;373    //							Para.CSET_Current_Laod = (int)(max_discahrgeNum * 1000);
;;;374    							
;;;375    							max_discahrgeNum = old_I;
;;;376    							Para.CSET_Current_Laod += Para.IR_Step_C;
;;;377    						}
;;;378    						if( old_I != 0 ){
;;;379    						
;;;380    							if( old_I - DISS_Current > 0.002 /*DISS_Current < old_I*/ || DISS_Voltage < 0.1){
;;;381    								max_discahrgeNum = old_I;
;;;382    								g_tModS.TxBuf[13] = (int)(max_discahrgeNum*100)>>8;
;;;383    								g_tModS.TxBuf[14] = (int)(max_discahrgeNum*100);
;;;384    								trig_flag_state = 0;
;;;385    								Off_GPOI_ResetSet();  
;;;386    //								mainswitch = 0;
;;;387    								if(Para.ACT_DELAY != 0)
;;;388    								{
;;;389    									recharge = 1000*Para.ACT_DELAY;
;;;390    								}else{
;;;391    									recharge = 1000;
;;;392    								}
;;;393    								Para.POWER_OutPut_V = (int)(testv*1000) + 3000;
;;;394    								Para.POWER_Limit_C = 1000;
;;;395    								mainswitch = 1;
;;;396    								sendwait = 1;
00014a  f8dfa2e4          LDR      r10,|L2.1072|
00014e  2801              CMP      r0,#1                 ;349
000150  d14c              BNE      |L2.492|
000152  48b8              LDR      r0,|L2.1076|
000154  7800              LDRB     r0,[r0,#0]            ;349  ; C_DISCHARGE
000156  2801              CMP      r0,#1                 ;349
000158  d148              BNE      |L2.492|
00015a  48b7              LDR      r0,|L2.1080|
00015c  f8301f48          LDRH     r1,[r0,#0x48]!        ;351  ; Para
000160  8901              LDRH     r1,[r0,#8]            ;353  ; Para
000162  2901              CMP      r1,#1                 ;355
000164  da00              BGE      |L2.360|
000166  2101              MOVS     r1,#1                 ;357
                  |L2.360|
000168  48b0              LDR      r0,|L2.1068|
00016a  7800              LDRB     r0,[r0,#0]            ;362  ; trig_flag_state
00016c  b3f0              CBZ      r0,|L2.492|
00016e  48b3              LDR      r0,|L2.1084|
000170  eddb0a00          VLDR     s1,[r11,#0]           ;364
000174  ed900a00          VLDR     s0,[r0,#0]            ;364
000178  eef40ac0          VCMPE.F32 s1,s0                 ;364
00017c  eef1fa10          VMRS     APSR_nzcv,FPSCR       ;364
000180  dd01              BLE      |L2.390|
000182  edc00a00          VSTR     s1,[r0,#0]            ;366
                  |L2.390|
000186  f8d82010          LDR      r2,[r8,#0x10]         ;368  ; ms_time
00018a  4646              MOV      r6,r8                 ;368
00018c  fbb2f3f1          UDIV     r3,r2,r1              ;368
000190  fb012113          MLS      r1,r1,r3,r2           ;368
000194  4aaa              LDR      r2,|L2.1088|
000196  b949              CBNZ     r1,|L2.428|
000198  ed900a00          VLDR     s0,[r0,#0]            ;375
00019c  49a6              LDR      r1,|L2.1080|
00019e  ed820a00          VSTR     s0,[r2,#0]            ;375
0001a2  694b              LDR      r3,[r1,#0x14]         ;376  ; Para
0001a4  f8b1c048          LDRH     r12,[r1,#0x48]        ;376  ; Para
0001a8  4463              ADD      r3,r3,r12             ;376
0001aa  614b              STR      r3,[r1,#0x14]         ;376  ; Para
                  |L2.428|
0001ac  ed900a00          VLDR     s0,[r0,#0]            ;378
0001b0  48a4              LDR      r0,|L2.1092|
0001b2  ed9f9aa5          VLDR     s18,|L2.1096|
0001b6  eeb50ac0          VCMPE.F32 s0,#0.0               ;378
0001ba  eef1fa10          VMRS     APSR_nzcv,FPSCR       ;378
0001be  d032              BEQ      |L2.550|
0001c0  ee700a60          VSUB.F32 s1,s0,s1              ;380
0001c4  4ba1              LDR      r3,|L2.1100|
0001c6  ee101a90          VMOV     r1,s1                 ;380
0001ca  4299              CMP      r1,r3                 ;380
0001cc  da03              BGE      |L2.470|
0001ce  49a0              LDR      r1,|L2.1104|
0001d0  6809              LDR      r1,[r1,#0]            ;380  ; DISS_Voltage
0001d2  4281              CMP      r1,r0                 ;380
0001d4  da51              BGE      |L2.634|
                  |L2.470|
0001d6  ed820a00          VSTR     s0,[r2,#0]            ;381
0001da  ee200a09          VMUL.F32 s0,s0,s18             ;382
0001de  eebd0ac0          VCVT.S32.F32 s0,s0                 ;382
0001e2  ee100a10          VMOV     r0,s0                 ;382
0001e6  0a01              LSRS     r1,r0,#8              ;382
0001e8  489a              LDR      r0,|L2.1108|
0001ea  e000              B        |L2.494|
                  |L2.492|
0001ec  e045              B        |L2.634|
                  |L2.494|
0001ee  f8001f2b          STRB     r1,[r0,#0x2b]!        ;382
0001f2  ee101a10          VMOV     r1,s0                 ;383
0001f6  7041              STRB     r1,[r0,#1]            ;383
0001f8  488c              LDR      r0,|L2.1068|
0001fa  7004              STRB     r4,[r0,#0]            ;384
0001fc  f7fffffe          BL       Off_GPOI_ResetSet
000200  e02c              B        |L2.604|
                  |L2.514|
000202  6231              STR      r1,[r6,#0x20]         ;391  ; recharge
;;;397    //								OnOff_GPOI_ResetSet(0,1);
;;;398    							}
;;;399    						}else{
;;;400    							if(DISS_Voltage < 0.1){
;;;401    								max_discahrgeNum = old_I;
;;;402    								Off_GPOI_ResetSet();
;;;403    								g_tModS.TxBuf[13] = (int)(max_discahrgeNum*100)>>8;
;;;404    								g_tModS.TxBuf[14] = (int)(max_discahrgeNum*100);
;;;405    								trig_flag_state = 0;
;;;406    	//							Off_GPOI_ResetSet();  
;;;407    //								mainswitch = 0;
;;;408    								if(Para.ACT_DELAY != 0)
;;;409    								{
;;;410    									recharge = 1000*Para.ACT_DELAY;
;;;411    								}else{
;;;412    									recharge = 1000;
;;;413    								}
;;;414    								Para.POWER_OutPut_V = (int)(testv*1000) + 3000;
000204  ed960a0a          VLDR     s0,[r6,#0x28]
000208  ee200a28          VMUL.F32 s0,s0,s17
00020c  eebd0ac0          VCVT.S32.F32 s0,s0
000210  ee101a10          VMOV     r1,s0
000214  f60131b8          ADD      r1,r1,#0xbb8
000218  6541              STR      r1,[r0,#0x54]  ; Para
;;;415    								Para.POWER_Limit_C = 1000;
00021a  f8a09058          STRH     r9,[r0,#0x58]
;;;416    								mainswitch = 1;
00021e  703d              STRB     r5,[r7,#0]
;;;417    								sendwait = 1;
000220  f88a5000          STRB     r5,[r10,#0]
000224  e029              B        |L2.634|
                  |L2.550|
000226  498a              LDR      r1,|L2.1104|
000228  6809              LDR      r1,[r1,#0]            ;400  ; DISS_Voltage
00022a  4281              CMP      r1,r0                 ;400
00022c  da25              BGE      |L2.634|
00022e  4884              LDR      r0,|L2.1088|
000230  ed800a00          VSTR     s0,[r0,#0]            ;401
000234  f7fffffe          BL       Off_GPOI_ResetSet
000238  4881              LDR      r0,|L2.1088|
00023a  4986              LDR      r1,|L2.1108|
00023c  ed900a00          VLDR     s0,[r0,#0]            ;403
000240  ee200a09          VMUL.F32 s0,s0,s18             ;403
000244  eebd0ac0          VCVT.S32.F32 s0,s0                 ;403
000248  ee100a10          VMOV     r0,s0                 ;403
00024c  0a00              LSRS     r0,r0,#8              ;403
00024e  f8010f2b          STRB     r0,[r1,#0x2b]!        ;403
000252  ee100a10          VMOV     r0,s0                 ;404
000256  7048              STRB     r0,[r1,#1]            ;404
000258  4874              LDR      r0,|L2.1068|
00025a  7004              STRB     r4,[r0,#0]            ;405
                  |L2.604|
00025c  4876              LDR      r0,|L2.1080|
00025e  f8901052          LDRB     r1,[r0,#0x52]         ;387  ; Para
000262  b141              CBZ      r1,|L2.630|
000264  e000              B        |L2.616|
000266  e092              B        |L2.910|
                  |L2.616|
000268  f8901052          LDRB     r1,[r0,#0x52]         ;410  ; Para
00026c  f44f727a          MOV      r2,#0x3e8             ;410
000270  fb11f102          SMULBB   r1,r1,r2              ;410
000274  e7c5              B        |L2.514|
                  |L2.630|
000276  4649              MOV      r1,r9                 ;412
000278  e7c3              B        |L2.514|
                  |L2.634|
;;;418    							}
;;;419    						}
;;;420    					}								
;;;421    				}
;;;422    				if(recharge != 0)
00027a  f8d80020          LDR      r0,[r8,#0x20]  ; recharge
00027e  4646              MOV      r6,r8
000280  b1b0              CBZ      r0,|L2.688|
;;;423    				{
;;;424    					recharge --;
000282  6a30              LDR      r0,[r6,#0x20]  ; recharge
000284  1e40              SUBS     r0,r0,#1
000286  6230              STR      r0,[r6,#0x20]  ; recharge
;;;425    					if(recharge == 0)
000288  6a30              LDR      r0,[r6,#0x20]  ; recharge
00028a  b988              CBNZ     r0,|L2.688|
;;;426    					{
;;;427    						mainswitch = 0;
00028c  703c              STRB     r4,[r7,#0]
;;;428    						sendwait = 3;
00028e  2003              MOVS     r0,#3
000290  f88a0000          STRB     r0,[r10,#0]
;;;429    //						Off_GPOI_ResetSet();
;;;430    						LOAD_MODE = 1;
000294  4870              LDR      r0,|L2.1112|
000296  6185              STR      r5,[r0,#0x18]  ; Run_Control
;;;431    						GPIO_SetBits(GPIOC,GPIO_Pin_12);//CV模式
000298  f44f5180          MOV      r1,#0x1000
00029c  486f              LDR      r0,|L2.1116|
00029e  f7fffffe          BL       GPIO_SetBits
;;;432    						shortflag = 1;
0002a2  7075              STRB     r5,[r6,#1]
;;;433    						Para.CSET_Voltage_Laod = 0;
0002a4  4864              LDR      r0,|L2.1080|
0002a6  6104              STR      r4,[r0,#0x10]  ; Para
;;;434    //						Para.CSET_Current_Laod = (int)(max_discahrgeNum*1000) + 3000;
;;;435    						OnOff_GPOI_ResetSet(2,1);
0002a8  2101              MOVS     r1,#1
0002aa  2002              MOVS     r0,#2
0002ac  f7fffffe          BL       OnOff_GPOI_ResetSet
                  |L2.688|
;;;436    					}
;;;437    				}
;;;438    				if(shortflag == 1)
0002b0  7870              LDRB     r0,[r6,#1]  ; shortflag
0002b2  2801              CMP      r0,#1
0002b4  d13d              BNE      |L2.818|
;;;439    				{
;;;440    					shorttime ++;
0002b6  7830              LDRB     r0,[r6,#0]  ; shorttime
0002b8  1c40              ADDS     r0,r0,#1
0002ba  7030              STRB     r0,[r6,#0]
;;;441    //					if( DISS_Current > shortold_I )
;;;442    //					{
;;;443    //						shortold_I = DISS_Current;
;;;444    //					}
;;;445    //					if( shortold_I != 0 )
;;;446    //					{
;;;447    //						if( shortold_I - DISS_Current > 0.002 /*DISS_Current < old_I*//* || DISS_Voltage < 0.1*/){
;;;448    //							shortflag = 0;
;;;449    //							Off_GPOI_ResetSet();
;;;450    //							g_tModS.TxBuf[15] = (shorttime)>>8;
;;;451    //							g_tModS.TxBuf[16] = (shorttime);
;;;452    //							MODS_SendWithCRC(g_tModS.TxBuf, g_tModS.TxCount);
;;;453    //							if(Para.ACT_DELAY != 0)
;;;454    //							{
;;;455    //								reboot = 1000*Para.ACT_DELAY;
;;;456    //							}else{
;;;457    //								reboot = 1000;
;;;458    //							}
;;;459    //	//						reboot = 5000;
;;;460    //							Para.POWER_OutPut_V = (int)(testv*1000) + 3000;
;;;461    //							Para.POWER_Limit_C = 1000;
;;;462    //							mainswitch = 1;
;;;463    //							sendwait = 1;
;;;464    //							shortold_I = 0;
;;;465    //						}
;;;466    //					}
;;;467    					if(DISS_Voltage/testv < 0.4 || shorttime==255)
0002bc  4864              LDR      r0,|L2.1104|
0002be  ed961a0a          VLDR     s2,[r6,#0x28]
0002c2  4967              LDR      r1,|L2.1120|
0002c4  edd00a00          VLDR     s1,[r0,#0]
0002c8  ee800a81          VDIV.F32 s0,s1,s2
0002cc  ee100a10          VMOV     r0,s0
0002d0  4288              CMP      r0,r1
0002d2  db02              BLT      |L2.730|
0002d4  7830              LDRB     r0,[r6,#0]  ; shorttime
0002d6  28ff              CMP      r0,#0xff
0002d8  d12b              BNE      |L2.818|
                  |L2.730|
;;;468    					{
;;;469    						shortflag = 0;
0002da  7074              STRB     r4,[r6,#1]
;;;470    						Off_GPOI_ResetSet();
0002dc  f7fffffe          BL       Off_GPOI_ResetSet
;;;471    						g_tModS.TxBuf[15] = (shorttime)>>8;
0002e0  7830              LDRB     r0,[r6,#0]  ; shorttime
0002e2  485c              LDR      r0,|L2.1108|
0002e4  f8004f2d          STRB     r4,[r0,#0x2d]!
;;;472    						g_tModS.TxBuf[16] = (shorttime);
0002e8  7831              LDRB     r1,[r6,#0]  ; shorttime
0002ea  7041              STRB     r1,[r0,#1]
;;;473    						MODS_SendWithCRC(g_tModS.TxBuf, g_tModS.TxCount);
0002ec  f8901075          LDRB     r1,[r0,#0x75]  ; g_tModS
0002f0  4858              LDR      r0,|L2.1108|
0002f2  301e              ADDS     r0,r0,#0x1e
0002f4  f7fffffe          BL       MODS_SendWithCRC
;;;474    						if(Para.ACT_DELAY != 0)
0002f8  484f              LDR      r0,|L2.1080|
0002fa  f8901052          LDRB     r1,[r0,#0x52]  ; Para
0002fe  b131              CBZ      r1,|L2.782|
;;;475    						{
;;;476    							reboot = 1000*Para.ACT_DELAY;
000300  f8901052          LDRB     r1,[r0,#0x52]  ; Para
000304  f44f727a          MOV      r2,#0x3e8
000308  fb11f102          SMULBB   r1,r1,r2
00030c  e000              B        |L2.784|
                  |L2.782|
;;;477    						}else{
;;;478    							reboot = 1000;
00030e  4649              MOV      r1,r9
                  |L2.784|
000310  6271              STR      r1,[r6,#0x24]  ; reboot
;;;479    						}
;;;480    //						reboot = 5000;
;;;481    						Para.POWER_OutPut_V = (int)(testv*1000) + 3000;
000312  ed960a0a          VLDR     s0,[r6,#0x28]
000316  ee200a28          VMUL.F32 s0,s0,s17
00031a  eebd0ac0          VCVT.S32.F32 s0,s0
00031e  ee101a10          VMOV     r1,s0
000322  f60131b8          ADD      r1,r1,#0xbb8
000326  6541              STR      r1,[r0,#0x54]  ; Para
;;;482    						Para.POWER_Limit_C = 1000;
000328  f8a09058          STRH     r9,[r0,#0x58]
;;;483    						mainswitch = 1;
00032c  703d              STRB     r5,[r7,#0]
;;;484    						sendwait = 1;
00032e  f88a5000          STRB     r5,[r10,#0]
                  |L2.818|
;;;485    					}
;;;486    				}
;;;487    				if(reboot != 0)
000332  6a70              LDR      r0,[r6,#0x24]  ; reboot
000334  2800              CMP      r0,#0
000336  d029              BEQ      |L2.908|
;;;488    				{
;;;489    					reboot --;
000338  6a71              LDR      r1,[r6,#0x24]  ; reboot
00033a  46b0              MOV      r8,r6
00033c  1e49              SUBS     r1,r1,#1
00033e  6271              STR      r1,[r6,#0x24]  ; reboot
;;;490    					if(reboot == 0)
000340  6a70              LDR      r0,[r6,#0x24]  ; reboot
000342  2800              CMP      r0,#0
000344  d122              BNE      |L2.908|
;;;491    					{
;;;492    						mainswitch = 0;
000346  703c              STRB     r4,[r7,#0]
;;;493    						sendwait = 3;
000348  2003              MOVS     r0,#3
00034a  f88a0000          STRB     r0,[r10,#0]
;;;494    //						Off_GPOI_ResetSet();
;;;495    						Para.CSET_Current_Laod =  Para.IR_Start_C;
00034e  4e3a              LDR      r6,|L2.1080|
000350  6c70              LDR      r0,[r6,#0x44]  ; Para
000352  6170              STR      r0,[r6,#0x14]  ; Para
;;;496    						LOAD_MODE = 0;
000354  4840              LDR      r0,|L2.1112|
000356  6184              STR      r4,[r0,#0x18]  ; Run_Control
;;;497    						GPIO_ResetBits(GPIOC,GPIO_Pin_12);//CC模式
000358  f44f5180          MOV      r1,#0x1000
00035c  483f              LDR      r0,|L2.1116|
00035e  f7fffffe          BL       GPIO_ResetBits
;;;498    						finishflag = 1;
000362  4640              MOV      r0,r8
000364  f8885002          STRB     r5,[r8,#2]
;;;499    						mainswitch = 0;
000368  703c              STRB     r4,[r7,#0]
;;;500    						if(Para.ACT_DELAY != 0)
00036a  f8961052          LDRB     r1,[r6,#0x52]  ; Para
00036e  b131              CBZ      r1,|L2.894|
;;;501    						{
;;;502    							finishdelay = 1000*Para.ACT_DELAY;
000370  f8962052          LDRB     r2,[r6,#0x52]  ; Para
000374  f44f717a          MOV      r1,#0x3e8
000378  fb12f101          SMULBB   r1,r2,r1
00037c  e000              B        |L2.896|
                  |L2.894|
;;;503    						}else{
;;;504    							finishdelay = 1000;
00037e  4649              MOV      r1,r9
                  |L2.896|
000380  62c1              STR      r1,[r0,#0x2c]  ; finishdelay
;;;505    						}
;;;506    						TIM_SetCompare1(TIM1,33000/2);
000382  f2440174          MOV      r1,#0x4074
000386  4837              LDR      r0,|L2.1124|
000388  f7fffffe          BL       TIM_SetCompare1
                  |L2.908|
00038c  e1d0              B        |L2.1840|
                  |L2.910|
;;;507    //						finishdelay = 5000;
;;;508    					}
;;;509    				}
;;;510    			}
;;;511    			break;
;;;512    			
;;;513    //			//程控负载	
;;;514    //			case 2:{
;;;515    //				
;;;516    //				
;;;517    //			}
;;;518    //			break;
;;;519    			
;;;520    			//充放电
;;;521    			case 3:{
;;;522    				
;;;523    				
;;;524    			}
;;;525    			break;
;;;526    			//曲线图
;;;527    			case 4:{
;;;528    				
;;;529    				
;;;530    			}
;;;531    			break;
;;;532    			//充放电
;;;533    			case 5:{
;;;534    				if(rmtrig[2] == 1)
00038e  4820              LDR      r0,|L2.1040|
000390  7880              LDRB     r0,[r0,#2]  ; rmtrig
000392  2801              CMP      r0,#1
000394  d1fa              BNE      |L2.908|
;;;535    				{
;;;536    					if( ms_time%1000 == 0 && ms_time > 999 ){
000396  f8d80010          LDR      r0,[r8,#0x10]  ; ms_time
00039a  4649              MOV      r1,r9
00039c  fbb0f2f1          UDIV     r2,r0,r1
0003a0  fb090012          MLS      r0,r9,r2,r0
;;;537    				
;;;538    						if( mode_sw == 1 ){
0003a4  4e30              LDR      r6,|L2.1128|
0003a6  bb08              CBNZ     r0,|L2.1004|
0003a8  f8d82010          LDR      r2,[r8,#0x10]         ;536  ; ms_time
0003ac  4640              MOV      r0,r8                 ;536
0003ae  454a              CMP      r2,r9                 ;536
0003b0  d37d              BCC      |L2.1198|
0003b2  7831              LDRB     r1,[r6,#0]  ; mode_sw
0003b4  2901              CMP      r1,#1
0003b6  d008              BEQ      |L2.970|
;;;539    							dctime++;	
;;;540    							ftemp = DISS_Current * 1000 * 1/3600;
;;;541    							CDC_DCsumMah += ftemp;	 
;;;542    							battery_c = CDC_DCsumMah;
;;;543    						}else if( mode_sw == 0 ){
0003b8  7831              LDRB     r1,[r6,#0]  ; mode_sw
0003ba  b1c1              CBZ      r1,|L2.1006|
;;;544    							ctime++;
;;;545    //							DISS_POW_Current=(float)Para.CCurrent/100;	
;;;546    							ftemp = DISS_POW_Current * 1000 * 1/3600;
;;;547    							CDC_CsumMah += ftemp;
;;;548    							battery_c = CDC_CsumMah;
;;;549    						}else if(mode_sw == 2){
0003bc  7831              LDRB     r1,[r6,#0]  ; mode_sw
0003be  2902              CMP      r1,#2
0003c0  d067              BEQ      |L2.1170|
;;;550    							battery_c = CDC_CsumMah;
;;;551    						}else if(mode_sw == 3){
0003c2  7831              LDRB     r1,[r6,#0]  ; mode_sw
0003c4  2903              CMP      r1,#3
0003c6  d067              BEQ      |L2.1176|
0003c8  e06e              B        |L2.1192|
                  |L2.970|
0003ca  6b81              LDR      r1,[r0,#0x38]         ;539  ; dctime
0003cc  1c49              ADDS     r1,r1,#1              ;539
0003ce  6381              STR      r1,[r0,#0x38]         ;539  ; dctime
0003d0  eddb0a00          VLDR     s1,[r11,#0]           ;540
0003d4  4925              LDR      r1,|L2.1132|
0003d6  ee201aa8          VMUL.F32 s2,s1,s17             ;540
0003da  eec10a00          VDIV.F32 s1,s2,s0              ;540
0003de  ed910a00          VLDR     s0,[r1,#0]            ;541
0003e2  ee300a20          VADD.F32 s0,s0,s1              ;541
0003e6  ed810a00          VSTR     s0,[r1,#0]            ;541
0003ea  e058              B        |L2.1182|
                  |L2.1004|
0003ec  e05f              B        |L2.1198|
                  |L2.1006|
0003ee  e03f              B        |L2.1136|
                  |L2.1008|
0003f0  00000000          DCFS     0x00000000 ; 0
                  |L2.1012|
                          DCD      0x40000400
                  |L2.1016|
                          DCD      readpowflag
                  |L2.1020|
                          DCD      ||area_number.11||
                  |L2.1024|
                          DCD      0x7ffffffe
                  |L2.1028|
                          DCD      MODE
                  |L2.1032|
000408  45610000          DCFS     0x45610000 ; 3600
                  |L2.1036|
00040c  447a0000          DCFS     0x447a0000 ; 1000
                  |L2.1040|
                          DCD      rmtrig
                  |L2.1044|
                          DCD      CDC_CsumMah
                  |L2.1048|
                          DCD      mainswitch
                  |L2.1052|
                          DCD      DISS_Current
                  |L2.1056|
                          DCD      Vmon_Load_value
                  |L2.1060|
                          DCD      ||.bss||
                  |L2.1064|
                          DCD      DISS_POW_Current
                  |L2.1068|
                          DCD      trig_flag_state
                  |L2.1072|
                          DCD      sendwait
                  |L2.1076|
                          DCD      C_DISCHARGE
                  |L2.1080|
                          DCD      Para
                  |L2.1084|
                          DCD      old_I
                  |L2.1088|
                          DCD      max_discahrgeNum
                  |L2.1092|
                          DCD      0x3dcccccd
                  |L2.1096|
000448  42c80000          DCFS     0x42c80000 ; 100
                  |L2.1100|
                          DCD      0x3b03126f
                  |L2.1104|
                          DCD      DISS_Voltage
                  |L2.1108|
                          DCD      g_tModS
                  |L2.1112|
                          DCD      Run_Control
                  |L2.1116|
                          DCD      0x40020800
                  |L2.1120|
                          DCD      0x3ecccccd
                  |L2.1124|
                          DCD      0x40010000
                  |L2.1128|
                          DCD      mode_sw
                  |L2.1132|
                          DCD      CDC_DCsumMah
                  |L2.1136|
000470  6b41              LDR      r1,[r0,#0x34]         ;544  ; ctime
000472  1c49              ADDS     r1,r1,#1              ;544
000474  6341              STR      r1,[r0,#0x34]         ;544  ; ctime
000476  49fb              LDR      r1,|L2.2148|
000478  edd10a00          VLDR     s1,[r1,#0]            ;546
00047c  ee201aa8          VMUL.F32 s2,s1,s17             ;546
000480  eec10a00          VDIV.F32 s1,s2,s0              ;546
000484  ed9a0a00          VLDR     s0,[r10,#0]           ;547
000488  ee300a20          VADD.F32 s0,s0,s1              ;547
00048c  ed8a0a00          VSTR     s0,[r10,#0]           ;547
000490  e005              B        |L2.1182|
                  |L2.1170|
000492  ed9a0a00          VLDR     s0,[r10,#0]           ;550
000496  e002              B        |L2.1182|
                  |L2.1176|
;;;552    							battery_c = CDC_DCsumMah;
000498  49f3              LDR      r1,|L2.2152|
00049a  ed910a00          VLDR     s0,[r1,#0]
                  |L2.1182|
00049e  eebc0ac0          VCVT.U32.F32 s0,s0
0004a2  ee101a10          VMOV     r1,s0
0004a6  6301              STR      r1,[r0,#0x30]  ; battery_c
                  |L2.1192|
;;;553    						}
;;;554    						SendToPC(2);
0004a8  2002              MOVS     r0,#2
0004aa  f7fffffe          BL       SendToPC
                  |L2.1198|
;;;555    						
;;;556    						
;;;557    					}
;;;558    					if(mode_sw == 0)
0004ae  48ef              LDR      r0,|L2.2156|
0004b0  7801              LDRB     r1,[r0,#0]  ; mode_sw
;;;559    					{
;;;560    						if(sendmodeflag == 1)
0004b2  48ef              LDR      r0,|L2.2160|
0004b4  b161              CBZ      r1,|L2.1232|
;;;561    						{
;;;562    							for(i=0;i<3;i++)
;;;563    							{
;;;564    								MODS_SendWithCRC(sendmodepow,6);
;;;565    								Delay_ms(SENDPCDELAY);
;;;566    							}
;;;567    							sendmodeflag = 0;
;;;568    						}
;;;569    						if(cdcswdelay != 0)
;;;570    						{
;;;571    							cdcswdelay --;
;;;572    						}
;;;573    						if(Para.CaPCTIME == 0)
;;;574    						{
;;;575    //							if(charge_step == 1)
;;;576    //							{
;;;577    //								if(Para.CPOW_Voltage*10 >= Para.CDC_Ccutoff_V && Para.CDC_Ccutoff_V != 0 && cdcswdelay == 0)
;;;578    //								{
;;;579    //									Para.CSET_Voltage = Para.CDC_Ccutoff_V;
;;;580    //									charge_step = 2;
;;;581    //									cdcswdelay = 5000;
;;;582    //								}
;;;583    //							}else if(charge_step == 2){
;;;584    								if(Para.CCurrent*10 < Para.CDC_Ccutoff_C && Para.CDC_Ccutoff_C != 0 && cdcswdelay == 0)
;;;585    								{
;;;586    									charge_step = 1;
;;;587    	//								GPIO_ResetBits(GPIOC,GPIO_Pin_1); //关闭电源输出
;;;588    	//								Para.CSET_Voltage = 0;
;;;589    	//								Para.CSET_Current = 0;
;;;590    	//								GPIO_ResetBits(GPIOE,GPIO_Pin_2); //关闭电源输出继电器
;;;591    									mainswitch = 0;
;;;592    									ctime=0;
;;;593    									listsend = 1;
;;;594    									mode_sw = 2;
;;;595    //									mode_sw = 1;
;;;596    									sendmodeflag = 1;
;;;597    									capwait = Para.CDC_Gap_Time*1000;
;;;598    //									cdcswdelay = 5000;
;;;599    								}
;;;600    //							}
;;;601    						}else{
;;;602    							if(ctime >= Para.CaPCTIME && cdcswdelay == 0)
;;;603    							{
;;;604    								charge_step = 1;
;;;605    //								GPIO_ResetBits(GPIOC,GPIO_Pin_1); //关闭电源输出
;;;606    //								Para.CSET_Voltage = 0;
;;;607    //								Para.CSET_Current = 0;
;;;608    //								GPIO_ResetBits(GPIOE,GPIO_Pin_2); //关闭电源输出继电器
;;;609    								mainswitch = 0;
;;;610    								ctime=0;
;;;611    								listsend = 1;
;;;612    								mode_sw = 2;
;;;613    //									mode_sw = 1;
;;;614    								sendmodeflag = 1;
;;;615    								capwait = Para.CDC_Gap_Time*1000;
;;;616    //									cdcswdelay = 5000;
;;;617    							}
;;;618    						}
;;;619    					}else if(mode_sw == 1){//放电
0004b6  49ed              LDR      r1,|L2.2156|
0004b8  7809              LDRB     r1,[r1,#0]  ; mode_sw
0004ba  2901              CMP      r1,#1
0004bc  d049              BEQ      |L2.1362|
;;;620    						if(sendmodeflag == 1)
;;;621    						{
;;;622    							for(i=0;i<3;i++)
;;;623    							{
;;;624    								MODS_SendWithCRC(sendmodeload,6);
;;;625    								Delay_ms(SENDPCDELAY);
;;;626    							}
;;;627    							sendmodeflag = 0;
;;;628    							Delay_ms(100);
;;;629    							Flag_Swtich_ON = 1;
;;;630    							GPIO_ResetBits(GPIOC,GPIO_Pin_7);//On
;;;631    						}
;;;632    						if(cdcswdelay != 0)
;;;633    						{
;;;634    							cdcswdelay --;
;;;635    						}
;;;636    						if(Para.CaPDCTIME == 0)
;;;637    						{
;;;638    							if(Para.CVoltage < Para.CDC_Dcutoff_V && cdcswdelay == 0)
;;;639    							{
;;;640    								Flag_Swtich_ON = 0;
;;;641    								GPIO_SetBits(GPIOC,GPIO_Pin_7);//OFF
;;;642    								if(loop == Para.CDC_Cycle_Time)
;;;643    								{
;;;644    									loop = 1;
;;;645    									battery_c = battery_c/Para.CDC_Cycle_Time;
;;;646    									for(i=0;i<3;i++)
;;;647    									{
;;;648    										if(rmtrig[2] == 1)
;;;649    										{
;;;650    	//										SendToPC(2);
;;;651    										}
;;;652    										Delay_ms(SENDPCDELAY);
;;;653    										MODS_SendWithCRC(sendmodestop,6);
;;;654    										Delay_ms(SENDPCDELAY);
;;;655    									}
;;;656    									rmtrig[2] = 0;
;;;657    									CDC_CsumMah = 0;
;;;658    									CDC_DCsumMah = 0;
;;;659    									dctime = 0;
;;;660    								}else{
;;;661    	//								CDC_CsumMah = 0;
;;;662    	//								CDC_DCsumMah = 0;
;;;663    									Flag_Swtich_ON = 0;
;;;664    									GPIO_SetBits(GPIOC,GPIO_Pin_7);//OFF
;;;665    									Delay_ms(100);
;;;666    									dctime = 0;
;;;667    									mode_sw = 3;
;;;668    									sendmodeflag = 1;
;;;669    									capwait = Para.CDC_Gap_Time*1000;
;;;670    //									mode_sw = 0;
;;;671    	//								GPIO_SetBits(GPIOE,GPIO_Pin_2);   //打开电源输出继电器
;;;672    	//								Para.CSET_Voltage = Para.CDC_OutPut_V;
;;;673    	//								Para.CSET_Current = Para.CDC_Limit_C;
;;;674    	//								GPIO_SetBits(GPIOC,GPIO_Pin_1);   //打开电源输出
;;;675    //									mainswitch = 1;
;;;676    //									listsend = 1;
;;;677    //									sendmodeflag = 1;
;;;678    //									charge_step = 1;
;;;679    //									cdcswdelay = 5000;
;;;680    //									loop ++;	
;;;681    								}
;;;682    							}
;;;683    						}else{
;;;684    							if(dctime >= Para.CaPDCTIME && cdcswdelay == 0)
;;;685    							{
;;;686    								Flag_Swtich_ON = 0;
;;;687    								GPIO_SetBits(GPIOC,GPIO_Pin_7);//OFF
;;;688    								if(loop == Para.CDC_Cycle_Time)
;;;689    								{
;;;690    									loop = 1;
;;;691    									battery_c = battery_c/Para.CDC_Cycle_Time;
;;;692    									for(i=0;i<3;i++)
;;;693    									{
;;;694    										if(rmtrig[2] == 1)
;;;695    										{
;;;696    	//										SendToPC(2);
;;;697    										}
;;;698    										Delay_ms(SENDPCDELAY);
;;;699    										MODS_SendWithCRC(sendmodestop,6);
;;;700    										Delay_ms(SENDPCDELAY);
;;;701    									}
;;;702    									rmtrig[2] = 0;
;;;703    									CDC_CsumMah = 0;
;;;704    									CDC_DCsumMah = 0;
;;;705    									dctime = 0;
;;;706    								}else{
;;;707    	//								CDC_CsumMah = 0;
;;;708    	//								CDC_DCsumMah = 0;
;;;709    									Flag_Swtich_ON = 0;
;;;710    									GPIO_SetBits(GPIOC,GPIO_Pin_7);//OFF
;;;711    									Delay_ms(100);
;;;712    									dctime = 0;
;;;713    									mode_sw = 3;
;;;714    									sendmodeflag = 1;
;;;715    									capwait = Para.CDC_Gap_Time*1000;
;;;716    //									mode_sw = 0;
;;;717    	//								GPIO_SetBits(GPIOE,GPIO_Pin_2);   //打开电源输出继电器
;;;718    	//								Para.CSET_Voltage = Para.CDC_OutPut_V;
;;;719    	//								Para.CSET_Current = Para.CDC_Limit_C;
;;;720    	//								GPIO_SetBits(GPIOC,GPIO_Pin_1);   //打开电源输出
;;;721    //									mainswitch = 1;
;;;722    //									listsend = 1;
;;;723    //									sendmodeflag = 1;
;;;724    //									charge_step = 1;
;;;725    //									cdcswdelay = 5000;
;;;726    //									loop ++;	
;;;727    								}
;;;728    							}
;;;729    						}
;;;730    					}else if(mode_sw == 2){//充电搁置
0004be  49eb              LDR      r1,|L2.2156|
0004c0  7809              LDRB     r1,[r1,#0]  ; mode_sw
0004c2  2902              CMP      r1,#2
0004c4  d077              BEQ      |L2.1462|
;;;731    						if(sendmodeflag == 1)
;;;732    						{
;;;733    							for(i=0;i<3;i++)
;;;734    							{
;;;735    								MODS_SendWithCRC(sendmodegap,6);
;;;736    								Delay_ms(SENDPCDELAY);
;;;737    								
;;;738    							}
;;;739    							sendmodeflag = 0;
;;;740    						}
;;;741    						if(capwait == 0)
;;;742    						{
;;;743    							mainswitch = 1;
;;;744    							mode_sw = 1;
;;;745    							sendmodeflag = 1;
;;;746    							cdcswdelay = 5000;
;;;747    						}else{
;;;748    							capwait --;
;;;749    						}
;;;750    					}else if(mode_sw == 3){//放电搁置
0004c6  49e9              LDR      r1,|L2.2156|
0004c8  7809              LDRB     r1,[r1,#0]  ; mode_sw
0004ca  2903              CMP      r1,#3
0004cc  d074              BEQ      |L2.1464|
                  |L2.1230|
0004ce  e12f              B        |L2.1840|
                  |L2.1232|
0004d0  4682              MOV      r10,r0                ;560
0004d2  7800              LDRB     r0,[r0,#0]            ;560  ; sendmodeflag
0004d4  2801              CMP      r0,#1                 ;560
0004d6  d10d              BNE      |L2.1268|
0004d8  2600              MOVS     r6,#0                 ;562
                  |L2.1242|
0004da  2106              MOVS     r1,#6                 ;564
0004dc  48e5              LDR      r0,|L2.2164|
0004de  f7fffffe          BL       MODS_SendWithCRC
0004e2  2096              MOVS     r0,#0x96              ;565
0004e4  f7fffffe          BL       Delay_ms
0004e8  1c76              ADDS     r6,r6,#1              ;565
0004ea  b2f6              UXTB     r6,r6                 ;562
0004ec  2e03              CMP      r6,#3                 ;562
0004ee  d3f4              BCC      |L2.1242|
0004f0  f88a4000          STRB     r4,[r10,#0]           ;567
                  |L2.1268|
0004f4  f8b81006          LDRH     r1,[r8,#6]            ;569  ; cdcswdelay
0004f8  4640              MOV      r0,r8                 ;569
0004fa  b109              CBZ      r1,|L2.1280|
0004fc  1e49              SUBS     r1,r1,#1              ;569
0004fe  80c1              STRH     r1,[r0,#6]            ;571
                  |L2.1280|
000500  49dd              LDR      r1,|L2.2168|
000502  f8d130a8          LDR      r3,[r1,#0xa8]         ;573  ; Para
000506  2202              MOVS     r2,#2                 ;435
000508  b12b              CBZ      r3,|L2.1302|
00050a  f8d130a8          LDR      r3,[r1,#0xa8]         ;602  ; Para
00050e  6b46              LDR      r6,[r0,#0x34]         ;602  ; ctime
000510  42b3              CMP      r3,r6                 ;602
000512  d90c              BLS      |L2.1326|
000514  e10c              B        |L2.1840|
                  |L2.1302|
000516  f8b13078          LDRH     r3,[r1,#0x78]         ;584  ; Para
00051a  6b0e              LDR      r6,[r1,#0x30]         ;584  ; Para
00051c  eb060686          ADD      r6,r6,r6,LSL #2       ;584
000520  ebb30f46          CMP      r3,r6,LSL #1          ;584
000524  d9d3              BLS      |L2.1230|
000526  f8b13078          LDRH     r3,[r1,#0x78]         ;584  ; Para
00052a  2b00              CMP      r3,#0                 ;584
00052c  d0cf              BEQ      |L2.1230|
                  |L2.1326|
00052e  88c3              LDRH     r3,[r0,#6]            ;584  ; cdcswdelay
000530  2b00              CMP      r3,#0                 ;584
000532  d1cc              BNE      |L2.1230|
000534  70c5              STRB     r5,[r0,#3]            ;604
000536  703c              STRB     r4,[r7,#0]            ;609
000538  6344              STR      r4,[r0,#0x34]         ;610  ; ctime
00053a  4bd0              LDR      r3,|L2.2172|
00053c  701d              STRB     r5,[r3,#0]            ;611
00053e  4bcb              LDR      r3,|L2.2156|
000540  701a              STRB     r2,[r3,#0]            ;612
000542  f88a5000          STRB     r5,[r10,#0]           ;614
000546  f8b11086          LDRH     r1,[r1,#0x86]         ;615  ; Para
00054a  f44f727a          MOV      r2,#0x3e8             ;615
00054e  4351              MULS     r1,r2,r1              ;615
000550  e0ed              B        |L2.1838|
                  |L2.1362|
000552  48c7              LDR      r0,|L2.2160|
000554  7800              LDRB     r0,[r0,#0]            ;620  ; sendmodeflag
000556  2801              CMP      r0,#1                 ;620
000558  d11a              BNE      |L2.1424|
00055a  2600              MOVS     r6,#0                 ;622
                  |L2.1372|
00055c  48c5              LDR      r0,|L2.2164|
00055e  2106              MOVS     r1,#6                 ;624
000560  1d80              ADDS     r0,r0,#6              ;624
000562  f7fffffe          BL       MODS_SendWithCRC
000566  2096              MOVS     r0,#0x96              ;625
000568  f7fffffe          BL       Delay_ms
00056c  1c76              ADDS     r6,r6,#1              ;625
00056e  b2f6              UXTB     r6,r6                 ;622
000570  2e03              CMP      r6,#3                 ;622
000572  d3f3              BCC      |L2.1372|
000574  48be              LDR      r0,|L2.2160|
000576  7004              STRB     r4,[r0,#0]            ;627
000578  2064              MOVS     r0,#0x64              ;628
00057a  f7fffffe          BL       Delay_ms
00057e  48c0              LDR      r0,|L2.2176|
000580  6801              LDR      r1,[r0,#0]            ;629  ; flagA
000582  f0410140          ORR      r1,r1,#0x40           ;629
000586  6001              STR      r1,[r0,#0]            ;630  ; flagA
000588  2180              MOVS     r1,#0x80              ;630
00058a  48be              LDR      r0,|L2.2180|
00058c  f7fffffe          BL       GPIO_ResetBits
                  |L2.1424|
000590  f8b81006          LDRH     r1,[r8,#6]            ;632  ; cdcswdelay
000594  4640              MOV      r0,r8                 ;632
000596  b109              CBZ      r1,|L2.1436|
000598  1e49              SUBS     r1,r1,#1              ;632
00059a  80c1              STRH     r1,[r0,#6]            ;634
                  |L2.1436|
00059c  4eb6              LDR      r6,|L2.2168|
00059e  f8d610ac          LDR      r1,[r6,#0xac]         ;636  ; Para
0005a2  b151              CBZ      r1,|L2.1466|
0005a4  f8d610ac          LDR      r1,[r6,#0xac]         ;684  ; Para
0005a8  6b82              LDR      r2,[r0,#0x38]         ;684  ; dctime
0005aa  4291              CMP      r1,r2                 ;684
0005ac  d802              BHI      |L2.1460|
0005ae  f8b80006          LDRH     r0,[r8,#6]            ;684  ; cdcswdelay
0005b2  b3e8              CBZ      r0,|L2.1584|
                  |L2.1460|
0005b4  e0bc              B        |L2.1840|
                  |L2.1462|
0005b6  e080              B        |L2.1722|
                  |L2.1464|
0005b8  e0a0              B        |L2.1788|
                  |L2.1466|
0005ba  6af1              LDR      r1,[r6,#0x2c]         ;638  ; Para
0005bc  f8d62080          LDR      r2,[r6,#0x80]         ;638  ; Para
0005c0  4291              CMP      r1,r2                 ;638
0005c2  d234              BCS      |L2.1582|
0005c4  f8b80006          LDRH     r0,[r8,#6]            ;638  ; cdcswdelay
0005c8  bb88              CBNZ     r0,|L2.1582|
0005ca  48ad              LDR      r0,|L2.2176|
0005cc  6801              LDR      r1,[r0,#0]            ;640  ; flagA
0005ce  f0210140          BIC      r1,r1,#0x40           ;640
0005d2  6001              STR      r1,[r0,#0]            ;641  ; flagA
0005d4  2180              MOVS     r1,#0x80              ;641
0005d6  48ab              LDR      r0,|L2.2180|
0005d8  f7fffffe          BL       GPIO_SetBits
0005dc  48a6              LDR      r0,|L2.2168|
0005de  f8900084          LDRB     r0,[r0,#0x84]         ;642  ; Para
0005e2  f8981004          LDRB     r1,[r8,#4]            ;642  ; loop
0005e6  4646              MOV      r6,r8                 ;642
0005e8  4288              CMP      r0,r1                 ;642
0005ea  d122              BNE      |L2.1586|
0005ec  7135              STRB     r5,[r6,#4]            ;644
0005ee  49a2              LDR      r1,|L2.2168|
0005f0  f8911084          LDRB     r1,[r1,#0x84]         ;645  ; Para
0005f4  6b32              LDR      r2,[r6,#0x30]         ;645  ; battery_c
0005f6  fbb2f1f1          UDIV     r1,r2,r1              ;645
0005fa  6331              STR      r1,[r6,#0x30]         ;645  ; battery_c
0005fc  2600              MOVS     r6,#0                 ;646
                  |L2.1534|
0005fe  2096              MOVS     r0,#0x96              ;652
000600  f7fffffe          BL       Delay_ms
000604  489b              LDR      r0,|L2.2164|
000606  2106              MOVS     r1,#6                 ;653
000608  300c              ADDS     r0,r0,#0xc            ;653
00060a  f7fffffe          BL       MODS_SendWithCRC
00060e  2096              MOVS     r0,#0x96              ;654
000610  f7fffffe          BL       Delay_ms
000614  1c76              ADDS     r6,r6,#1              ;654
000616  b2f6              UXTB     r6,r6                 ;646
000618  2e03              CMP      r6,#3                 ;646
00061a  d3f0              BCC      |L2.1534|
                  |L2.1564|
00061c  489a              LDR      r0,|L2.2184|
00061e  7084              STRB     r4,[r0,#2]            ;656
000620  4891              LDR      r0,|L2.2152|
000622  ed8a8a00          VSTR     s16,[r10,#0]          ;657
000626  ed808a00          VSTR     s16,[r0,#0]           ;658
00062a  f8c84038          STR      r4,[r8,#0x38]         ;659  ; dctime
                  |L2.1582|
00062e  e07f              B        |L2.1840|
                  |L2.1584|
000630  e019              B        |L2.1638|
                  |L2.1586|
000632  4893              LDR      r0,|L2.2176|
000634  6801              LDR      r1,[r0,#0]            ;663  ; flagA
000636  f0210140          BIC      r1,r1,#0x40           ;663
00063a  6001              STR      r1,[r0,#0]            ;664  ; flagA
00063c  2180              MOVS     r1,#0x80              ;664
00063e  4891              LDR      r0,|L2.2180|
000640  f7fffffe          BL       GPIO_SetBits
000644  2064              MOVS     r0,#0x64              ;665
000646  f7fffffe          BL       Delay_ms
00064a  63b4              STR      r4,[r6,#0x38]         ;666  ; dctime
00064c  4987              LDR      r1,|L2.2156|
00064e  2003              MOVS     r0,#3                 ;667
000650  7008              STRB     r0,[r1,#0]            ;667
000652  4887              LDR      r0,|L2.2160|
000654  7005              STRB     r5,[r0,#0]            ;668
000656  4888              LDR      r0,|L2.2168|
000658  f8b00086          LDRH     r0,[r0,#0x86]         ;669  ; Para
00065c  f44f717a          MOV      r1,#0x3e8             ;669
000660  4348              MULS     r0,r1,r0              ;669
000662  63f0              STR      r0,[r6,#0x3c]         ;669  ; capwait
000664  e064              B        |L2.1840|
                  |L2.1638|
000666  4886              LDR      r0,|L2.2176|
000668  6801              LDR      r1,[r0,#0]            ;686  ; flagA
00066a  f0210140          BIC      r1,r1,#0x40           ;686
00066e  6001              STR      r1,[r0,#0]            ;687  ; flagA
000670  2180              MOVS     r1,#0x80              ;687
000672  4884              LDR      r0,|L2.2180|
000674  f7fffffe          BL       GPIO_SetBits
000678  487f              LDR      r0,|L2.2168|
00067a  f8900084          LDRB     r0,[r0,#0x84]         ;688  ; Para
00067e  f8981004          LDRB     r1,[r8,#4]            ;688  ; loop
000682  4646              MOV      r6,r8                 ;688
000684  4288              CMP      r0,r1                 ;688
000686  d1d4              BNE      |L2.1586|
000688  7135              STRB     r5,[r6,#4]            ;690
00068a  497b              LDR      r1,|L2.2168|
00068c  f8911084          LDRB     r1,[r1,#0x84]         ;691  ; Para
000690  6b32              LDR      r2,[r6,#0x30]         ;691  ; battery_c
000692  fbb2f1f1          UDIV     r1,r2,r1              ;691
000696  6331              STR      r1,[r6,#0x30]         ;691  ; battery_c
000698  2600              MOVS     r6,#0                 ;692
                  |L2.1690|
00069a  2096              MOVS     r0,#0x96              ;698
00069c  f7fffffe          BL       Delay_ms
0006a0  4874              LDR      r0,|L2.2164|
0006a2  2106              MOVS     r1,#6                 ;699
0006a4  300c              ADDS     r0,r0,#0xc            ;699
0006a6  f7fffffe          BL       MODS_SendWithCRC
0006aa  2096              MOVS     r0,#0x96              ;700
0006ac  f7fffffe          BL       Delay_ms
0006b0  1c76              ADDS     r6,r6,#1              ;700
0006b2  b2f6              UXTB     r6,r6                 ;692
0006b4  2e03              CMP      r6,#3                 ;692
0006b6  d3f0              BCC      |L2.1690|
0006b8  e7b0              B        |L2.1564|
                  |L2.1722|
0006ba  4682              MOV      r10,r0                ;731
0006bc  7800              LDRB     r0,[r0,#0]            ;731  ; sendmodeflag
0006be  2801              CMP      r0,#1                 ;731
0006c0  d10e              BNE      |L2.1760|
0006c2  2600              MOVS     r6,#0                 ;733
                  |L2.1732|
0006c4  486b              LDR      r0,|L2.2164|
0006c6  2106              MOVS     r1,#6                 ;735
0006c8  3012              ADDS     r0,r0,#0x12           ;735
0006ca  f7fffffe          BL       MODS_SendWithCRC
0006ce  2096              MOVS     r0,#0x96              ;736
0006d0  f7fffffe          BL       Delay_ms
0006d4  1c76              ADDS     r6,r6,#1              ;736
0006d6  b2f6              UXTB     r6,r6                 ;733
0006d8  2e03              CMP      r6,#3                 ;733
0006da  d3f3              BCC      |L2.1732|
0006dc  f88a4000          STRB     r4,[r10,#0]           ;739
                  |L2.1760|
0006e0  f8d8103c          LDR      r1,[r8,#0x3c]         ;741  ; capwait
0006e4  4640              MOV      r0,r8                 ;741
0006e6  bb01              CBNZ     r1,|L2.1834|
0006e8  703d              STRB     r5,[r7,#0]            ;743
0006ea  4960              LDR      r1,|L2.2156|
0006ec  700d              STRB     r5,[r1,#0]            ;744
0006ee  f88a5000          STRB     r5,[r10,#0]           ;745
0006f2  f2413188          MOV      r1,#0x1388            ;746
0006f6  f8a81006          STRH     r1,[r8,#6]            ;746
0006fa  e019              B        |L2.1840|
                  |L2.1788|
;;;751    						if(sendmodeflag == 1)
0006fc  4682              MOV      r10,r0
0006fe  7800              LDRB     r0,[r0,#0]  ; sendmodeflag
000700  2801              CMP      r0,#1
000702  d10e              BNE      |L2.1826|
;;;752    						{
;;;753    							for(i=0;i<3;i++)
000704  2600              MOVS     r6,#0
                  |L2.1798|
;;;754    							{
;;;755    								MODS_SendWithCRC(sendmodegap,6);
000706  485b              LDR      r0,|L2.2164|
000708  2106              MOVS     r1,#6
00070a  3012              ADDS     r0,r0,#0x12
00070c  f7fffffe          BL       MODS_SendWithCRC
;;;756    								Delay_ms(SENDPCDELAY);
000710  2096              MOVS     r0,#0x96
000712  f7fffffe          BL       Delay_ms
000716  1c76              ADDS     r6,r6,#1
000718  b2f6              UXTB     r6,r6                 ;753
00071a  2e03              CMP      r6,#3                 ;753
00071c  d3f3              BCC      |L2.1798|
;;;757    								
;;;758    							}
;;;759    							sendmodeflag = 0;
00071e  f88a4000          STRB     r4,[r10,#0]
                  |L2.1826|
;;;760    						}
;;;761    						if(capwait == 0)
000722  f8d8103c          LDR      r1,[r8,#0x3c]  ; capwait
000726  4640              MOV      r0,r8
000728  b161              CBZ      r1,|L2.1860|
                  |L2.1834|
;;;762    						{
;;;763    							mode_sw = 0;
;;;764    							mainswitch = 1;
;;;765    							listsend = 1;
;;;766    							sendmodeflag = 1;
;;;767    							charge_step = 1;
;;;768    							charge_step = 1;
;;;769    							cdcswdelay = 5000;
;;;770    							loop ++;
;;;771    						}else{
;;;772    							capwait --;
00072a  6bc1              LDR      r1,[r0,#0x3c]  ; capwait
00072c  1e49              SUBS     r1,r1,#1
                  |L2.1838|
00072e  63c1              STR      r1,[r0,#0x3c]  ; capwait
                  |L2.1840|
;;;773    						}
;;;774    					}
;;;775    				}
;;;776    			}	
;;;777    			break;
;;;778    			
;;;779    			//系统信息
;;;780    			case 6:{
;;;781    				
;;;782    				
;;;783    			}  	  
;;;784    			break;
;;;785    		}
;;;786    		
;;;787    		if( ms_time % 1000 == 0 && ms_time > 999 )
000730  f8d81010          LDR      r1,[r8,#0x10]  ; ms_time
000734  4646              MOV      r6,r8
000736  4648              MOV      r0,r9
000738  fbb1f2f0          UDIV     r2,r1,r0
00073c  fb091112          MLS      r1,r9,r2,r1
000740  b181              CBZ      r1,|L2.1892|
000742  e015              B        |L2.1904|
                  |L2.1860|
000744  4949              LDR      r1,|L2.2156|
000746  700c              STRB     r4,[r1,#0]            ;763
000748  703d              STRB     r5,[r7,#0]            ;764
00074a  494c              LDR      r1,|L2.2172|
00074c  700d              STRB     r5,[r1,#0]            ;765
00074e  f88a5000          STRB     r5,[r10,#0]           ;766
000752  70c5              STRB     r5,[r0,#3]            ;767
000754  70c5              STRB     r5,[r0,#3]            ;768
000756  f2413188          MOV      r1,#0x1388            ;769
00075a  80c1              STRH     r1,[r0,#6]            ;769
00075c  7901              LDRB     r1,[r0,#4]            ;770  ; loop
00075e  1c49              ADDS     r1,r1,#1              ;770
000760  7101              STRB     r1,[r0,#4]            ;770
000762  e7e5              B        |L2.1840|
                  |L2.1892|
000764  6931              LDR      r1,[r6,#0x10]  ; ms_time
000766  4549              CMP      r1,r9
000768  d302              BCC      |L2.1904|
;;;788    			
;;;789    			abc_time++; 
00076a  68f0              LDR      r0,[r6,#0xc]  ; abc_time
00076c  1c40              ADDS     r0,r0,#1
00076e  60f0              STR      r0,[r6,#0xc]  ; abc_time
                  |L2.1904|
;;;790    	
;;;791    		ms_time++;
000770  6930              LDR      r0,[r6,#0x10]  ; ms_time
000772  1c40              ADDS     r0,r0,#1
000774  6130              STR      r0,[r6,#0x10]  ; ms_time
;;;792    		if(calflag == 0)
000776  4845              LDR      r0,|L2.2188|
000778  7800              LDRB     r0,[r0,#0]  ; calflag
00077a  b358              CBZ      r0,|L2.2004|
;;;793    		{
;;;794    			PPower = DISS_POW_Voltage * DISS_POW_Current;
;;;795    			LPower = DISS_Voltage * DISS_Current;
;;;796    		}else{
;;;797    			PPower=0;
00077c  eeb00a48          VMOV.F32 s0,s16
                  |L2.1920|
;;;798    			LPower=0;
;;;799    		}
;;;800    //		if((PPower > 80) || (LPower > 80))
;;;801    //		{
;;;802    //			Off_GPOI_ResetSet();
;;;803    //			shutcount1 = 0;
;;;804    //			shutcount2 = 0;
;;;805    //			mainswitch = 0;
;;;806    //		}
;;;807    //		if((PPower >= 300) || (LPower >= 600))
;;;808    //		{
;;;809    //			shutcount3++;
;;;810    //			if(shutcount3 >= 500)
;;;811    //			{
;;;812    //				Off_GPOI_ResetSet();
;;;813    //				shutcount1 = 0;
;;;814    //				shutcount2 = 0;
;;;815    //				shutcount3 = 0;
;;;816    //				mainswitch = 0;
;;;817    //			}
;;;818    //		}else if((PPower > 100 && PPower < 200) || (LPower > 500 && LPower < 600)){
;;;819    //			shutcount1 ++;
;;;820    //			if(shutcount1 >= 180000)
;;;821    //			{
;;;822    //				Off_GPOI_ResetSet();
;;;823    //				mainswitch = 0;
;;;824    //				shutcount1 = 0;
;;;825    //			}			
;;;826    //		}else if((PPower >= 200 && PPower < 300) || (LPower >= 500 && LPower < 600)){
;;;827    //			shutcount2 ++;
;;;828    //			if(shutcount2 >= 10000)
;;;829    //			{
;;;830    //				Off_GPOI_ResetSet();
;;;831    //				mainswitch = 0;
;;;832    //				shutcount2 = 0;
;;;833    //			}
;;;834    //		}else{
;;;835    //			shutcount1 = 0;
;;;836    //			shutcount2 = 0;
;;;837    //			shutcount3 = 0;
;;;838    //		}
;;;839    //		if(HARDVER == 1)
;;;840    //		{
;;;841    //			if(MODE != 2)
;;;842    //			{
;;;843    //				if((PPower >= 600) || (LPower >= 1800) || (DISS_Current >= 100))
;;;844    //				{
;;;845    //					shutcount3++;
;;;846    //					if(shutcount3 >= 500)
;;;847    //					{
;;;848    //						overflag = 1;
;;;849    //						Off_GPOI_ResetSet();
;;;850    //	//					shutcount1 = 0;
;;;851    //	//					shutcount2 = 0;
;;;852    //						shutcount3 = 0;
;;;853    //						mainswitch = 0;
;;;854    //					}
;;;855    //				}else{
;;;856    //	//				shutcount1 = 0;
;;;857    //	//				shutcount2 = 0;
;;;858    //					shutcount3 = 0;
;;;859    //				}
;;;860    //				if(DISS_Current > 60 && DISS_Current < 100)
;;;861    //				{
;;;862    //					shutcount4 ++;
;;;863    //					if(shutcount4 >= 20000)
;;;864    //					{
;;;865    //						overflag = 1;
;;;866    //						Off_GPOI_ResetSet();
;;;867    //						mainswitch = 0;
;;;868    //						shutcount1 = 0;
;;;869    //					}
;;;870    //				}else{
;;;871    //					shutcount4 = 0;
;;;872    //				}
;;;873    //			}else{
;;;874    //				if((PPower >= 600) || (LPower >= 3600) || DISS_Current >= 160)
;;;875    //				{
;;;876    //					shutcount3++;
;;;877    //					if(shutcount3 >= 500)
;;;878    //					{
;;;879    //						overflag = 1;
;;;880    //						Off_GPOI_ResetSet();
;;;881    //	//					shutcount1 = 0;
;;;882    //	//					shutcount2 = 0;
;;;883    //						shutcount3 = 0;
;;;884    //						mainswitch = 0;
;;;885    //					}
;;;886    //				}else{
;;;887    //	//				shutcount1 = 0;
;;;888    //	//				shutcount2 = 0;
;;;889    //					shutcount3 = 0;
;;;890    //				}
;;;891    //				if(DISS_Current > 60 && DISS_Current < 160)
;;;892    //				{
;;;893    //					shutcount4 ++;
;;;894    //					if(shutcount4 >= 2000)
;;;895    //					{
;;;896    //						overflag = 1;
;;;897    //						Off_GPOI_ResetSet();
;;;898    //						mainswitch = 0;
;;;899    //						shutcount4 = 0;
;;;900    //					}
;;;901    //				}else{
;;;902    //					shutcount4 = 0;
;;;903    //	//				shutcount2 = 0;
;;;904    //	//				shutcount3 = 0;
;;;905    //				}
;;;906    //			}
;;;907    //		}else if(HARDVER == 2){
;;;908    			if(MODE != 2)
000780  4843              LDR      r0,|L2.2192|
000782  7800              LDRB     r0,[r0,#0]  ; MODE
;;;909    			{
;;;910    
;;;911    				if((PPower >= 1200) || (LPower >= 1800) || (DISS_Current >= 120))
000784  4a43              LDR      r2,|L2.2196|
000786  2802              CMP      r0,#2                 ;908
;;;912    				{
;;;913    					shutcount3++;
;;;914    					shutcount2++;
;;;915    					if(shutcount3 >= 500)
;;;916    					{
;;;917    						overflag = 1;
;;;918    						Off_GPOI_ResetSet();
;;;919    	//					shutcount1 = 0;
;;;920    	//					shutcount2 = 0;
;;;921    						shutcount3 = 0;
;;;922    						shutcount2 = 0;
;;;923    						mainswitch = 0;
;;;924    					}
;;;925    				}else{
;;;926    	//				shutcount1 = 0;
;;;927    	//				shutcount2 = 0;
;;;928    						shutcount3 = 0;
;;;929    				}
;;;930    				if(DISS_Current >= 100 && DISS_Current < 120)
;;;931    				{
;;;932    					shutcount2 ++;
;;;933    					if(shutcount2 >= 20000)
;;;934    					{
;;;935    						overflag = 1;
;;;936    						Off_GPOI_ResetSet();
;;;937    						mainswitch = 0;
;;;938    						shutcount2 = 0;
;;;939    					}
;;;940    				}else{
;;;941    					if(DISS_Current<100)
;;;942    						shutcount2 = 0;
;;;943    				}
;;;944    			}else{
;;;945    				if((PPower >= 1200) || (LPower >= 3600) || DISS_Current >= 160)
000788  ee100a10          VMOV     r0,s0
00078c  f8df8108          LDR      r8,|L2.2200|
000790  f8df9108          LDR      r9,|L2.2204|
000794  f44f71fa          MOV      r1,#0x1f4             ;915
000798  f6446a20          MOV      r10,#0x4e20           ;933
00079c  d042              BEQ      |L2.2084|
00079e  4290              CMP      r0,r2                 ;911
0007a0  da08              BGE      |L2.1972|
0007a2  ee180a10          VMOV     r0,s16                ;911
0007a6  4a3e              LDR      r2,|L2.2208|
0007a8  4290              CMP      r0,r2                 ;911
0007aa  da03              BGE      |L2.1972|
0007ac  f8db0000          LDR      r0,[r11,#0]           ;911  ; DISS_Current
0007b0  4540              CMP      r0,r8                 ;911
0007b2  db1f              BLT      |L2.2036|
                  |L2.1972|
0007b4  69b0              LDR      r0,[r6,#0x18]         ;913  ; shutcount3
0007b6  1c40              ADDS     r0,r0,#1              ;913
0007b8  61b0              STR      r0,[r6,#0x18]         ;913  ; shutcount3
0007ba  6970              LDR      r0,[r6,#0x14]         ;914  ; shutcount2
0007bc  1c40              ADDS     r0,r0,#1              ;914
0007be  6170              STR      r0,[r6,#0x14]         ;914  ; shutcount2
0007c0  69b0              LDR      r0,[r6,#0x18]         ;915  ; shutcount3
0007c2  4288              CMP      r0,r1                 ;915
0007c4  d317              BCC      |L2.2038|
0007c6  7175              STRB     r5,[r6,#5]            ;917
0007c8  f7fffffe          BL       Off_GPOI_ResetSet
0007cc  61b4              STR      r4,[r6,#0x18]         ;921  ; shutcount3
0007ce  6174              STR      r4,[r6,#0x14]         ;922  ; shutcount2
0007d0  703c              STRB     r4,[r7,#0]            ;923
0007d2  e010              B        |L2.2038|
                  |L2.2004|
0007d4  4833              LDR      r0,|L2.2212|
0007d6  ed9b1a00          VLDR     s2,[r11,#0]           ;795
0007da  ed900a00          VLDR     s0,[r0,#0]            ;794
0007de  4821              LDR      r0,|L2.2148|
0007e0  edd00a00          VLDR     s1,[r0,#0]            ;794
0007e4  4830              LDR      r0,|L2.2216|
0007e6  ee200a20          VMUL.F32 s0,s0,s1              ;794
0007ea  edd00a00          VLDR     s1,[r0,#0]            ;795
0007ee  ee208a81          VMUL.F32 s16,s1,s2             ;795
0007f2  e7c5              B        |L2.1920|
                  |L2.2036|
0007f4  61b4              STR      r4,[r6,#0x18]         ;928  ; shutcount3
                  |L2.2038|
0007f6  4929              LDR      r1,|L2.2204|
0007f8  f8db0000          LDR      r0,[r11,#0]           ;930  ; DISS_Current
0007fc  4249              RSBS     r1,r1,#0              ;930
0007fe  4401              ADD      r1,r1,r0              ;930
000800  f5b11f20          CMP      r1,#0x280000          ;930
000804  d20a              BCS      |L2.2076|
000806  6970              LDR      r0,[r6,#0x14]         ;932  ; shutcount2
000808  1c40              ADDS     r0,r0,#1              ;932
00080a  6170              STR      r0,[r6,#0x14]         ;932  ; shutcount2
00080c  6971              LDR      r1,[r6,#0x14]         ;933  ; shutcount2
00080e  4551              CMP      r1,r10                ;933
000810  d307              BCC      |L2.2082|
000812  7175              STRB     r5,[r6,#5]            ;935
000814  f7fffffe          BL       Off_GPOI_ResetSet
000818  703c              STRB     r4,[r7,#0]            ;937
00081a  e001              B        |L2.2080|
                  |L2.2076|
00081c  4548              CMP      r0,r9                 ;941
00081e  da7b              BGE      |L2.2328|
                  |L2.2080|
000820  6174              STR      r4,[r6,#0x14]         ;942  ; shutcount2
                  |L2.2082|
000822  e079              B        |L2.2328|
                  |L2.2084|
000824  4290              CMP      r0,r2
000826  da09              BGE      |L2.2108|
000828  ee180a10          VMOV     r0,s16
00082c  4a1f              LDR      r2,|L2.2220|
00082e  4290              CMP      r0,r2
000830  da04              BGE      |L2.2108|
000832  4a1f              LDR      r2,|L2.2224|
000834  f8db0000          LDR      r0,[r11,#0]  ; DISS_Current
000838  4290              CMP      r0,r2
00083a  db3b              BLT      |L2.2228|
                  |L2.2108|
;;;946    				{
;;;947    					shutcount2++;
00083c  6970              LDR      r0,[r6,#0x14]  ; shutcount2
00083e  1c40              ADDS     r0,r0,#1
000840  6170              STR      r0,[r6,#0x14]  ; shutcount2
;;;948    					shutcount4 ++;
000842  69f0              LDR      r0,[r6,#0x1c]  ; shutcount4
000844  1c40              ADDS     r0,r0,#1
000846  61f0              STR      r0,[r6,#0x1c]  ; shutcount4
;;;949    					shutcount3++;
000848  69b0              LDR      r0,[r6,#0x18]  ; shutcount3
00084a  1c40              ADDS     r0,r0,#1
00084c  61b0              STR      r0,[r6,#0x18]  ; shutcount3
;;;950    					if(shutcount3 >= 500)
00084e  69b0              LDR      r0,[r6,#0x18]  ; shutcount3
000850  4288              CMP      r0,r1
000852  d330              BCC      |L2.2230|
;;;951    					{
;;;952    						overflag = 1;
000854  7175              STRB     r5,[r6,#5]
;;;953    						Off_GPOI_ResetSet();
000856  f7fffffe          BL       Off_GPOI_ResetSet
;;;954    	//					shutcount1 = 0;
;;;955    						shutcount2 = 0;
00085a  6174              STR      r4,[r6,#0x14]  ; shutcount2
;;;956    						shutcount3 = 0;
00085c  61b4              STR      r4,[r6,#0x18]  ; shutcount3
;;;957    						shutcount4  =0;
00085e  61f4              STR      r4,[r6,#0x1c]  ; shutcount4
;;;958    						mainswitch = 0;
000860  703c              STRB     r4,[r7,#0]
000862  e028              B        |L2.2230|
                  |L2.2148|
                          DCD      DISS_POW_Current
                  |L2.2152|
                          DCD      CDC_DCsumMah
                  |L2.2156|
                          DCD      mode_sw
                  |L2.2160|
                          DCD      sendmodeflag
                  |L2.2164|
                          DCD      ||area_number.11||+0x40
                  |L2.2168|
                          DCD      Para
                  |L2.2172|
                          DCD      listsend
                  |L2.2176|
                          DCD      flagA
                  |L2.2180|
                          DCD      0x40020800
                  |L2.2184|
                          DCD      rmtrig
                  |L2.2188|
                          DCD      calflag
                  |L2.2192|
                          DCD      MODE
                  |L2.2196|
                          DCD      0x44960000
                  |L2.2200|
                          DCD      0x42f00000
                  |L2.2204|
                          DCD      0x42c80000
                  |L2.2208|
                          DCD      0x44e10000
                  |L2.2212|
                          DCD      DISS_POW_Voltage
                  |L2.2216|
                          DCD      DISS_Voltage
                  |L2.2220|
                          DCD      0x45610000
                  |L2.2224|
                          DCD      0x43200000
                  |L2.2228|
;;;959    					}
;;;960    				}else{
;;;961    	//				shutcount1 = 0;
;;;962    	//				shutcount2 = 0;
;;;963    						shutcount3 = 0;
0008b4  61b4              STR      r4,[r6,#0x18]  ; shutcount3
                  |L2.2230|
;;;964    				}
;;;965    				if(DISS_Current > 100 && DISS_Current < 120)
0008b6  491e              LDR      r1,|L2.2352|
0008b8  f8db0000          LDR      r0,[r11,#0]  ; DISS_Current
0008bc  4a1d              LDR      r2,|L2.2356|
0008be  4401              ADD      r1,r1,r0
0008c0  4291              CMP      r1,r2
0008c2  d20a              BCS      |L2.2266|
;;;966    				{
;;;967    					shutcount2 ++;
0008c4  6970              LDR      r0,[r6,#0x14]  ; shutcount2
0008c6  1c40              ADDS     r0,r0,#1
0008c8  6170              STR      r0,[r6,#0x14]  ; shutcount2
;;;968    					if(shutcount2 >= 20000)
0008ca  6971              LDR      r1,[r6,#0x14]  ; shutcount2
0008cc  4551              CMP      r1,r10
0008ce  d307              BCC      |L2.2272|
;;;969    					{
;;;970    						overflag = 1;
0008d0  7175              STRB     r5,[r6,#5]
;;;971    						Off_GPOI_ResetSet();
0008d2  f7fffffe          BL       Off_GPOI_ResetSet
;;;972    						mainswitch = 0;
0008d6  703c              STRB     r4,[r7,#0]
;;;973    						shutcount2 = 0;
0008d8  e001              B        |L2.2270|
                  |L2.2266|
;;;974    					}
;;;975    				}else{
;;;976    					if(DISS_Current<100)
0008da  4548              CMP      r0,r9
0008dc  da00              BGE      |L2.2272|
                  |L2.2270|
;;;977    						shutcount2 = 0;
0008de  6174              STR      r4,[r6,#0x14]  ; shutcount2
                  |L2.2272|
;;;978    				}
;;;979    				if(DISS_Current >= 120 && DISS_Current < 160)
0008e0  4915              LDR      r1,|L2.2360|
0008e2  f8db0000          LDR      r0,[r11,#0]  ; DISS_Current
0008e6  4401              ADD      r1,r1,r0
0008e8  f5b11f40          CMP      r1,#0x300000
0008ec  d211              BCS      |L2.2322|
;;;980    				{
;;;981    					shutcount2++;
0008ee  6970              LDR      r0,[r6,#0x14]  ; shutcount2
0008f0  1c40              ADDS     r0,r0,#1
0008f2  6170              STR      r0,[r6,#0x14]  ; shutcount2
;;;982    					shutcount4 ++;
0008f4  69f0              LDR      r0,[r6,#0x1c]  ; shutcount4
0008f6  1c40              ADDS     r0,r0,#1
0008f8  61f0              STR      r0,[r6,#0x1c]  ; shutcount4
;;;983    					if(shutcount4 >= 2000)
0008fa  e000              B        |L2.2302|
                  |L2.2300|
0008fc  e014              B        |L2.2344|
                  |L2.2302|
0008fe  69f0              LDR      r0,[r6,#0x1c]  ; shutcount4
000900  f5b06ffa          CMP      r0,#0x7d0
000904  d308              BCC      |L2.2328|
;;;984    					{
;;;985    						overflag = 1;
000906  7175              STRB     r5,[r6,#5]
;;;986    						Off_GPOI_ResetSet();
000908  f7fffffe          BL       Off_GPOI_ResetSet
;;;987    						mainswitch = 0;
00090c  703c              STRB     r4,[r7,#0]
;;;988    						shutcount4 = 0;
00090e  61f4              STR      r4,[r6,#0x1c]  ; shutcount4
;;;989    						shutcount2 = 0;
000910  e786              B        |L2.2080|
                  |L2.2322|
;;;990    					}
;;;991    				}else{
;;;992    					if(DISS_Current<120)
000912  4540              CMP      r0,r8
000914  da00              BGE      |L2.2328|
;;;993    						shutcount4 = 0;
000916  61f4              STR      r4,[r6,#0x1c]  ; shutcount4
                  |L2.2328|
;;;994    	//				shutcount2 = 0;
;;;995    	//				shutcount3 = 0;
;;;996    				}
;;;997    			}
;;;998    //		}
;;;999    //		else if((PPower > 100 && PPower < 200) || (LPower > 100 && LPower < 200)){
;;;1000   //			shutcount1 ++;
;;;1001   //			if(shutcount1 >= 180000)
;;;1002   //			{
;;;1003   //				Off_GPOI_ResetSet();
;;;1004   //				mainswitch = 0;
;;;1005   //				shutcount1 = 0;
;;;1006   //			}			
;;;1007   //		}else if((PPower >= 200 && PPower < 300) || (LPower >= 200 && LPower < 300)){
;;;1008   //			shutcount2 ++;
;;;1009   //			if(shutcount2 >= 10000)
;;;1010   //			{
;;;1011   //				Off_GPOI_ResetSet();
;;;1012   //				mainswitch = 0;
;;;1013   //				shutcount2 = 0;
;;;1014   //			}
;;;1015   //		}
;;;1016   		
;;;1017   		
;;;1018   //		if((PPower > 80) || (LPower > 80))
;;;1019   //		{
;;;1020   //			Off_GPOI_ResetSet();
;;;1021   //			shutcount1 = 0;
;;;1022   //			shutcount2 = 0;
;;;1023   //			mainswitch = 0;
;;;1024   //		}
;;;1025   		
;;;1026   		TIM_ClearITPendingBit(TIM3,TIM_IT_Update);
000918  2101              MOVS     r1,#1
00091a  ecbd8b04          VPOP     {d8-d9}
00091e  e8bd5ff0          POP      {r4-r12,lr}
000922  4806              LDR      r0,|L2.2364|
000924  f7ffbffe          B.W      TIM_ClearITPendingBit
                  |L2.2344|
;;;1027   	}
;;;1028   	  
;;;1029   }
000928  ecbd8b04          VPOP     {d8-d9}
00092c  e8bd9ff0          POP      {r4-r12,pc}
;;;1030   
                          ENDP

                  |L2.2352|
                          DCD      0xbd37ffff
                  |L2.2356|
                          DCD      0x0027ffff
                  |L2.2360|
                          DCD      0xbd100000
                  |L2.2364|
                          DCD      0x40000400

                          AREA ||i.TIM3_Int_Init||, CODE, READONLY, ALIGN=2

                  TIM3_Int_Init PROC
;;;220    
;;;221    void TIM3_Int_Init(u16 arr,u16 psc)
000000  b57f              PUSH     {r0-r6,lr}
;;;222    {
000002  460c              MOV      r4,r1
000004  4605              MOV      r5,r0
;;;223        TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;
;;;224        NVIC_InitTypeDef NVIC_InitStructure;
;;;225    
;;;226        //使用定时器之前都必须开启定时器时钟，基本定时器属于APB1 总线外设。
;;;227        //开启Time x Clk， x
;;;228        RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM3,ENABLE);
000006  2101              MOVS     r1,#1
000008  2002              MOVS     r0,#2
00000a  f7fffffe          BL       RCC_APB1PeriphClockCmd
;;;229       
;;;230    		/*  累计 TIM_Period 个后产生一个更新或者中断  */
;;;231        //  当定时器从0 计数到4999，即为5000 次，为一个定时周期
;;;232        TIM_TimeBaseInitStructure.TIM_Period = arr;  
;;;233    
;;;234        //定时器时钟源TIMxCLK = 2 * PCLK1
;;;235        // PCLK1 = HCLK / 4
;;;236        // => TIMxCLK=HCLK/2=SystemCoreClock/2=90MHz
;;;237        // 设定定时器频率为=TIMxCLK/(TIM_Prescaler+1)=10000Hz   
;;;238        TIM_TimeBaseInitStructure.TIM_Prescaler = psc; 
00000e  f8ad4000          STRH     r4,[sp,#0]
;;;239    
;;;240        //计数方式
;;;241        TIM_TimeBaseInitStructure.TIM_CounterMode=TIM_CounterMode_Up; 
000012  2000              MOVS     r0,#0
;;;242    
;;;243    		//采样时钟分频
;;;244        TIM_TimeBaseInitStructure.TIM_ClockDivision=TIM_CKD_DIV1;
;;;245    
;;;246    		//初始化定时器TIMx, x[1,8]
;;;247        TIM_TimeBaseInit(TIM3,&TIM_TimeBaseInitStructure);
000014  4c10              LDR      r4,|L3.88|
000016  f8ad0002          STRH     r0,[sp,#2]            ;241
00001a  f8ad0008          STRH     r0,[sp,#8]            ;244
00001e  9501              STR      r5,[sp,#4]            ;238
000020  4669              MOV      r1,sp
000022  4620              MOV      r0,r4
000024  f7fffffe          BL       TIM_TimeBaseInit
;;;248    
;;;249    	  //允许定时器x 更新中断
;;;250        TIM_ITConfig(TIM3,TIM_IT_Update,ENABLE); 
000028  2201              MOVS     r2,#1
00002a  4611              MOV      r1,r2
00002c  4620              MOV      r0,r4
00002e  f7fffffe          BL       TIM_ITConfig
;;;251    
;;;252    		//定时器x 中断
;;;253        NVIC_InitStructure.NVIC_IRQChannel=TIM3_IRQn;   
000032  201d              MOVS     r0,#0x1d
000034  f88d000c          STRB     r0,[sp,#0xc]
;;;254    
;;;255    		// 设置抢占优先级
;;;256        NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0x01; 
000038  2101              MOVS     r1,#1
00003a  f88d100d          STRB     r1,[sp,#0xd]
;;;257    
;;;258    		// 设置子优先级
;;;259        NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0x01;   
00003e  f88d100e          STRB     r1,[sp,#0xe]
;;;260    
;;;261    		/* 使能中断通道 */
;;;262        NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
000042  f88d100f          STRB     r1,[sp,#0xf]
;;;263        NVIC_Init(&NVIC_InitStructure);
000046  a803              ADD      r0,sp,#0xc
000048  f7fffffe          BL       NVIC_Init
;;;264    
;;;265    		// 使能定时器
;;;266        TIM_Cmd(TIM3,ENABLE); 
00004c  2101              MOVS     r1,#1
00004e  4620              MOV      r0,r4
000050  f7fffffe          BL       TIM_Cmd
;;;267    }
000054  bd7f              POP      {r0-r6,pc}
;;;268    
                          ENDP

000056  0000              DCW      0x0000
                  |L3.88|
                          DCD      0x40000400

                          AREA ||i.TIM4_Config||, CODE, READONLY, ALIGN=2

                  TIM4_Config PROC
;;;56     /*****************************************************************/
;;;57     void TIM4_Config(void)
000000  b57c              PUSH     {r2-r6,lr}
;;;58     {
;;;59     	GPIO_InitTypeDef GPIO_InitStructure;//调用GPIO结构体
;;;60       /* 配置GPIO管脚复用*/
;;;61     	GPIO_PinAFConfig(GPIOB,GPIO_PinSource8,GPIO_AF_TIM4);
000002  4e13              LDR      r6,|L4.80|
000004  2202              MOVS     r2,#2
000006  2108              MOVS     r1,#8
000008  4630              MOV      r0,r6
00000a  f7fffffe          BL       GPIO_PinAFConfig
;;;62     	GPIO_PinAFConfig(GPIOB,GPIO_PinSource9,GPIO_AF_TIM4);
00000e  2202              MOVS     r2,#2
000010  2109              MOVS     r1,#9
000012  4630              MOV      r0,r6
000014  f7fffffe          BL       GPIO_PinAFConfig
;;;63       GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8;
;;;64       GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
000018  2402              MOVS     r4,#2
00001a  15b0              ASRS     r0,r6,#22             ;63
00001c  f88d4004          STRB     r4,[sp,#4]
;;;65     	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
000020  2500              MOVS     r5,#0
000022  9000              STR      r0,[sp,#0]            ;64
000024  f88d5006          STRB     r5,[sp,#6]
;;;66       GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
000028  f88d4005          STRB     r4,[sp,#5]
;;;67       GPIO_Init(GPIOB, &GPIO_InitStructure);//将设置输入函数
00002c  4669              MOV      r1,sp
00002e  4630              MOV      r0,r6
000030  f7fffffe          BL       GPIO_Init
;;;68       
;;;69     	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_9;
000034  0220              LSLS     r0,r4,#8
;;;70       GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
000036  f88d4004          STRB     r4,[sp,#4]
00003a  9000              STR      r0,[sp,#0]
;;;71     	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
00003c  f88d5006          STRB     r5,[sp,#6]
;;;72       GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
000040  f88d4005          STRB     r4,[sp,#5]
;;;73       GPIO_Init(GPIOB, &GPIO_InitStructure);//将设置输入函数
000044  4669              MOV      r1,sp
000046  4630              MOV      r0,r6
000048  f7fffffe          BL       GPIO_Init
;;;74     }
00004c  bd7c              POP      {r2-r6,pc}
;;;75     /*****************************************************************/
                          ENDP

00004e  0000              DCW      0x0000
                  |L4.80|
                          DCD      0x40020400

                          AREA ||i.TIM4_PWM_Config||, CODE, READONLY, ALIGN=2

                  TIM4_PWM_Config PROC
;;;75     /*****************************************************************/
;;;76     void TIM4_PWM_Config(void)
000000  b530              PUSH     {r4,r5,lr}
;;;77     {
000002  b089              SUB      sp,sp,#0x24
;;;78     	TIM_TimeBaseInitTypeDef  TIM_TimeBaseStructure;
;;;79     	TIM_OCInitTypeDef  TIM_OCInitStructure;
;;;80     	/* TIM3 的配置 ---------------------------------------------------
;;;81        TIM3 输入时钟(TIM3CLK) 设置为 APB2 时钟 (PCLK2)    
;;;82         => TIM3CLK = PCLK2 = SystemCoreClock
;;;83        TIM3CLK = SystemCoreClock, Prescaler = 0, TIM3 counter clock = SystemCoreClock
;;;84        SystemCoreClock 为48 MHz */
;;;85       /* TIM4 时钟使能 */
;;;86       RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM4,ENABLE);
000004  2101              MOVS     r1,#1
000006  2004              MOVS     r0,#4
000008  f7fffffe          BL       RCC_APB1PeriphClockCmd
;;;87     	TIM4_Config();
00000c  f7fffffe          BL       TIM4_Config
;;;88     
;;;89       /* Time 定时基础设置*/
;;;90       TIM_TimeBaseStructure.TIM_Prescaler = 6;//时钟预分频
;;;91       TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_Up;  /* Time 定时设置为上升沿计算模式*/
000010  2400              MOVS     r4,#0
000012  2006              MOVS     r0,#6                 ;90
000014  f8ad0014          STRH     r0,[sp,#0x14]         ;90
;;;92       TIM_TimeBaseStructure.TIM_Period = 0;
;;;93       TIM_TimeBaseStructure.TIM_ClockDivision = 0;
;;;94       TIM_TimeBaseStructure.TIM_RepetitionCounter = 0;
;;;95     
;;;96       TIM_TimeBaseInit(TIM4,&TIM_TimeBaseStructure);
000018  4d21              LDR      r5,|L5.160|
00001a  f8ad401c          STRH     r4,[sp,#0x1c]         ;93
00001e  f8ad4016          STRH     r4,[sp,#0x16]         ;91
000022  9406              STR      r4,[sp,#0x18]         ;93
000024  f88d401e          STRB     r4,[sp,#0x1e]         ;94
000028  a905              ADD      r1,sp,#0x14
00002a  4628              MOV      r0,r5
00002c  f7fffffe          BL       TIM_TimeBaseInit
;;;97     
;;;98       /* 频道1的PWM 模式设置 */
;;;99       TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;
000030  2060              MOVS     r0,#0x60
000032  f8ad0000          STRH     r0,[sp,#0]
;;;100      TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;
000036  2001              MOVS     r0,#1
000038  f8ad0002          STRH     r0,[sp,#2]
;;;101      TIM_OCInitStructure.TIM_OutputNState = TIM_OutputNState_Enable;
00003c  2004              MOVS     r0,#4
00003e  f8ad0004          STRH     r0,[sp,#4]
;;;102      TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_Low;
000042  2002              MOVS     r0,#2
000044  f8ad000c          STRH     r0,[sp,#0xc]
;;;103      TIM_OCInitStructure.TIM_OCNPolarity = TIM_OCNPolarity_High;
;;;104      TIM_OCInitStructure.TIM_OCIdleState = TIM_OCIdleState_Set;
000048  01c0              LSLS     r0,r0,#7
00004a  f8ad0010          STRH     r0,[sp,#0x10]
;;;105      TIM_OCInitStructure.TIM_OCNIdleState = TIM_OCIdleState_Reset;
;;;106    	TIM_OCInitStructure.TIM_Pulse = 0x0f;//使能频道1配置
00004e  200f              MOVS     r0,#0xf
;;;107      TIM_OC3Init(TIM4, &TIM_OCInitStructure);
000050  9002              STR      r0,[sp,#8]
000052  f8ad400e          STRH     r4,[sp,#0xe]          ;103
000056  f8ad4012          STRH     r4,[sp,#0x12]         ;105
00005a  4669              MOV      r1,sp
00005c  4628              MOV      r0,r5
00005e  f7fffffe          BL       TIM_OC3Init
;;;108    	
;;;109    	TIM_OC3PreloadConfig(TIM4, TIM_OCPreload_Enable);
000062  2108              MOVS     r1,#8
000064  4628              MOV      r0,r5
000066  f7fffffe          BL       TIM_OC3PreloadConfig
;;;110    	TIM_OC4Init(TIM4, &TIM_OCInitStructure);
00006a  4669              MOV      r1,sp
00006c  4628              MOV      r0,r5
00006e  f7fffffe          BL       TIM_OC4Init
;;;111    	TIM_OC4PreloadConfig(TIM4, TIM_OCPreload_Enable);
000072  2108              MOVS     r1,#8
000074  4628              MOV      r0,r5
000076  f7fffffe          BL       TIM_OC4PreloadConfig
;;;112    	TIM_SetAutoreload(TIM4, 0x7530);//璁剧疆PWM杈ㄧ?
00007a  f2475130          MOV      r1,#0x7530
00007e  4628              MOV      r0,r5
000080  f7fffffe          BL       TIM_SetAutoreload
;;;113    	TIM_ARRPreloadConfig(TIM4, ENABLE);
000084  2101              MOVS     r1,#1
000086  4628              MOV      r0,r5
000088  f7fffffe          BL       TIM_ARRPreloadConfig
;;;114      /* TIM4 浣胯*/
;;;115      TIM_Cmd(TIM4, ENABLE);
00008c  2101              MOVS     r1,#1
00008e  4628              MOV      r0,r5
000090  f7fffffe          BL       TIM_Cmd
;;;116    	
;;;117      /* TIM4 寮濮杈?*/
;;;118      TIM_CtrlPWMOutputs(TIM4, ENABLE);	
000094  2101              MOVS     r1,#1
000096  4628              MOV      r0,r5
000098  f7fffffe          BL       TIM_CtrlPWMOutputs
;;;119    }
00009c  b009              ADD      sp,sp,#0x24
00009e  bd30              POP      {r4,r5,pc}
;;;120    /**************************************************************************************/
                          ENDP

                  |L5.160|
                          DCD      0x40000800

                          AREA ||i.Temp_Comapre||, CODE, READONLY, ALIGN=2

                  Temp_Comapre PROC
;;;120    /**************************************************************************************/
;;;121    void Temp_Comapre(void)	  //温度来控制风扇
000000  b570              PUSH     {r4-r6,lr}
;;;122    {
;;;123    	if(NTC_value<=2650)
000002  4a0e              LDR      r2,|L6.60|
000004  8813              LDRH     r3,[r2,#0]  ; NTC_value
000006  f640255a          MOV      r5,#0xa5a
;;;124    	{
;;;125    		GPIO_SetBits(GPIOB,GPIO_Pin_12);//开启风扇
00000a  480d              LDR      r0,|L6.64|
;;;126    		flag_FAN_ON=1;
00000c  4c0d              LDR      r4,|L6.68|
00000e  f44f5180          MOV      r1,#0x1000            ;125
000012  42ab              CMP      r3,r5                 ;123
000014  d805              BHI      |L6.34|
000016  f7fffffe          BL       GPIO_SetBits
00001a  6820              LDR      r0,[r4,#0]  ; flagG
00001c  f0400020          ORR      r0,r0,#0x20
000020  e009              B        |L6.54|
                  |L6.34|
;;;127    	}
;;;128    	else if(NTC_value>=2700)
000022  8812              LDRH     r2,[r2,#0]  ; NTC_value
000024  f640238c          MOV      r3,#0xa8c
000028  429a              CMP      r2,r3
00002a  d305              BCC      |L6.56|
;;;129    	{
;;;130    		GPIO_ResetBits(GPIOB,GPIO_Pin_12);//关闭风扇
00002c  f7fffffe          BL       GPIO_ResetBits
;;;131    		flag_FAN_ON=0;
000030  6820              LDR      r0,[r4,#0]  ; flagG
000032  f0200020          BIC      r0,r0,#0x20
                  |L6.54|
000036  6020              STR      r0,[r4,#0]            ;126  ; flagG
                  |L6.56|
;;;132    	}
;;;133    }
000038  bd70              POP      {r4-r6,pc}
;;;134    
                          ENDP

00003a  0000              DCW      0x0000
                  |L6.60|
                          DCD      NTC_value
                  |L6.64|
                          DCD      0x40020400
                  |L6.68|
                          DCD      flagG

                          AREA ||.bss||, DATA, NOINIT, ALIGN=1

                  watchcurrent
                          %        2000
                  vccbuf
                          %        15

                          AREA ||.data||, DATA, ALIGN=0

                  version
000000  15                DCB      0x15

                          AREA ||area_number.11||, DATA, ALIGN=2

                          EXPORTAS ||area_number.11||, ||.data||
                  shorttime
000000  00                DCB      0x00
                  shortflag
000001  00                DCB      0x00
                  finishflag
000002  00                DCB      0x00
                  charge_step
000003  00                DCB      0x00
                  loop
000004  00                DCB      0x00
                  overflag
000005  00                DCB      0x00
                  cdcswdelay
000006  0000              DCB      0x00,0x00
                  watchcount
000008  00000000          DCB      0x00,0x00,0x00,0x00
                  abc_time
                          DCD      0x00000000
                  ms_time
                          DCD      0x00000000
                  shutcount2
                          DCD      0x00000000
                  shutcount3
                          DCD      0x00000000
                  shutcount4
                          DCD      0x00000000
                  recharge
                          DCD      0x00000000
                  reboot
                          DCD      0x00000000
                  testv
                          DCD      0x00000000
                  finishdelay
                          DCD      0x00000000
                  battery_c
                          DCD      0x00000000
                  ctime
                          DCD      0x00000000
                  dctime
                          DCD      0x00000000
                  capwait
                          DCD      0x00000000
                  sendmodepow
000040  01530000          DCB      0x01,0x53,0x00,0x00
000044  0001              DCB      0x00,0x01
                  sendmodeload
000046  0153              DCB      0x01,0x53
000048  00000002          DCB      0x00,0x00,0x00,0x02
                  sendmodestop
00004c  01520000          DCB      0x01,0x52,0x00,0x00
000050  0004              DCB      0x00,0x04
                  sendmodegap
000052  0153              DCB      0x01,0x53
000054  00000003          DCB      0x00,0x00,0x00,0x03

                          AREA ||area_number.12||, DATA, ALIGN=2

                          EXPORTAS ||area_number.12||, ||.data||
                  shortold_I
000000  00000000          DCFS     0x00000000 ; 0

                          AREA ||area_number.13||, DATA, ALIGN=2

                          EXPORTAS ||area_number.13||, ||.data||
                  shutcount1
                          DCD      0x00000000

                          AREA ||area_number.14||, DATA, ALIGN=0

                          EXPORTAS ||area_number.14||, ||.data||
                  lockflag
000000  00                DCB      0x00

;*** Start embedded assembler ***

#line 1 "..\\drive\\TIM4.c"
	AREA ||.rev16_text||, CODE
	THUMB
	EXPORT |__asm___6_TIM4_c_version____REV16|
#line 129 "C:\\Keil_v5\\ARM\\CMSIS\\Include\\core_cmInstr.h"
|__asm___6_TIM4_c_version____REV16| PROC
#line 130

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE
	THUMB
	EXPORT |__asm___6_TIM4_c_version____REVSH|
#line 144
|__asm___6_TIM4_c_version____REVSH| PROC
#line 145

 revsh r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***
